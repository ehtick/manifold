var K=1e-6,te=typeof Float32Array<"u"?Float32Array:Array,tt=Math.random,Ii="zyx";function ct(t){return t>=0?Math.round(t):t%.5===0?Math.floor(t):Math.round(t)}function _i(t){te=t}var Jf=Math.PI/180,Zf=180/Math.PI;function Qf(t){return t*Jf}function el(t){return t*Zf}function tl(t,e){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:K;return Math.abs(t-e)<=r*Math.max(1,Math.abs(t),Math.abs(e))}var rl=Object.freeze({__proto__:null,ANGLE_ORDER:Ii,get ARRAY_TYPE(){return te},EPSILON:K,RANDOM:tt,equals:tl,round:ct,setMatrixArrayType:_i,toDegree:el,toRadian:Qf});function nl(){var t=new te(4);return te!=Float32Array&&(t[1]=0,t[2]=0),t[0]=1,t[3]=1,t}function sl(t){var e=new te(4);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e}function il(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t}function al(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t}function ol(t,e,r,n){var s=new te(4);return s[0]=t,s[1]=e,s[2]=r,s[3]=n,s}function cl(t,e,r,n,s){return t[0]=e,t[1]=r,t[2]=n,t[3]=s,t}function fl(t,e){if(t===e){var r=e[1];t[1]=e[2],t[2]=r}else t[0]=e[0],t[1]=e[2],t[2]=e[1],t[3]=e[3];return t}function ll(t,e){var r=e[0],n=e[1],s=e[2],i=e[3],a=r*i-s*n;return a?(a=1/a,t[0]=i*a,t[1]=-n*a,t[2]=-s*a,t[3]=r*a,t):null}function ul(t,e){var r=e[0];return t[0]=e[3],t[1]=-e[1],t[2]=-e[2],t[3]=r,t}function hl(t){return t[0]*t[3]-t[2]*t[1]}function wi(t,e,r){var n=e[0],s=e[1],i=e[2],a=e[3],o=r[0],c=r[1],f=r[2],h=r[3];return t[0]=n*o+i*c,t[1]=s*o+a*c,t[2]=n*f+i*h,t[3]=s*f+a*h,t}function dl(t,e,r){var n=e[0],s=e[1],i=e[2],a=e[3],o=Math.sin(r),c=Math.cos(r);return t[0]=n*c+i*o,t[1]=s*c+a*o,t[2]=n*-o+i*c,t[3]=s*-o+a*c,t}function pl(t,e,r){var n=e[0],s=e[1],i=e[2],a=e[3],o=r[0],c=r[1];return t[0]=n*o,t[1]=s*o,t[2]=i*c,t[3]=a*c,t}function gl(t,e){var r=Math.sin(e),n=Math.cos(e);return t[0]=n,t[1]=r,t[2]=-r,t[3]=n,t}function ml(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=e[1],t}function vl(t){return"mat2("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"}function xl(t){return Math.sqrt(t[0]*t[0]+t[1]*t[1]+t[2]*t[2]+t[3]*t[3])}function Tl(t,e,r,n){return t[2]=n[2]/n[0],r[0]=n[0],r[1]=n[1],r[3]=n[3]-t[2]*r[1],[t,e,r]}function yl(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t[2]=e[2]+r[2],t[3]=e[3]+r[3],t}function Ai(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t[2]=e[2]-r[2],t[3]=e[3]-r[3],t}function El(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]}function Ml(t,e){var r=t[0],n=t[1],s=t[2],i=t[3],a=e[0],o=e[1],c=e[2],f=e[3];return Math.abs(r-a)<=K*Math.max(1,Math.abs(r),Math.abs(a))&&Math.abs(n-o)<=K*Math.max(1,Math.abs(n),Math.abs(o))&&Math.abs(s-c)<=K*Math.max(1,Math.abs(s),Math.abs(c))&&Math.abs(i-f)<=K*Math.max(1,Math.abs(i),Math.abs(f))}function Rl(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t}function Il(t,e,r,n){return t[0]=e[0]+r[0]*n,t[1]=e[1]+r[1]*n,t[2]=e[2]+r[2]*n,t[3]=e[3]+r[3]*n,t}var _l=wi,wl=Ai,Al=Object.freeze({__proto__:null,LDU:Tl,add:yl,adjoint:ul,clone:sl,copy:il,create:nl,determinant:hl,equals:Ml,exactEquals:El,frob:xl,fromRotation:gl,fromScaling:ml,fromValues:ol,identity:al,invert:ll,mul:_l,multiply:wi,multiplyScalar:Rl,multiplyScalarAndAdd:Il,rotate:dl,scale:pl,set:cl,str:vl,sub:wl,subtract:Ai,transpose:fl});function bl(){var t=new te(6);return te!=Float32Array&&(t[1]=0,t[2]=0,t[4]=0,t[5]=0),t[0]=1,t[3]=1,t}function Sl(t){var e=new te(6);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e}function Nl(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t}function Cl(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t[4]=0,t[5]=0,t}function Ol(t,e,r,n,s,i){var a=new te(6);return a[0]=t,a[1]=e,a[2]=r,a[3]=n,a[4]=s,a[5]=i,a}function Dl(t,e,r,n,s,i,a){return t[0]=e,t[1]=r,t[2]=n,t[3]=s,t[4]=i,t[5]=a,t}function Fl(t,e){var r=e[0],n=e[1],s=e[2],i=e[3],a=e[4],o=e[5],c=r*i-n*s;return c?(c=1/c,t[0]=i*c,t[1]=-n*c,t[2]=-s*c,t[3]=r*c,t[4]=(s*o-i*a)*c,t[5]=(n*a-r*o)*c,t):null}function $l(t){return t[0]*t[3]-t[1]*t[2]}function bi(t,e,r){var n=e[0],s=e[1],i=e[2],a=e[3],o=e[4],c=e[5],f=r[0],h=r[1],d=r[2],p=r[3],g=r[4],E=r[5];return t[0]=n*f+i*h,t[1]=s*f+a*h,t[2]=n*d+i*p,t[3]=s*d+a*p,t[4]=n*g+i*E+o,t[5]=s*g+a*E+c,t}function Pl(t,e,r){var n=e[0],s=e[1],i=e[2],a=e[3],o=e[4],c=e[5],f=Math.sin(r),h=Math.cos(r);return t[0]=n*h+i*f,t[1]=s*h+a*f,t[2]=n*-f+i*h,t[3]=s*-f+a*h,t[4]=o,t[5]=c,t}function Ul(t,e,r){var n=e[0],s=e[1],i=e[2],a=e[3],o=e[4],c=e[5],f=r[0],h=r[1];return t[0]=n*f,t[1]=s*f,t[2]=i*h,t[3]=a*h,t[4]=o,t[5]=c,t}function Ll(t,e,r){var n=e[0],s=e[1],i=e[2],a=e[3],o=e[4],c=e[5],f=r[0],h=r[1];return t[0]=n,t[1]=s,t[2]=i,t[3]=a,t[4]=n*f+i*h+o,t[5]=s*f+a*h+c,t}function Bl(t,e){var r=Math.sin(e),n=Math.cos(e);return t[0]=n,t[1]=r,t[2]=-r,t[3]=n,t[4]=0,t[5]=0,t}function jl(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=e[1],t[4]=0,t[5]=0,t}function Vl(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t[4]=e[0],t[5]=e[1],t}function zl(t){return"mat2d("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+")"}function kl(t){return Math.sqrt(t[0]*t[0]+t[1]*t[1]+t[2]*t[2]+t[3]*t[3]+t[4]*t[4]+t[5]*t[5]+1)}function Gl(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t[2]=e[2]+r[2],t[3]=e[3]+r[3],t[4]=e[4]+r[4],t[5]=e[5]+r[5],t}function Si(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t[2]=e[2]-r[2],t[3]=e[3]-r[3],t[4]=e[4]-r[4],t[5]=e[5]-r[5],t}function Hl(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t[4]=e[4]*r,t[5]=e[5]*r,t}function ql(t,e,r,n){return t[0]=e[0]+r[0]*n,t[1]=e[1]+r[1]*n,t[2]=e[2]+r[2]*n,t[3]=e[3]+r[3]*n,t[4]=e[4]+r[4]*n,t[5]=e[5]+r[5]*n,t}function Wl(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]}function Xl(t,e){var r=t[0],n=t[1],s=t[2],i=t[3],a=t[4],o=t[5],c=e[0],f=e[1],h=e[2],d=e[3],p=e[4],g=e[5];return Math.abs(r-c)<=K*Math.max(1,Math.abs(r),Math.abs(c))&&Math.abs(n-f)<=K*Math.max(1,Math.abs(n),Math.abs(f))&&Math.abs(s-h)<=K*Math.max(1,Math.abs(s),Math.abs(h))&&Math.abs(i-d)<=K*Math.max(1,Math.abs(i),Math.abs(d))&&Math.abs(a-p)<=K*Math.max(1,Math.abs(a),Math.abs(p))&&Math.abs(o-g)<=K*Math.max(1,Math.abs(o),Math.abs(g))}var Kl=bi,Yl=Si,Jl=Object.freeze({__proto__:null,add:Gl,clone:Sl,copy:Nl,create:bl,determinant:$l,equals:Xl,exactEquals:Wl,frob:kl,fromRotation:Bl,fromScaling:jl,fromTranslation:Vl,fromValues:Ol,identity:Cl,invert:Fl,mul:Kl,multiply:bi,multiplyScalar:Hl,multiplyScalarAndAdd:ql,rotate:Pl,scale:Ul,set:Dl,str:zl,sub:Yl,subtract:Si,translate:Ll});function Ni(){var t=new te(9);return te!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[5]=0,t[6]=0,t[7]=0),t[0]=1,t[4]=1,t[8]=1,t}function Zl(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[4],t[4]=e[5],t[5]=e[6],t[6]=e[8],t[7]=e[9],t[8]=e[10],t}function Ql(t){var e=new te(9);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e}function eu(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t}function tu(t,e,r,n,s,i,a,o,c){var f=new te(9);return f[0]=t,f[1]=e,f[2]=r,f[3]=n,f[4]=s,f[5]=i,f[6]=a,f[7]=o,f[8]=c,f}function ru(t,e,r,n,s,i,a,o,c,f){return t[0]=e,t[1]=r,t[2]=n,t[3]=s,t[4]=i,t[5]=a,t[6]=o,t[7]=c,t[8]=f,t}function nu(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t}function su(t,e){if(t===e){var r=e[1],n=e[2],s=e[5];t[1]=e[3],t[2]=e[6],t[3]=r,t[5]=e[7],t[6]=n,t[7]=s}else t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[1],t[4]=e[4],t[5]=e[7],t[6]=e[2],t[7]=e[5],t[8]=e[8];return t}function iu(t,e){var r=e[0],n=e[1],s=e[2],i=e[3],a=e[4],o=e[5],c=e[6],f=e[7],h=e[8],d=h*a-o*f,p=-h*i+o*c,g=f*i-a*c,E=r*d+n*p+s*g;return E?(E=1/E,t[0]=d*E,t[1]=(-h*n+s*f)*E,t[2]=(o*n-s*a)*E,t[3]=p*E,t[4]=(h*r-s*c)*E,t[5]=(-o*r+s*i)*E,t[6]=g*E,t[7]=(-f*r+n*c)*E,t[8]=(a*r-n*i)*E,t):null}function au(t,e){var r=e[0],n=e[1],s=e[2],i=e[3],a=e[4],o=e[5],c=e[6],f=e[7],h=e[8];return t[0]=a*h-o*f,t[1]=s*f-n*h,t[2]=n*o-s*a,t[3]=o*c-i*h,t[4]=r*h-s*c,t[5]=s*i-r*o,t[6]=i*f-a*c,t[7]=n*c-r*f,t[8]=r*a-n*i,t}function ou(t){var e=t[0],r=t[1],n=t[2],s=t[3],i=t[4],a=t[5],o=t[6],c=t[7],f=t[8];return e*(f*i-a*c)+r*(-f*s+a*o)+n*(c*s-i*o)}function Ci(t,e,r){var n=e[0],s=e[1],i=e[2],a=e[3],o=e[4],c=e[5],f=e[6],h=e[7],d=e[8],p=r[0],g=r[1],E=r[2],M=r[3],T=r[4],v=r[5],D=r[6],R=r[7],w=r[8];return t[0]=p*n+g*a+E*f,t[1]=p*s+g*o+E*h,t[2]=p*i+g*c+E*d,t[3]=M*n+T*a+v*f,t[4]=M*s+T*o+v*h,t[5]=M*i+T*c+v*d,t[6]=D*n+R*a+w*f,t[7]=D*s+R*o+w*h,t[8]=D*i+R*c+w*d,t}function cu(t,e,r){var n=e[0],s=e[1],i=e[2],a=e[3],o=e[4],c=e[5],f=e[6],h=e[7],d=e[8],p=r[0],g=r[1];return t[0]=n,t[1]=s,t[2]=i,t[3]=a,t[4]=o,t[5]=c,t[6]=p*n+g*a+f,t[7]=p*s+g*o+h,t[8]=p*i+g*c+d,t}function fu(t,e,r){var n=e[0],s=e[1],i=e[2],a=e[3],o=e[4],c=e[5],f=e[6],h=e[7],d=e[8],p=Math.sin(r),g=Math.cos(r);return t[0]=g*n+p*a,t[1]=g*s+p*o,t[2]=g*i+p*c,t[3]=g*a-p*n,t[4]=g*o-p*s,t[5]=g*c-p*i,t[6]=f,t[7]=h,t[8]=d,t}function lu(t,e,r){var n=r[0],s=r[1];return t[0]=n*e[0],t[1]=n*e[1],t[2]=n*e[2],t[3]=s*e[3],t[4]=s*e[4],t[5]=s*e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t}function uu(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=e[0],t[7]=e[1],t[8]=1,t}function hu(t,e){var r=Math.sin(e),n=Math.cos(e);return t[0]=n,t[1]=r,t[2]=0,t[3]=-r,t[4]=n,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t}function du(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=0,t[4]=e[1],t[5]=0,t[6]=0,t[7]=0,t[8]=1,t}function pu(t,e){return t[0]=e[0],t[1]=e[1],t[2]=0,t[3]=e[2],t[4]=e[3],t[5]=0,t[6]=e[4],t[7]=e[5],t[8]=1,t}function gu(t,e){var r=e[0],n=e[1],s=e[2],i=e[3],a=r+r,o=n+n,c=s+s,f=r*a,h=n*a,d=n*o,p=s*a,g=s*o,E=s*c,M=i*a,T=i*o,v=i*c;return t[0]=1-d-E,t[3]=h-v,t[6]=p+T,t[1]=h+v,t[4]=1-f-E,t[7]=g-M,t[2]=p-T,t[5]=g+M,t[8]=1-f-d,t}function mu(t,e){var r=e[0],n=e[1],s=e[2],i=e[3],a=e[4],o=e[5],c=e[6],f=e[7],h=e[8],d=e[9],p=e[10],g=e[11],E=e[12],M=e[13],T=e[14],v=e[15],D=r*o-n*a,R=r*c-s*a,w=r*f-i*a,A=n*c-s*o,S=n*f-i*o,x=s*f-i*c,I=h*M-d*E,b=h*T-p*E,N=h*v-g*E,B=d*T-p*M,U=d*v-g*M,V=p*v-g*T,z=D*V-R*U+w*B+A*N-S*b+x*I;return z?(z=1/z,t[0]=(o*V-c*U+f*B)*z,t[1]=(c*N-a*V-f*b)*z,t[2]=(a*U-o*N+f*I)*z,t[3]=(s*U-n*V-i*B)*z,t[4]=(r*V-s*N+i*b)*z,t[5]=(n*N-r*U-i*I)*z,t[6]=(M*x-T*S+v*A)*z,t[7]=(T*w-E*x-v*R)*z,t[8]=(E*S-M*w+v*D)*z,t):null}function vu(t,e,r){return t[0]=2/e,t[1]=0,t[2]=0,t[3]=0,t[4]=-2/r,t[5]=0,t[6]=-1,t[7]=1,t[8]=1,t}function xu(t){return"mat3("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+")"}function Tu(t){return Math.sqrt(t[0]*t[0]+t[1]*t[1]+t[2]*t[2]+t[3]*t[3]+t[4]*t[4]+t[5]*t[5]+t[6]*t[6]+t[7]*t[7]+t[8]*t[8])}function yu(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t[2]=e[2]+r[2],t[3]=e[3]+r[3],t[4]=e[4]+r[4],t[5]=e[5]+r[5],t[6]=e[6]+r[6],t[7]=e[7]+r[7],t[8]=e[8]+r[8],t}function Oi(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t[2]=e[2]-r[2],t[3]=e[3]-r[3],t[4]=e[4]-r[4],t[5]=e[5]-r[5],t[6]=e[6]-r[6],t[7]=e[7]-r[7],t[8]=e[8]-r[8],t}function Eu(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t[4]=e[4]*r,t[5]=e[5]*r,t[6]=e[6]*r,t[7]=e[7]*r,t[8]=e[8]*r,t}function Mu(t,e,r,n){return t[0]=e[0]+r[0]*n,t[1]=e[1]+r[1]*n,t[2]=e[2]+r[2]*n,t[3]=e[3]+r[3]*n,t[4]=e[4]+r[4]*n,t[5]=e[5]+r[5]*n,t[6]=e[6]+r[6]*n,t[7]=e[7]+r[7]*n,t[8]=e[8]+r[8]*n,t}function Ru(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]&&t[6]===e[6]&&t[7]===e[7]&&t[8]===e[8]}function Iu(t,e){var r=t[0],n=t[1],s=t[2],i=t[3],a=t[4],o=t[5],c=t[6],f=t[7],h=t[8],d=e[0],p=e[1],g=e[2],E=e[3],M=e[4],T=e[5],v=e[6],D=e[7],R=e[8];return Math.abs(r-d)<=K*Math.max(1,Math.abs(r),Math.abs(d))&&Math.abs(n-p)<=K*Math.max(1,Math.abs(n),Math.abs(p))&&Math.abs(s-g)<=K*Math.max(1,Math.abs(s),Math.abs(g))&&Math.abs(i-E)<=K*Math.max(1,Math.abs(i),Math.abs(E))&&Math.abs(a-M)<=K*Math.max(1,Math.abs(a),Math.abs(M))&&Math.abs(o-T)<=K*Math.max(1,Math.abs(o),Math.abs(T))&&Math.abs(c-v)<=K*Math.max(1,Math.abs(c),Math.abs(v))&&Math.abs(f-D)<=K*Math.max(1,Math.abs(f),Math.abs(D))&&Math.abs(h-R)<=K*Math.max(1,Math.abs(h),Math.abs(R))}var _u=Ci,wu=Oi,Au=Object.freeze({__proto__:null,add:yu,adjoint:au,clone:Ql,copy:eu,create:Ni,determinant:ou,equals:Iu,exactEquals:Ru,frob:Tu,fromMat2d:pu,fromMat4:Zl,fromQuat:gu,fromRotation:hu,fromScaling:du,fromTranslation:uu,fromValues:tu,identity:nu,invert:iu,mul:_u,multiply:Ci,multiplyScalar:Eu,multiplyScalarAndAdd:Mu,normalFromMat4:mu,projection:vu,rotate:fu,scale:lu,set:ru,str:xu,sub:wu,subtract:Oi,translate:cu,transpose:su});function bu(){var t=new te(16);return te!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0),t[0]=1,t[5]=1,t[10]=1,t[15]=1,t}function Su(t){var e=new te(16);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e}function Nu(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function Cu(t,e,r,n,s,i,a,o,c,f,h,d,p,g,E,M){var T=new te(16);return T[0]=t,T[1]=e,T[2]=r,T[3]=n,T[4]=s,T[5]=i,T[6]=a,T[7]=o,T[8]=c,T[9]=f,T[10]=h,T[11]=d,T[12]=p,T[13]=g,T[14]=E,T[15]=M,T}function Ou(t,e,r,n,s,i,a,o,c,f,h,d,p,g,E,M,T){return t[0]=e,t[1]=r,t[2]=n,t[3]=s,t[4]=i,t[5]=a,t[6]=o,t[7]=c,t[8]=f,t[9]=h,t[10]=d,t[11]=p,t[12]=g,t[13]=E,t[14]=M,t[15]=T,t}function Di(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function Du(t,e){if(t===e){var r=e[1],n=e[2],s=e[3],i=e[6],a=e[7],o=e[11];t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=r,t[6]=e[9],t[7]=e[13],t[8]=n,t[9]=i,t[11]=e[14],t[12]=s,t[13]=a,t[14]=o}else t[0]=e[0],t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=e[1],t[5]=e[5],t[6]=e[9],t[7]=e[13],t[8]=e[2],t[9]=e[6],t[10]=e[10],t[11]=e[14],t[12]=e[3],t[13]=e[7],t[14]=e[11],t[15]=e[15];return t}function Fu(t,e){var r=e[0],n=e[1],s=e[2],i=e[3],a=e[4],o=e[5],c=e[6],f=e[7],h=e[8],d=e[9],p=e[10],g=e[11],E=e[12],M=e[13],T=e[14],v=e[15],D=r*o-n*a,R=r*c-s*a,w=r*f-i*a,A=n*c-s*o,S=n*f-i*o,x=s*f-i*c,I=h*M-d*E,b=h*T-p*E,N=h*v-g*E,B=d*T-p*M,U=d*v-g*M,V=p*v-g*T,z=D*V-R*U+w*B+A*N-S*b+x*I;return z?(z=1/z,t[0]=(o*V-c*U+f*B)*z,t[1]=(s*U-n*V-i*B)*z,t[2]=(M*x-T*S+v*A)*z,t[3]=(p*S-d*x-g*A)*z,t[4]=(c*N-a*V-f*b)*z,t[5]=(r*V-s*N+i*b)*z,t[6]=(T*w-E*x-v*R)*z,t[7]=(h*x-p*w+g*R)*z,t[8]=(a*U-o*N+f*I)*z,t[9]=(n*N-r*U-i*I)*z,t[10]=(E*S-M*w+v*D)*z,t[11]=(d*w-h*S-g*D)*z,t[12]=(o*b-a*B-c*I)*z,t[13]=(r*B-n*b+s*I)*z,t[14]=(M*R-E*A-T*D)*z,t[15]=(h*A-d*R+p*D)*z,t):null}function $u(t,e){var r=e[0],n=e[1],s=e[2],i=e[3],a=e[4],o=e[5],c=e[6],f=e[7],h=e[8],d=e[9],p=e[10],g=e[11],E=e[12],M=e[13],T=e[14],v=e[15],D=r*o-n*a,R=r*c-s*a,w=r*f-i*a,A=n*c-s*o,S=n*f-i*o,x=s*f-i*c,I=h*M-d*E,b=h*T-p*E,N=h*v-g*E,B=d*T-p*M,U=d*v-g*M,V=p*v-g*T;return t[0]=o*V-c*U+f*B,t[1]=s*U-n*V-i*B,t[2]=M*x-T*S+v*A,t[3]=p*S-d*x-g*A,t[4]=c*N-a*V-f*b,t[5]=r*V-s*N+i*b,t[6]=T*w-E*x-v*R,t[7]=h*x-p*w+g*R,t[8]=a*U-o*N+f*I,t[9]=n*N-r*U-i*I,t[10]=E*S-M*w+v*D,t[11]=d*w-h*S-g*D,t[12]=o*b-a*B-c*I,t[13]=r*B-n*b+s*I,t[14]=M*R-E*A-T*D,t[15]=h*A-d*R+p*D,t}function Pu(t){var e=t[0],r=t[1],n=t[2],s=t[3],i=t[4],a=t[5],o=t[6],c=t[7],f=t[8],h=t[9],d=t[10],p=t[11],g=t[12],E=t[13],M=t[14],T=t[15],v=e*a-r*i,D=e*o-n*i,R=r*o-n*a,w=f*E-h*g,A=f*M-d*g,S=h*M-d*E,x=e*S-r*A+n*w,I=i*S-a*A+o*w,b=f*R-h*D+d*v,N=g*R-E*D+M*v;return c*x-s*I+T*b-p*N}function Fi(t,e,r){var n=e[0],s=e[1],i=e[2],a=e[3],o=e[4],c=e[5],f=e[6],h=e[7],d=e[8],p=e[9],g=e[10],E=e[11],M=e[12],T=e[13],v=e[14],D=e[15],R=r[0],w=r[1],A=r[2],S=r[3];return t[0]=R*n+w*o+A*d+S*M,t[1]=R*s+w*c+A*p+S*T,t[2]=R*i+w*f+A*g+S*v,t[3]=R*a+w*h+A*E+S*D,R=r[4],w=r[5],A=r[6],S=r[7],t[4]=R*n+w*o+A*d+S*M,t[5]=R*s+w*c+A*p+S*T,t[6]=R*i+w*f+A*g+S*v,t[7]=R*a+w*h+A*E+S*D,R=r[8],w=r[9],A=r[10],S=r[11],t[8]=R*n+w*o+A*d+S*M,t[9]=R*s+w*c+A*p+S*T,t[10]=R*i+w*f+A*g+S*v,t[11]=R*a+w*h+A*E+S*D,R=r[12],w=r[13],A=r[14],S=r[15],t[12]=R*n+w*o+A*d+S*M,t[13]=R*s+w*c+A*p+S*T,t[14]=R*i+w*f+A*g+S*v,t[15]=R*a+w*h+A*E+S*D,t}function Uu(t,e,r){var n=r[0],s=r[1],i=r[2],a,o,c,f,h,d,p,g,E,M,T,v;return e===t?(t[12]=e[0]*n+e[4]*s+e[8]*i+e[12],t[13]=e[1]*n+e[5]*s+e[9]*i+e[13],t[14]=e[2]*n+e[6]*s+e[10]*i+e[14],t[15]=e[3]*n+e[7]*s+e[11]*i+e[15]):(a=e[0],o=e[1],c=e[2],f=e[3],h=e[4],d=e[5],p=e[6],g=e[7],E=e[8],M=e[9],T=e[10],v=e[11],t[0]=a,t[1]=o,t[2]=c,t[3]=f,t[4]=h,t[5]=d,t[6]=p,t[7]=g,t[8]=E,t[9]=M,t[10]=T,t[11]=v,t[12]=a*n+h*s+E*i+e[12],t[13]=o*n+d*s+M*i+e[13],t[14]=c*n+p*s+T*i+e[14],t[15]=f*n+g*s+v*i+e[15]),t}function Lu(t,e,r){var n=r[0],s=r[1],i=r[2];return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t[4]=e[4]*s,t[5]=e[5]*s,t[6]=e[6]*s,t[7]=e[7]*s,t[8]=e[8]*i,t[9]=e[9]*i,t[10]=e[10]*i,t[11]=e[11]*i,t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function Bu(t,e,r,n){var s=n[0],i=n[1],a=n[2],o=Math.sqrt(s*s+i*i+a*a),c,f,h,d,p,g,E,M,T,v,D,R,w,A,S,x,I,b,N,B,U,V,z,X;return o<K?null:(o=1/o,s*=o,i*=o,a*=o,c=Math.sin(r),f=Math.cos(r),h=1-f,d=e[0],p=e[1],g=e[2],E=e[3],M=e[4],T=e[5],v=e[6],D=e[7],R=e[8],w=e[9],A=e[10],S=e[11],x=s*s*h+f,I=i*s*h+a*c,b=a*s*h-i*c,N=s*i*h-a*c,B=i*i*h+f,U=a*i*h+s*c,V=s*a*h+i*c,z=i*a*h-s*c,X=a*a*h+f,t[0]=d*x+M*I+R*b,t[1]=p*x+T*I+w*b,t[2]=g*x+v*I+A*b,t[3]=E*x+D*I+S*b,t[4]=d*N+M*B+R*U,t[5]=p*N+T*B+w*U,t[6]=g*N+v*B+A*U,t[7]=E*N+D*B+S*U,t[8]=d*V+M*z+R*X,t[9]=p*V+T*z+w*X,t[10]=g*V+v*z+A*X,t[11]=E*V+D*z+S*X,e!==t&&(t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t)}function ju(t,e,r){var n=Math.sin(r),s=Math.cos(r),i=e[4],a=e[5],o=e[6],c=e[7],f=e[8],h=e[9],d=e[10],p=e[11];return e!==t&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[4]=i*s+f*n,t[5]=a*s+h*n,t[6]=o*s+d*n,t[7]=c*s+p*n,t[8]=f*s-i*n,t[9]=h*s-a*n,t[10]=d*s-o*n,t[11]=p*s-c*n,t}function Vu(t,e,r){var n=Math.sin(r),s=Math.cos(r),i=e[0],a=e[1],o=e[2],c=e[3],f=e[8],h=e[9],d=e[10],p=e[11];return e!==t&&(t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=i*s-f*n,t[1]=a*s-h*n,t[2]=o*s-d*n,t[3]=c*s-p*n,t[8]=i*n+f*s,t[9]=a*n+h*s,t[10]=o*n+d*s,t[11]=c*n+p*s,t}function zu(t,e,r){var n=Math.sin(r),s=Math.cos(r),i=e[0],a=e[1],o=e[2],c=e[3],f=e[4],h=e[5],d=e[6],p=e[7];return e!==t&&(t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=i*s+f*n,t[1]=a*s+h*n,t[2]=o*s+d*n,t[3]=c*s+p*n,t[4]=f*s-i*n,t[5]=h*s-a*n,t[6]=d*s-o*n,t[7]=p*s-c*n,t}function ku(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=e[0],t[13]=e[1],t[14]=e[2],t[15]=1,t}function Gu(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=e[1],t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=e[2],t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function Hu(t,e,r){var n=r[0],s=r[1],i=r[2],a=Math.sqrt(n*n+s*s+i*i),o,c,f;return a<K?null:(a=1/a,n*=a,s*=a,i*=a,o=Math.sin(e),c=Math.cos(e),f=1-c,t[0]=n*n*f+c,t[1]=s*n*f+i*o,t[2]=i*n*f-s*o,t[3]=0,t[4]=n*s*f-i*o,t[5]=s*s*f+c,t[6]=i*s*f+n*o,t[7]=0,t[8]=n*i*f+s*o,t[9]=s*i*f-n*o,t[10]=i*i*f+c,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t)}function qu(t,e){var r=Math.sin(e),n=Math.cos(e);return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=n,t[6]=r,t[7]=0,t[8]=0,t[9]=-r,t[10]=n,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function Wu(t,e){var r=Math.sin(e),n=Math.cos(e);return t[0]=n,t[1]=0,t[2]=-r,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=r,t[9]=0,t[10]=n,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function Xu(t,e){var r=Math.sin(e),n=Math.cos(e);return t[0]=n,t[1]=r,t[2]=0,t[3]=0,t[4]=-r,t[5]=n,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function $i(t,e,r){var n=e[0],s=e[1],i=e[2],a=e[3],o=n+n,c=s+s,f=i+i,h=n*o,d=n*c,p=n*f,g=s*c,E=s*f,M=i*f,T=a*o,v=a*c,D=a*f;return t[0]=1-(g+M),t[1]=d+D,t[2]=p-v,t[3]=0,t[4]=d-D,t[5]=1-(h+M),t[6]=E+T,t[7]=0,t[8]=p+v,t[9]=E-T,t[10]=1-(h+g),t[11]=0,t[12]=r[0],t[13]=r[1],t[14]=r[2],t[15]=1,t}function Ku(t,e){var r=new te(3),n=-e[0],s=-e[1],i=-e[2],a=e[3],o=e[4],c=e[5],f=e[6],h=e[7],d=n*n+s*s+i*i+a*a;return d>0?(r[0]=(o*a+h*n+c*i-f*s)*2/d,r[1]=(c*a+h*s+f*n-o*i)*2/d,r[2]=(f*a+h*i+o*s-c*n)*2/d):(r[0]=(o*a+h*n+c*i-f*s)*2,r[1]=(c*a+h*s+f*n-o*i)*2,r[2]=(f*a+h*i+o*s-c*n)*2),$i(t,e,r),t}function Pi(t,e){return t[0]=e[12],t[1]=e[13],t[2]=e[14],t}function Ui(t,e){var r=e[0],n=e[1],s=e[2],i=e[4],a=e[5],o=e[6],c=e[8],f=e[9],h=e[10];return t[0]=Math.sqrt(r*r+n*n+s*s),t[1]=Math.sqrt(i*i+a*a+o*o),t[2]=Math.sqrt(c*c+f*f+h*h),t}function Li(t,e){var r=new te(3);Ui(r,e);var n=1/r[0],s=1/r[1],i=1/r[2],a=e[0]*n,o=e[1]*s,c=e[2]*i,f=e[4]*n,h=e[5]*s,d=e[6]*i,p=e[8]*n,g=e[9]*s,E=e[10]*i,M=a+h+E,T=0;return M>0?(T=Math.sqrt(M+1)*2,t[3]=.25*T,t[0]=(d-g)/T,t[1]=(p-c)/T,t[2]=(o-f)/T):a>h&&a>E?(T=Math.sqrt(1+a-h-E)*2,t[3]=(d-g)/T,t[0]=.25*T,t[1]=(o+f)/T,t[2]=(p+c)/T):h>E?(T=Math.sqrt(1+h-a-E)*2,t[3]=(p-c)/T,t[0]=(o+f)/T,t[1]=.25*T,t[2]=(d+g)/T):(T=Math.sqrt(1+E-a-h)*2,t[3]=(o-f)/T,t[0]=(p+c)/T,t[1]=(d+g)/T,t[2]=.25*T),t}function Yu(t,e,r,n){e[0]=n[12],e[1]=n[13],e[2]=n[14];var s=n[0],i=n[1],a=n[2],o=n[4],c=n[5],f=n[6],h=n[8],d=n[9],p=n[10];r[0]=Math.sqrt(s*s+i*i+a*a),r[1]=Math.sqrt(o*o+c*c+f*f),r[2]=Math.sqrt(h*h+d*d+p*p);var g=1/r[0],E=1/r[1],M=1/r[2],T=s*g,v=i*E,D=a*M,R=o*g,w=c*E,A=f*M,S=h*g,x=d*E,I=p*M,b=T+w+I,N=0;return b>0?(N=Math.sqrt(b+1)*2,t[3]=.25*N,t[0]=(A-x)/N,t[1]=(S-D)/N,t[2]=(v-R)/N):T>w&&T>I?(N=Math.sqrt(1+T-w-I)*2,t[3]=(A-x)/N,t[0]=.25*N,t[1]=(v+R)/N,t[2]=(S+D)/N):w>I?(N=Math.sqrt(1+w-T-I)*2,t[3]=(S-D)/N,t[0]=(v+R)/N,t[1]=.25*N,t[2]=(A+x)/N):(N=Math.sqrt(1+I-T-w)*2,t[3]=(v-R)/N,t[0]=(S+D)/N,t[1]=(A+x)/N,t[2]=.25*N),t}function Ju(t,e,r,n){var s=e[0],i=e[1],a=e[2],o=e[3],c=s+s,f=i+i,h=a+a,d=s*c,p=s*f,g=s*h,E=i*f,M=i*h,T=a*h,v=o*c,D=o*f,R=o*h,w=n[0],A=n[1],S=n[2];return t[0]=(1-(E+T))*w,t[1]=(p+R)*w,t[2]=(g-D)*w,t[3]=0,t[4]=(p-R)*A,t[5]=(1-(d+T))*A,t[6]=(M+v)*A,t[7]=0,t[8]=(g+D)*S,t[9]=(M-v)*S,t[10]=(1-(d+E))*S,t[11]=0,t[12]=r[0],t[13]=r[1],t[14]=r[2],t[15]=1,t}function Zu(t,e,r,n,s){var i=e[0],a=e[1],o=e[2],c=e[3],f=i+i,h=a+a,d=o+o,p=i*f,g=i*h,E=i*d,M=a*h,T=a*d,v=o*d,D=c*f,R=c*h,w=c*d,A=n[0],S=n[1],x=n[2],I=s[0],b=s[1],N=s[2],B=(1-(M+v))*A,U=(g+w)*A,V=(E-R)*A,z=(g-w)*S,X=(1-(p+v))*S,Y=(T+D)*S,J=(E+R)*x,re=(T-D)*x,ae=(1-(p+M))*x;return t[0]=B,t[1]=U,t[2]=V,t[3]=0,t[4]=z,t[5]=X,t[6]=Y,t[7]=0,t[8]=J,t[9]=re,t[10]=ae,t[11]=0,t[12]=r[0]+I-(B*I+z*b+J*N),t[13]=r[1]+b-(U*I+X*b+re*N),t[14]=r[2]+N-(V*I+Y*b+ae*N),t[15]=1,t}function Qu(t,e){var r=e[0],n=e[1],s=e[2],i=e[3],a=r+r,o=n+n,c=s+s,f=r*a,h=n*a,d=n*o,p=s*a,g=s*o,E=s*c,M=i*a,T=i*o,v=i*c;return t[0]=1-d-E,t[1]=h+v,t[2]=p-T,t[3]=0,t[4]=h-v,t[5]=1-f-E,t[6]=g+M,t[7]=0,t[8]=p+T,t[9]=g-M,t[10]=1-f-d,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function eh(t,e,r,n,s,i,a){var o=1/(r-e),c=1/(s-n),f=1/(i-a);return t[0]=i*2*o,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=i*2*c,t[6]=0,t[7]=0,t[8]=(r+e)*o,t[9]=(s+n)*c,t[10]=(a+i)*f,t[11]=-1,t[12]=0,t[13]=0,t[14]=a*i*2*f,t[15]=0,t}function Bi(t,e,r,n,s){var i=1/Math.tan(e/2);if(t[0]=i/r,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=i,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,s!=null&&s!==1/0){var a=1/(n-s);t[10]=(s+n)*a,t[14]=2*s*n*a}else t[10]=-1,t[14]=-2*n;return t}var th=Bi;function rh(t,e,r,n,s){var i=1/Math.tan(e/2);if(t[0]=i/r,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=i,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,s!=null&&s!==1/0){var a=1/(n-s);t[10]=s*a,t[14]=s*n*a}else t[10]=-1,t[14]=-n;return t}function nh(t,e,r,n){var s=Math.tan(e.upDegrees*Math.PI/180),i=Math.tan(e.downDegrees*Math.PI/180),a=Math.tan(e.leftDegrees*Math.PI/180),o=Math.tan(e.rightDegrees*Math.PI/180),c=2/(a+o),f=2/(s+i);return t[0]=c,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=f,t[6]=0,t[7]=0,t[8]=-((a-o)*c*.5),t[9]=(s-i)*f*.5,t[10]=n/(r-n),t[11]=-1,t[12]=0,t[13]=0,t[14]=n*r/(r-n),t[15]=0,t}function ji(t,e,r,n,s,i,a){var o=1/(e-r),c=1/(n-s),f=1/(i-a);return t[0]=-2*o,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*c,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*f,t[11]=0,t[12]=(e+r)*o,t[13]=(s+n)*c,t[14]=(a+i)*f,t[15]=1,t}var sh=ji;function ih(t,e,r,n,s,i,a){var o=1/(e-r),c=1/(n-s),f=1/(i-a);return t[0]=-2*o,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*c,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=f,t[11]=0,t[12]=(e+r)*o,t[13]=(s+n)*c,t[14]=i*f,t[15]=1,t}function ah(t,e,r,n){var s,i,a,o,c,f,h,d,p,g,E=e[0],M=e[1],T=e[2],v=n[0],D=n[1],R=n[2],w=r[0],A=r[1],S=r[2];return Math.abs(E-w)<K&&Math.abs(M-A)<K&&Math.abs(T-S)<K?Di(t):(h=E-w,d=M-A,p=T-S,g=1/Math.sqrt(h*h+d*d+p*p),h*=g,d*=g,p*=g,s=D*p-R*d,i=R*h-v*p,a=v*d-D*h,g=Math.sqrt(s*s+i*i+a*a),g?(g=1/g,s*=g,i*=g,a*=g):(s=0,i=0,a=0),o=d*a-p*i,c=p*s-h*a,f=h*i-d*s,g=Math.sqrt(o*o+c*c+f*f),g?(g=1/g,o*=g,c*=g,f*=g):(o=0,c=0,f=0),t[0]=s,t[1]=o,t[2]=h,t[3]=0,t[4]=i,t[5]=c,t[6]=d,t[7]=0,t[8]=a,t[9]=f,t[10]=p,t[11]=0,t[12]=-(s*E+i*M+a*T),t[13]=-(o*E+c*M+f*T),t[14]=-(h*E+d*M+p*T),t[15]=1,t)}function oh(t,e,r,n){var s=e[0],i=e[1],a=e[2],o=n[0],c=n[1],f=n[2],h=s-r[0],d=i-r[1],p=a-r[2],g=h*h+d*d+p*p;g>0&&(g=1/Math.sqrt(g),h*=g,d*=g,p*=g);var E=c*p-f*d,M=f*h-o*p,T=o*d-c*h;return g=E*E+M*M+T*T,g>0&&(g=1/Math.sqrt(g),E*=g,M*=g,T*=g),t[0]=E,t[1]=M,t[2]=T,t[3]=0,t[4]=d*T-p*M,t[5]=p*E-h*T,t[6]=h*M-d*E,t[7]=0,t[8]=h,t[9]=d,t[10]=p,t[11]=0,t[12]=s,t[13]=i,t[14]=a,t[15]=1,t}function ch(t){return"mat4("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+", "+t[9]+", "+t[10]+", "+t[11]+", "+t[12]+", "+t[13]+", "+t[14]+", "+t[15]+")"}function fh(t){return Math.sqrt(t[0]*t[0]+t[1]*t[1]+t[2]*t[2]+t[3]*t[3]+t[4]*t[4]+t[5]*t[5]+t[6]*t[6]+t[7]*t[7]+t[8]*t[8]+t[9]*t[9]+t[10]*t[10]+t[11]*t[11]+t[12]*t[12]+t[13]*t[13]+t[14]*t[14]+t[15]*t[15])}function lh(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t[2]=e[2]+r[2],t[3]=e[3]+r[3],t[4]=e[4]+r[4],t[5]=e[5]+r[5],t[6]=e[6]+r[6],t[7]=e[7]+r[7],t[8]=e[8]+r[8],t[9]=e[9]+r[9],t[10]=e[10]+r[10],t[11]=e[11]+r[11],t[12]=e[12]+r[12],t[13]=e[13]+r[13],t[14]=e[14]+r[14],t[15]=e[15]+r[15],t}function Vi(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t[2]=e[2]-r[2],t[3]=e[3]-r[3],t[4]=e[4]-r[4],t[5]=e[5]-r[5],t[6]=e[6]-r[6],t[7]=e[7]-r[7],t[8]=e[8]-r[8],t[9]=e[9]-r[9],t[10]=e[10]-r[10],t[11]=e[11]-r[11],t[12]=e[12]-r[12],t[13]=e[13]-r[13],t[14]=e[14]-r[14],t[15]=e[15]-r[15],t}function uh(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t[4]=e[4]*r,t[5]=e[5]*r,t[6]=e[6]*r,t[7]=e[7]*r,t[8]=e[8]*r,t[9]=e[9]*r,t[10]=e[10]*r,t[11]=e[11]*r,t[12]=e[12]*r,t[13]=e[13]*r,t[14]=e[14]*r,t[15]=e[15]*r,t}function hh(t,e,r,n){return t[0]=e[0]+r[0]*n,t[1]=e[1]+r[1]*n,t[2]=e[2]+r[2]*n,t[3]=e[3]+r[3]*n,t[4]=e[4]+r[4]*n,t[5]=e[5]+r[5]*n,t[6]=e[6]+r[6]*n,t[7]=e[7]+r[7]*n,t[8]=e[8]+r[8]*n,t[9]=e[9]+r[9]*n,t[10]=e[10]+r[10]*n,t[11]=e[11]+r[11]*n,t[12]=e[12]+r[12]*n,t[13]=e[13]+r[13]*n,t[14]=e[14]+r[14]*n,t[15]=e[15]+r[15]*n,t}function dh(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]&&t[6]===e[6]&&t[7]===e[7]&&t[8]===e[8]&&t[9]===e[9]&&t[10]===e[10]&&t[11]===e[11]&&t[12]===e[12]&&t[13]===e[13]&&t[14]===e[14]&&t[15]===e[15]}function ph(t,e){var r=t[0],n=t[1],s=t[2],i=t[3],a=t[4],o=t[5],c=t[6],f=t[7],h=t[8],d=t[9],p=t[10],g=t[11],E=t[12],M=t[13],T=t[14],v=t[15],D=e[0],R=e[1],w=e[2],A=e[3],S=e[4],x=e[5],I=e[6],b=e[7],N=e[8],B=e[9],U=e[10],V=e[11],z=e[12],X=e[13],Y=e[14],J=e[15];return Math.abs(r-D)<=K*Math.max(1,Math.abs(r),Math.abs(D))&&Math.abs(n-R)<=K*Math.max(1,Math.abs(n),Math.abs(R))&&Math.abs(s-w)<=K*Math.max(1,Math.abs(s),Math.abs(w))&&Math.abs(i-A)<=K*Math.max(1,Math.abs(i),Math.abs(A))&&Math.abs(a-S)<=K*Math.max(1,Math.abs(a),Math.abs(S))&&Math.abs(o-x)<=K*Math.max(1,Math.abs(o),Math.abs(x))&&Math.abs(c-I)<=K*Math.max(1,Math.abs(c),Math.abs(I))&&Math.abs(f-b)<=K*Math.max(1,Math.abs(f),Math.abs(b))&&Math.abs(h-N)<=K*Math.max(1,Math.abs(h),Math.abs(N))&&Math.abs(d-B)<=K*Math.max(1,Math.abs(d),Math.abs(B))&&Math.abs(p-U)<=K*Math.max(1,Math.abs(p),Math.abs(U))&&Math.abs(g-V)<=K*Math.max(1,Math.abs(g),Math.abs(V))&&Math.abs(E-z)<=K*Math.max(1,Math.abs(E),Math.abs(z))&&Math.abs(M-X)<=K*Math.max(1,Math.abs(M),Math.abs(X))&&Math.abs(T-Y)<=K*Math.max(1,Math.abs(T),Math.abs(Y))&&Math.abs(v-J)<=K*Math.max(1,Math.abs(v),Math.abs(J))}var gh=Fi,mh=Vi,vh=Object.freeze({__proto__:null,add:lh,adjoint:$u,clone:Su,copy:Nu,create:bu,decompose:Yu,determinant:Pu,equals:ph,exactEquals:dh,frob:fh,fromQuat:Qu,fromQuat2:Ku,fromRotation:Hu,fromRotationTranslation:$i,fromRotationTranslationScale:Ju,fromRotationTranslationScaleOrigin:Zu,fromScaling:Gu,fromTranslation:ku,fromValues:Cu,fromXRotation:qu,fromYRotation:Wu,fromZRotation:Xu,frustum:eh,getRotation:Li,getScaling:Ui,getTranslation:Pi,identity:Di,invert:Fu,lookAt:ah,mul:gh,multiply:Fi,multiplyScalar:uh,multiplyScalarAndAdd:hh,ortho:sh,orthoNO:ji,orthoZO:ih,perspective:th,perspectiveFromFieldOfView:nh,perspectiveNO:Bi,perspectiveZO:rh,rotate:Bu,rotateX:ju,rotateY:Vu,rotateZ:zu,scale:Lu,set:Ou,str:ch,sub:mh,subtract:Vi,targetTo:oh,translate:Uu,transpose:Du});function ts(){var t=new te(3);return te!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t}function xh(t){var e=new te(3);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e}function zi(t){var e=t[0],r=t[1],n=t[2];return Math.sqrt(e*e+r*r+n*n)}function jn(t,e,r){var n=new te(3);return n[0]=t,n[1]=e,n[2]=r,n}function Th(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t}function yh(t,e,r,n){return t[0]=e,t[1]=r,t[2]=n,t}function Eh(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t[2]=e[2]+r[2],t}function ki(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t[2]=e[2]-r[2],t}function Gi(t,e,r){return t[0]=e[0]*r[0],t[1]=e[1]*r[1],t[2]=e[2]*r[2],t}function Hi(t,e,r){return t[0]=e[0]/r[0],t[1]=e[1]/r[1],t[2]=e[2]/r[2],t}function Mh(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t[2]=Math.ceil(e[2]),t}function Rh(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t[2]=Math.floor(e[2]),t}function Ih(t,e,r){return t[0]=Math.min(e[0],r[0]),t[1]=Math.min(e[1],r[1]),t[2]=Math.min(e[2],r[2]),t}function _h(t,e,r){return t[0]=Math.max(e[0],r[0]),t[1]=Math.max(e[1],r[1]),t[2]=Math.max(e[2],r[2]),t}function wh(t,e){return t[0]=ct(e[0]),t[1]=ct(e[1]),t[2]=ct(e[2]),t}function Ah(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t}function bh(t,e,r,n){return t[0]=e[0]+r[0]*n,t[1]=e[1]+r[1]*n,t[2]=e[2]+r[2]*n,t}function qi(t,e){var r=e[0]-t[0],n=e[1]-t[1],s=e[2]-t[2];return Math.sqrt(r*r+n*n+s*s)}function Wi(t,e){var r=e[0]-t[0],n=e[1]-t[1],s=e[2]-t[2];return r*r+n*n+s*s}function Xi(t){var e=t[0],r=t[1],n=t[2];return e*e+r*r+n*n}function Sh(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t}function Nh(t,e){return t[0]=1/e[0],t[1]=1/e[1],t[2]=1/e[2],t}function Ki(t,e){var r=e[0],n=e[1],s=e[2],i=r*r+n*n+s*s;return i>0&&(i=1/Math.sqrt(i)),t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t}function un(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}function Jr(t,e,r){var n=e[0],s=e[1],i=e[2],a=r[0],o=r[1],c=r[2];return t[0]=s*c-i*o,t[1]=i*a-n*c,t[2]=n*o-s*a,t}function Ch(t,e,r,n){var s=e[0],i=e[1],a=e[2];return t[0]=s+n*(r[0]-s),t[1]=i+n*(r[1]-i),t[2]=a+n*(r[2]-a),t}function Oh(t,e,r,n){var s=Math.acos(Math.min(Math.max(un(e,r),-1),1)),i=Math.sin(s),a=Math.sin((1-n)*s)/i,o=Math.sin(n*s)/i;return t[0]=a*e[0]+o*r[0],t[1]=a*e[1]+o*r[1],t[2]=a*e[2]+o*r[2],t}function Dh(t,e,r,n,s,i){var a=i*i,o=a*(2*i-3)+1,c=a*(i-2)+i,f=a*(i-1),h=a*(3-2*i);return t[0]=e[0]*o+r[0]*c+n[0]*f+s[0]*h,t[1]=e[1]*o+r[1]*c+n[1]*f+s[1]*h,t[2]=e[2]*o+r[2]*c+n[2]*f+s[2]*h,t}function Fh(t,e,r,n,s,i){var a=1-i,o=a*a,c=i*i,f=o*a,h=3*i*o,d=3*c*a,p=c*i;return t[0]=e[0]*f+r[0]*h+n[0]*d+s[0]*p,t[1]=e[1]*f+r[1]*h+n[1]*d+s[1]*p,t[2]=e[2]*f+r[2]*h+n[2]*d+s[2]*p,t}function $h(t,e){e=e===void 0?1:e;var r=tt()*2*Math.PI,n=tt()*2-1,s=Math.sqrt(1-n*n)*e;return t[0]=Math.cos(r)*s,t[1]=Math.sin(r)*s,t[2]=n*e,t}function Ph(t,e,r){var n=e[0],s=e[1],i=e[2],a=r[3]*n+r[7]*s+r[11]*i+r[15];return a=a||1,t[0]=(r[0]*n+r[4]*s+r[8]*i+r[12])/a,t[1]=(r[1]*n+r[5]*s+r[9]*i+r[13])/a,t[2]=(r[2]*n+r[6]*s+r[10]*i+r[14])/a,t}function Uh(t,e,r){var n=e[0],s=e[1],i=e[2];return t[0]=n*r[0]+s*r[3]+i*r[6],t[1]=n*r[1]+s*r[4]+i*r[7],t[2]=n*r[2]+s*r[5]+i*r[8],t}function Lh(t,e,r){var n=r[0],s=r[1],i=r[2],a=r[3],o=e[0],c=e[1],f=e[2],h=s*f-i*c,d=i*o-n*f,p=n*c-s*o;return h=h+h,d=d+d,p=p+p,t[0]=o+a*h+s*p-i*d,t[1]=c+a*d+i*h-n*p,t[2]=f+a*p+n*d-s*h,t}function Bh(t,e,r,n){var s=[],i=[];return s[0]=e[0]-r[0],s[1]=e[1]-r[1],s[2]=e[2]-r[2],i[0]=s[0],i[1]=s[1]*Math.cos(n)-s[2]*Math.sin(n),i[2]=s[1]*Math.sin(n)+s[2]*Math.cos(n),t[0]=i[0]+r[0],t[1]=i[1]+r[1],t[2]=i[2]+r[2],t}function jh(t,e,r,n){var s=[],i=[];return s[0]=e[0]-r[0],s[1]=e[1]-r[1],s[2]=e[2]-r[2],i[0]=s[2]*Math.sin(n)+s[0]*Math.cos(n),i[1]=s[1],i[2]=s[2]*Math.cos(n)-s[0]*Math.sin(n),t[0]=i[0]+r[0],t[1]=i[1]+r[1],t[2]=i[2]+r[2],t}function Vh(t,e,r,n){var s=[],i=[];return s[0]=e[0]-r[0],s[1]=e[1]-r[1],s[2]=e[2]-r[2],i[0]=s[0]*Math.cos(n)-s[1]*Math.sin(n),i[1]=s[0]*Math.sin(n)+s[1]*Math.cos(n),i[2]=s[2],t[0]=i[0]+r[0],t[1]=i[1]+r[1],t[2]=i[2]+r[2],t}function zh(t,e){var r=t[0],n=t[1],s=t[2],i=e[0],a=e[1],o=e[2],c=Math.sqrt((r*r+n*n+s*s)*(i*i+a*a+o*o)),f=c&&un(t,e)/c;return Math.acos(Math.min(Math.max(f,-1),1))}function kh(t){return t[0]=0,t[1]=0,t[2]=0,t}function Gh(t){return"vec3("+t[0]+", "+t[1]+", "+t[2]+")"}function Hh(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]}function qh(t,e){var r=t[0],n=t[1],s=t[2],i=e[0],a=e[1],o=e[2];return Math.abs(r-i)<=K*Math.max(1,Math.abs(r),Math.abs(i))&&Math.abs(n-a)<=K*Math.max(1,Math.abs(n),Math.abs(a))&&Math.abs(s-o)<=K*Math.max(1,Math.abs(s),Math.abs(o))}var Wh=ki,Xh=Gi,Kh=Hi,Yh=qi,Jh=Wi,Yi=zi,Zh=Xi,Qh=(function(){var t=ts();return function(e,r,n,s,i,a){var o,c;for(r||(r=3),n||(n=0),s?c=Math.min(s*r+n,e.length):c=e.length,o=n;o<c;o+=r)t[0]=e[o],t[1]=e[o+1],t[2]=e[o+2],i(t,t,a),e[o]=t[0],e[o+1]=t[1],e[o+2]=t[2];return e}})(),ed=Object.freeze({__proto__:null,add:Eh,angle:zh,bezier:Fh,ceil:Mh,clone:xh,copy:Th,create:ts,cross:Jr,dist:Yh,distance:qi,div:Kh,divide:Hi,dot:un,equals:qh,exactEquals:Hh,floor:Rh,forEach:Qh,fromValues:jn,hermite:Dh,inverse:Nh,len:Yi,length:zi,lerp:Ch,max:_h,min:Ih,mul:Xh,multiply:Gi,negate:Sh,normalize:Ki,random:$h,rotateX:Bh,rotateY:jh,rotateZ:Vh,round:wh,scale:Ah,scaleAndAdd:bh,set:yh,slerp:Oh,sqrDist:Jh,sqrLen:Zh,squaredDistance:Wi,squaredLength:Xi,str:Gh,sub:Wh,subtract:ki,transformMat3:Uh,transformMat4:Ph,transformQuat:Lh,zero:kh});function Ji(){var t=new te(4);return te!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0,t[3]=0),t}function Zi(t){var e=new te(4);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e}function Qi(t,e,r,n){var s=new te(4);return s[0]=t,s[1]=e,s[2]=r,s[3]=n,s}function ea(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t}function ta(t,e,r,n,s){return t[0]=e,t[1]=r,t[2]=n,t[3]=s,t}function ra(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t[2]=e[2]+r[2],t[3]=e[3]+r[3],t}function na(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t[2]=e[2]-r[2],t[3]=e[3]-r[3],t}function sa(t,e,r){return t[0]=e[0]*r[0],t[1]=e[1]*r[1],t[2]=e[2]*r[2],t[3]=e[3]*r[3],t}function ia(t,e,r){return t[0]=e[0]/r[0],t[1]=e[1]/r[1],t[2]=e[2]/r[2],t[3]=e[3]/r[3],t}function td(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t[2]=Math.ceil(e[2]),t[3]=Math.ceil(e[3]),t}function rd(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t[2]=Math.floor(e[2]),t[3]=Math.floor(e[3]),t}function nd(t,e,r){return t[0]=Math.min(e[0],r[0]),t[1]=Math.min(e[1],r[1]),t[2]=Math.min(e[2],r[2]),t[3]=Math.min(e[3],r[3]),t}function sd(t,e,r){return t[0]=Math.max(e[0],r[0]),t[1]=Math.max(e[1],r[1]),t[2]=Math.max(e[2],r[2]),t[3]=Math.max(e[3],r[3]),t}function id(t,e){return t[0]=ct(e[0]),t[1]=ct(e[1]),t[2]=ct(e[2]),t[3]=ct(e[3]),t}function aa(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t}function ad(t,e,r,n){return t[0]=e[0]+r[0]*n,t[1]=e[1]+r[1]*n,t[2]=e[2]+r[2]*n,t[3]=e[3]+r[3]*n,t}function oa(t,e){var r=e[0]-t[0],n=e[1]-t[1],s=e[2]-t[2],i=e[3]-t[3];return Math.sqrt(r*r+n*n+s*s+i*i)}function ca(t,e){var r=e[0]-t[0],n=e[1]-t[1],s=e[2]-t[2],i=e[3]-t[3];return r*r+n*n+s*s+i*i}function rs(t){var e=t[0],r=t[1],n=t[2],s=t[3];return Math.sqrt(e*e+r*r+n*n+s*s)}function ns(t){var e=t[0],r=t[1],n=t[2],s=t[3];return e*e+r*r+n*n+s*s}function od(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=-e[3],t}function cd(t,e){return t[0]=1/e[0],t[1]=1/e[1],t[2]=1/e[2],t[3]=1/e[3],t}function fa(t,e){var r=e[0],n=e[1],s=e[2],i=e[3],a=r*r+n*n+s*s+i*i;return a>0&&(a=1/Math.sqrt(a)),t[0]=r*a,t[1]=n*a,t[2]=s*a,t[3]=i*a,t}function ss(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]+t[3]*e[3]}function fd(t,e,r,n){var s=r[0]*n[1]-r[1]*n[0],i=r[0]*n[2]-r[2]*n[0],a=r[0]*n[3]-r[3]*n[0],o=r[1]*n[2]-r[2]*n[1],c=r[1]*n[3]-r[3]*n[1],f=r[2]*n[3]-r[3]*n[2],h=e[0],d=e[1],p=e[2],g=e[3];return t[0]=d*f-p*c+g*o,t[1]=-(h*f)+p*a-g*i,t[2]=h*c-d*a+g*s,t[3]=-(h*o)+d*i-p*s,t}function la(t,e,r,n){var s=e[0],i=e[1],a=e[2],o=e[3];return t[0]=s+n*(r[0]-s),t[1]=i+n*(r[1]-i),t[2]=a+n*(r[2]-a),t[3]=o+n*(r[3]-o),t}function ld(t,e){e=e===void 0?1:e;var r,n,s,i,a,o,c;c=tt(),r=c*2-1,n=(4*tt()-2)*Math.sqrt(c*-c+c),a=r*r+n*n,c=tt(),s=c*2-1,i=(4*tt()-2)*Math.sqrt(c*-c+c),o=s*s+i*i;var f=Math.sqrt((1-a)/o);return t[0]=e*r,t[1]=e*n,t[2]=e*s*f,t[3]=e*i*f,t}function ud(t,e,r){var n=e[0],s=e[1],i=e[2],a=e[3];return t[0]=r[0]*n+r[4]*s+r[8]*i+r[12]*a,t[1]=r[1]*n+r[5]*s+r[9]*i+r[13]*a,t[2]=r[2]*n+r[6]*s+r[10]*i+r[14]*a,t[3]=r[3]*n+r[7]*s+r[11]*i+r[15]*a,t}function hd(t,e,r){var n=r[0],s=r[1],i=r[2],a=r[3],o=e[0],c=e[1],f=e[2],h=s*f-i*c,d=i*o-n*f,p=n*c-s*o;return h=h+h,d=d+d,p=p+p,t[0]=o+a*h+s*p-i*d,t[1]=c+a*d+i*h-n*p,t[2]=f+a*p+n*d-s*h,t[3]=e[3],t}function dd(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=0,t}function pd(t){return"vec4("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"}function ua(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]}function gd(t,e){var r=t[0],n=t[1],s=t[2],i=t[3],a=e[0],o=e[1],c=e[2],f=e[3];return Math.abs(r-a)<=K*Math.max(1,Math.abs(r),Math.abs(a))&&Math.abs(n-o)<=K*Math.max(1,Math.abs(n),Math.abs(o))&&Math.abs(s-c)<=K*Math.max(1,Math.abs(s),Math.abs(c))&&Math.abs(i-f)<=K*Math.max(1,Math.abs(i),Math.abs(f))}var md=na,vd=sa,xd=ia,Td=oa,yd=ca,Ed=rs,Md=ns,Rd=(function(){var t=Ji();return function(e,r,n,s,i,a){var o,c;for(r||(r=4),n||(n=0),s?c=Math.min(s*r+n,e.length):c=e.length,o=n;o<c;o+=r)t[0]=e[o],t[1]=e[o+1],t[2]=e[o+2],t[3]=e[o+3],i(t,t,a),e[o]=t[0],e[o+1]=t[1],e[o+2]=t[2],e[o+3]=t[3];return e}})(),Id=Object.freeze({__proto__:null,add:ra,ceil:td,clone:Zi,copy:ea,create:Ji,cross:fd,dist:Td,distance:oa,div:xd,divide:ia,dot:ss,equals:gd,exactEquals:ua,floor:rd,forEach:Rd,fromValues:Qi,inverse:cd,len:Ed,length:rs,lerp:la,max:sd,min:nd,mul:vd,multiply:sa,negate:od,normalize:fa,random:ld,round:id,scale:aa,scaleAndAdd:ad,set:ta,sqrDist:yd,sqrLen:Md,squaredDistance:ca,squaredLength:ns,str:pd,sub:md,subtract:na,transformMat4:ud,transformQuat:hd,zero:dd});function rn(){var t=new te(4);return te!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t[3]=1,t}function _d(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t}function ha(t,e,r){r=r*.5;var n=Math.sin(r);return t[0]=n*e[0],t[1]=n*e[1],t[2]=n*e[2],t[3]=Math.cos(r),t}function wd(t,e){var r=Math.acos(e[3])*2,n=Math.sin(r/2);return n>K?(t[0]=e[0]/n,t[1]=e[1]/n,t[2]=e[2]/n):(t[0]=1,t[1]=0,t[2]=0),r}function Ad(t,e){var r=as(t,e);return Math.acos(2*r*r-1)}function da(t,e,r){var n=e[0],s=e[1],i=e[2],a=e[3],o=r[0],c=r[1],f=r[2],h=r[3];return t[0]=n*h+a*o+s*f-i*c,t[1]=s*h+a*c+i*o-n*f,t[2]=i*h+a*f+n*c-s*o,t[3]=a*h-n*o-s*c-i*f,t}function pa(t,e,r){r*=.5;var n=e[0],s=e[1],i=e[2],a=e[3],o=Math.sin(r),c=Math.cos(r);return t[0]=n*c+a*o,t[1]=s*c+i*o,t[2]=i*c-s*o,t[3]=a*c-n*o,t}function ga(t,e,r){r*=.5;var n=e[0],s=e[1],i=e[2],a=e[3],o=Math.sin(r),c=Math.cos(r);return t[0]=n*c-i*o,t[1]=s*c+a*o,t[2]=i*c+n*o,t[3]=a*c-s*o,t}function ma(t,e,r){r*=.5;var n=e[0],s=e[1],i=e[2],a=e[3],o=Math.sin(r),c=Math.cos(r);return t[0]=n*c+s*o,t[1]=s*c-n*o,t[2]=i*c+a*o,t[3]=a*c-i*o,t}function bd(t,e){var r=e[0],n=e[1],s=e[2];return t[0]=r,t[1]=n,t[2]=s,t[3]=Math.sqrt(Math.abs(1-r*r-n*n-s*s)),t}function va(t,e){var r=e[0],n=e[1],s=e[2],i=e[3],a=Math.sqrt(r*r+n*n+s*s),o=Math.exp(i),c=a>0?o*Math.sin(a)/a:0;return t[0]=r*c,t[1]=n*c,t[2]=s*c,t[3]=o*Math.cos(a),t}function xa(t,e){var r=e[0],n=e[1],s=e[2],i=e[3],a=Math.sqrt(r*r+n*n+s*s),o=a>0?Math.atan2(a,i)/a:0;return t[0]=r*o,t[1]=n*o,t[2]=s*o,t[3]=.5*Math.log(r*r+n*n+s*s+i*i),t}function Sd(t,e,r){return xa(t,e),ya(t,t,r),va(t,t),t}function Zr(t,e,r,n){var s=e[0],i=e[1],a=e[2],o=e[3],c=r[0],f=r[1],h=r[2],d=r[3],p,g,E,M,T;return g=s*c+i*f+a*h+o*d,g<0&&(g=-g,c=-c,f=-f,h=-h,d=-d),1-g>K?(p=Math.acos(g),E=Math.sin(p),M=Math.sin((1-n)*p)/E,T=Math.sin(n*p)/E):(M=1-n,T=n),t[0]=M*s+T*c,t[1]=M*i+T*f,t[2]=M*a+T*h,t[3]=M*o+T*d,t}function Nd(t){var e=tt(),r=tt(),n=tt(),s=Math.sqrt(1-e),i=Math.sqrt(e);return t[0]=s*Math.sin(2*Math.PI*r),t[1]=s*Math.cos(2*Math.PI*r),t[2]=i*Math.sin(2*Math.PI*n),t[3]=i*Math.cos(2*Math.PI*n),t}function Cd(t,e){var r=e[0],n=e[1],s=e[2],i=e[3],a=r*r+n*n+s*s+i*i,o=a?1/a:0;return t[0]=-r*o,t[1]=-n*o,t[2]=-s*o,t[3]=i*o,t}function Od(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=e[3],t}function Ta(t,e){var r=e[0]+e[4]+e[8],n;if(r>0)n=Math.sqrt(r+1),t[3]=.5*n,n=.5/n,t[0]=(e[5]-e[7])*n,t[1]=(e[6]-e[2])*n,t[2]=(e[1]-e[3])*n;else{var s=0;e[4]>e[0]&&(s=1),e[8]>e[s*3+s]&&(s=2);var i=(s+1)%3,a=(s+2)%3;n=Math.sqrt(e[s*3+s]-e[i*3+i]-e[a*3+a]+1),t[s]=.5*n,n=.5/n,t[3]=(e[i*3+a]-e[a*3+i])*n,t[i]=(e[i*3+s]+e[s*3+i])*n,t[a]=(e[a*3+s]+e[s*3+a])*n}return t}function Dd(t,e,r,n){var s=arguments.length>4&&arguments[4]!==void 0?arguments[4]:Ii,i=Math.PI/360;e*=i,n*=i,r*=i;var a=Math.sin(e),o=Math.cos(e),c=Math.sin(r),f=Math.cos(r),h=Math.sin(n),d=Math.cos(n);switch(s){case"xyz":t[0]=a*f*d+o*c*h,t[1]=o*c*d-a*f*h,t[2]=o*f*h+a*c*d,t[3]=o*f*d-a*c*h;break;case"xzy":t[0]=a*f*d-o*c*h,t[1]=o*c*d-a*f*h,t[2]=o*f*h+a*c*d,t[3]=o*f*d+a*c*h;break;case"yxz":t[0]=a*f*d+o*c*h,t[1]=o*c*d-a*f*h,t[2]=o*f*h-a*c*d,t[3]=o*f*d+a*c*h;break;case"yzx":t[0]=a*f*d+o*c*h,t[1]=o*c*d+a*f*h,t[2]=o*f*h-a*c*d,t[3]=o*f*d-a*c*h;break;case"zxy":t[0]=a*f*d-o*c*h,t[1]=o*c*d+a*f*h,t[2]=o*f*h+a*c*d,t[3]=o*f*d-a*c*h;break;case"zyx":t[0]=a*f*d-o*c*h,t[1]=o*c*d+a*f*h,t[2]=o*f*h-a*c*d,t[3]=o*f*d+a*c*h;break;default:throw new Error("Unknown angle order "+s)}return t}function Fd(t){return"quat("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"}var $d=Zi,Pd=Qi,is=ea,Ud=ta,Ld=ra,Bd=da,ya=aa,as=ss,jd=la,os=rs,Vd=os,cs=ns,zd=cs,fs=fa,kd=ua;function Gd(t,e){return Math.abs(ss(t,e))>=1-K}var Hd=(function(){var t=ts(),e=jn(1,0,0),r=jn(0,1,0);return function(n,s,i){var a=un(s,i);return a<-.999999?(Jr(t,e,s),Yi(t)<1e-6&&Jr(t,r,s),Ki(t,t),ha(n,t,Math.PI),n):a>.999999?(n[0]=0,n[1]=0,n[2]=0,n[3]=1,n):(Jr(t,s,i),n[0]=t[0],n[1]=t[1],n[2]=t[2],n[3]=1+a,fs(n,n))}})(),qd=(function(){var t=rn(),e=rn();return function(r,n,s,i,a,o){return Zr(t,n,a,o),Zr(e,s,i,o),Zr(r,t,e,2*o*(1-o)),r}})(),Wd=(function(){var t=Ni();return function(e,r,n,s){return t[0]=n[0],t[3]=n[1],t[6]=n[2],t[1]=s[0],t[4]=s[1],t[7]=s[2],t[2]=-r[0],t[5]=-r[1],t[8]=-r[2],fs(e,Ta(e,t))}})(),Xd=Object.freeze({__proto__:null,add:Ld,calculateW:bd,clone:$d,conjugate:Od,copy:is,create:rn,dot:as,equals:Gd,exactEquals:kd,exp:va,fromEuler:Dd,fromMat3:Ta,fromValues:Pd,getAngle:Ad,getAxisAngle:wd,identity:_d,invert:Cd,len:Vd,length:os,lerp:jd,ln:xa,mul:Bd,multiply:da,normalize:fs,pow:Sd,random:Nd,rotateX:pa,rotateY:ga,rotateZ:ma,rotationTo:Hd,scale:ya,set:Ud,setAxes:Wd,setAxisAngle:ha,slerp:Zr,sqlerp:qd,sqrLen:zd,squaredLength:cs,str:Fd});function Kd(){var t=new te(8);return te!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0,t[4]=0,t[5]=0,t[6]=0,t[7]=0),t[3]=1,t}function Yd(t){var e=new te(8);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e}function Jd(t,e,r,n,s,i,a,o){var c=new te(8);return c[0]=t,c[1]=e,c[2]=r,c[3]=n,c[4]=s,c[5]=i,c[6]=a,c[7]=o,c}function Zd(t,e,r,n,s,i,a){var o=new te(8);o[0]=t,o[1]=e,o[2]=r,o[3]=n;var c=s*.5,f=i*.5,h=a*.5;return o[4]=c*n+f*r-h*e,o[5]=f*n+h*t-c*r,o[6]=h*n+c*e-f*t,o[7]=-c*t-f*e-h*r,o}function Ea(t,e,r){var n=r[0]*.5,s=r[1]*.5,i=r[2]*.5,a=e[0],o=e[1],c=e[2],f=e[3];return t[0]=a,t[1]=o,t[2]=c,t[3]=f,t[4]=n*f+s*c-i*o,t[5]=s*f+i*a-n*c,t[6]=i*f+n*o-s*a,t[7]=-n*a-s*o-i*c,t}function Qd(t,e){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t[4]=e[0]*.5,t[5]=e[1]*.5,t[6]=e[2]*.5,t[7]=0,t}function ep(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=0,t[5]=0,t[6]=0,t[7]=0,t}function tp(t,e){var r=rn();Li(r,e);var n=new te(3);return Pi(n,e),Ea(t,r,n),t}function Ma(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t}function rp(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t[4]=0,t[5]=0,t[6]=0,t[7]=0,t}function np(t,e,r,n,s,i,a,o,c){return t[0]=e,t[1]=r,t[2]=n,t[3]=s,t[4]=i,t[5]=a,t[6]=o,t[7]=c,t}var sp=is;function ip(t,e){return t[0]=e[4],t[1]=e[5],t[2]=e[6],t[3]=e[7],t}var ap=is;function op(t,e){return t[4]=e[0],t[5]=e[1],t[6]=e[2],t[7]=e[3],t}function cp(t,e){var r=e[4],n=e[5],s=e[6],i=e[7],a=-e[0],o=-e[1],c=-e[2],f=e[3];return t[0]=(r*f+i*a+n*c-s*o)*2,t[1]=(n*f+i*o+s*a-r*c)*2,t[2]=(s*f+i*c+r*o-n*a)*2,t}function fp(t,e,r){var n=e[0],s=e[1],i=e[2],a=e[3],o=r[0]*.5,c=r[1]*.5,f=r[2]*.5,h=e[4],d=e[5],p=e[6],g=e[7];return t[0]=n,t[1]=s,t[2]=i,t[3]=a,t[4]=a*o+s*f-i*c+h,t[5]=a*c+i*o-n*f+d,t[6]=a*f+n*c-s*o+p,t[7]=-n*o-s*c-i*f+g,t}function lp(t,e,r){var n=-e[0],s=-e[1],i=-e[2],a=e[3],o=e[4],c=e[5],f=e[6],h=e[7],d=o*a+h*n+c*i-f*s,p=c*a+h*s+f*n-o*i,g=f*a+h*i+o*s-c*n,E=h*a-o*n-c*s-f*i;return pa(t,e,r),n=t[0],s=t[1],i=t[2],a=t[3],t[4]=d*a+E*n+p*i-g*s,t[5]=p*a+E*s+g*n-d*i,t[6]=g*a+E*i+d*s-p*n,t[7]=E*a-d*n-p*s-g*i,t}function up(t,e,r){var n=-e[0],s=-e[1],i=-e[2],a=e[3],o=e[4],c=e[5],f=e[6],h=e[7],d=o*a+h*n+c*i-f*s,p=c*a+h*s+f*n-o*i,g=f*a+h*i+o*s-c*n,E=h*a-o*n-c*s-f*i;return ga(t,e,r),n=t[0],s=t[1],i=t[2],a=t[3],t[4]=d*a+E*n+p*i-g*s,t[5]=p*a+E*s+g*n-d*i,t[6]=g*a+E*i+d*s-p*n,t[7]=E*a-d*n-p*s-g*i,t}function hp(t,e,r){var n=-e[0],s=-e[1],i=-e[2],a=e[3],o=e[4],c=e[5],f=e[6],h=e[7],d=o*a+h*n+c*i-f*s,p=c*a+h*s+f*n-o*i,g=f*a+h*i+o*s-c*n,E=h*a-o*n-c*s-f*i;return ma(t,e,r),n=t[0],s=t[1],i=t[2],a=t[3],t[4]=d*a+E*n+p*i-g*s,t[5]=p*a+E*s+g*n-d*i,t[6]=g*a+E*i+d*s-p*n,t[7]=E*a-d*n-p*s-g*i,t}function dp(t,e,r){var n=r[0],s=r[1],i=r[2],a=r[3],o=e[0],c=e[1],f=e[2],h=e[3];return t[0]=o*a+h*n+c*i-f*s,t[1]=c*a+h*s+f*n-o*i,t[2]=f*a+h*i+o*s-c*n,t[3]=h*a-o*n-c*s-f*i,o=e[4],c=e[5],f=e[6],h=e[7],t[4]=o*a+h*n+c*i-f*s,t[5]=c*a+h*s+f*n-o*i,t[6]=f*a+h*i+o*s-c*n,t[7]=h*a-o*n-c*s-f*i,t}function pp(t,e,r){var n=e[0],s=e[1],i=e[2],a=e[3],o=r[0],c=r[1],f=r[2],h=r[3];return t[0]=n*h+a*o+s*f-i*c,t[1]=s*h+a*c+i*o-n*f,t[2]=i*h+a*f+n*c-s*o,t[3]=a*h-n*o-s*c-i*f,o=r[4],c=r[5],f=r[6],h=r[7],t[4]=n*h+a*o+s*f-i*c,t[5]=s*h+a*c+i*o-n*f,t[6]=i*h+a*f+n*c-s*o,t[7]=a*h-n*o-s*c-i*f,t}function gp(t,e,r,n){if(Math.abs(n)<K)return Ma(t,e);var s=Math.sqrt(r[0]*r[0]+r[1]*r[1]+r[2]*r[2]);n=n*.5;var i=Math.sin(n),a=i*r[0]/s,o=i*r[1]/s,c=i*r[2]/s,f=Math.cos(n),h=e[0],d=e[1],p=e[2],g=e[3];t[0]=h*f+g*a+d*c-p*o,t[1]=d*f+g*o+p*a-h*c,t[2]=p*f+g*c+h*o-d*a,t[3]=g*f-h*a-d*o-p*c;var E=e[4],M=e[5],T=e[6],v=e[7];return t[4]=E*f+v*a+M*c-T*o,t[5]=M*f+v*o+T*a-E*c,t[6]=T*f+v*c+E*o-M*a,t[7]=v*f-E*a-M*o-T*c,t}function mp(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t[2]=e[2]+r[2],t[3]=e[3]+r[3],t[4]=e[4]+r[4],t[5]=e[5]+r[5],t[6]=e[6]+r[6],t[7]=e[7]+r[7],t}function Ra(t,e,r){var n=e[0],s=e[1],i=e[2],a=e[3],o=r[4],c=r[5],f=r[6],h=r[7],d=e[4],p=e[5],g=e[6],E=e[7],M=r[0],T=r[1],v=r[2],D=r[3];return t[0]=n*D+a*M+s*v-i*T,t[1]=s*D+a*T+i*M-n*v,t[2]=i*D+a*v+n*T-s*M,t[3]=a*D-n*M-s*T-i*v,t[4]=n*h+a*o+s*f-i*c+d*D+E*M+p*v-g*T,t[5]=s*h+a*c+i*o-n*f+p*D+E*T+g*M-d*v,t[6]=i*h+a*f+n*c-s*o+g*D+E*v+d*T-p*M,t[7]=a*h-n*o-s*c-i*f+E*D-d*M-p*T-g*v,t}var vp=Ra;function xp(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t[4]=e[4]*r,t[5]=e[5]*r,t[6]=e[6]*r,t[7]=e[7]*r,t}var Ia=as;function Tp(t,e,r,n){var s=1-n;return Ia(e,r)<0&&(n=-n),t[0]=e[0]*s+r[0]*n,t[1]=e[1]*s+r[1]*n,t[2]=e[2]*s+r[2]*n,t[3]=e[3]*s+r[3]*n,t[4]=e[4]*s+r[4]*n,t[5]=e[5]*s+r[5]*n,t[6]=e[6]*s+r[6]*n,t[7]=e[7]*s+r[7]*n,t}function yp(t,e){var r=hn(e);return t[0]=-e[0]/r,t[1]=-e[1]/r,t[2]=-e[2]/r,t[3]=e[3]/r,t[4]=-e[4]/r,t[5]=-e[5]/r,t[6]=-e[6]/r,t[7]=e[7]/r,t}function Ep(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=e[3],t[4]=-e[4],t[5]=-e[5],t[6]=-e[6],t[7]=e[7],t}var _a=os,Mp=_a,hn=cs,Rp=hn;function Ip(t,e){var r=hn(e);if(r>0){r=Math.sqrt(r);var n=e[0]/r,s=e[1]/r,i=e[2]/r,a=e[3]/r,o=e[4],c=e[5],f=e[6],h=e[7],d=n*o+s*c+i*f+a*h;t[0]=n,t[1]=s,t[2]=i,t[3]=a,t[4]=(o-n*d)/r,t[5]=(c-s*d)/r,t[6]=(f-i*d)/r,t[7]=(h-a*d)/r}return t}function _p(t){return"quat2("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+")"}function wp(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]&&t[6]===e[6]&&t[7]===e[7]}function Ap(t,e){var r=t[0],n=t[1],s=t[2],i=t[3],a=t[4],o=t[5],c=t[6],f=t[7],h=e[0],d=e[1],p=e[2],g=e[3],E=e[4],M=e[5],T=e[6],v=e[7];return Math.abs(r-h)<=K*Math.max(1,Math.abs(r),Math.abs(h))&&Math.abs(n-d)<=K*Math.max(1,Math.abs(n),Math.abs(d))&&Math.abs(s-p)<=K*Math.max(1,Math.abs(s),Math.abs(p))&&Math.abs(i-g)<=K*Math.max(1,Math.abs(i),Math.abs(g))&&Math.abs(a-E)<=K*Math.max(1,Math.abs(a),Math.abs(E))&&Math.abs(o-M)<=K*Math.max(1,Math.abs(o),Math.abs(M))&&Math.abs(c-T)<=K*Math.max(1,Math.abs(c),Math.abs(T))&&Math.abs(f-v)<=K*Math.max(1,Math.abs(f),Math.abs(v))}var bp=Object.freeze({__proto__:null,add:mp,clone:Yd,conjugate:Ep,copy:Ma,create:Kd,dot:Ia,equals:Ap,exactEquals:wp,fromMat4:tp,fromRotation:ep,fromRotationTranslation:Ea,fromRotationTranslationValues:Zd,fromTranslation:Qd,fromValues:Jd,getDual:ip,getReal:sp,getTranslation:cp,identity:rp,invert:yp,len:Mp,length:_a,lerp:Tp,mul:vp,multiply:Ra,normalize:Ip,rotateAroundAxis:gp,rotateByQuatAppend:dp,rotateByQuatPrepend:pp,rotateX:lp,rotateY:up,rotateZ:hp,scale:xp,set:np,setDual:op,setReal:ap,sqrLen:Rp,squaredLength:hn,str:_p,translate:fp});function wa(){var t=new te(2);return te!=Float32Array&&(t[0]=0,t[1]=0),t}function Sp(t){var e=new te(2);return e[0]=t[0],e[1]=t[1],e}function Np(t,e){var r=new te(2);return r[0]=t,r[1]=e,r}function Cp(t,e){return t[0]=e[0],t[1]=e[1],t}function Op(t,e,r){return t[0]=e,t[1]=r,t}function Dp(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t}function Aa(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t}function ba(t,e,r){return t[0]=e[0]*r[0],t[1]=e[1]*r[1],t}function Sa(t,e,r){return t[0]=e[0]/r[0],t[1]=e[1]/r[1],t}function Fp(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t}function $p(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t}function Pp(t,e,r){return t[0]=Math.min(e[0],r[0]),t[1]=Math.min(e[1],r[1]),t}function Up(t,e,r){return t[0]=Math.max(e[0],r[0]),t[1]=Math.max(e[1],r[1]),t}function Lp(t,e){return t[0]=ct(e[0]),t[1]=ct(e[1]),t}function Bp(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t}function jp(t,e,r,n){return t[0]=e[0]+r[0]*n,t[1]=e[1]+r[1]*n,t}function Na(t,e){var r=e[0]-t[0],n=e[1]-t[1];return Math.sqrt(r*r+n*n)}function Ca(t,e){var r=e[0]-t[0],n=e[1]-t[1];return r*r+n*n}function Oa(t){var e=t[0],r=t[1];return Math.sqrt(e*e+r*r)}function Da(t){var e=t[0],r=t[1];return e*e+r*r}function Vp(t,e){return t[0]=-e[0],t[1]=-e[1],t}function zp(t,e){return t[0]=1/e[0],t[1]=1/e[1],t}function kp(t,e){var r=e[0],n=e[1],s=r*r+n*n;return s>0&&(s=1/Math.sqrt(s)),t[0]=e[0]*s,t[1]=e[1]*s,t}function Gp(t,e){return t[0]*e[0]+t[1]*e[1]}function Hp(t,e,r){var n=e[0]*r[1]-e[1]*r[0];return t[0]=t[1]=0,t[2]=n,t}function qp(t,e,r,n){var s=e[0],i=e[1];return t[0]=s+n*(r[0]-s),t[1]=i+n*(r[1]-i),t}function Wp(t,e){e=e===void 0?1:e;var r=tt()*2*Math.PI;return t[0]=Math.cos(r)*e,t[1]=Math.sin(r)*e,t}function Xp(t,e,r){var n=e[0],s=e[1];return t[0]=r[0]*n+r[2]*s,t[1]=r[1]*n+r[3]*s,t}function Kp(t,e,r){var n=e[0],s=e[1];return t[0]=r[0]*n+r[2]*s+r[4],t[1]=r[1]*n+r[3]*s+r[5],t}function Yp(t,e,r){var n=e[0],s=e[1];return t[0]=r[0]*n+r[3]*s+r[6],t[1]=r[1]*n+r[4]*s+r[7],t}function Jp(t,e,r){var n=e[0],s=e[1];return t[0]=r[0]*n+r[4]*s+r[12],t[1]=r[1]*n+r[5]*s+r[13],t}function Zp(t,e,r,n){var s=e[0]-r[0],i=e[1]-r[1],a=Math.sin(n),o=Math.cos(n);return t[0]=s*o-i*a+r[0],t[1]=s*a+i*o+r[1],t}function Qp(t,e){var r=t[0],n=t[1],s=e[0],i=e[1];return Math.abs(Math.atan2(n*s-r*i,r*s+n*i))}function eg(t,e){var r=t[0],n=t[1],s=e[0],i=e[1];return Math.atan2(r*i-n*s,r*s+n*i)}function tg(t){return t[0]=0,t[1]=0,t}function rg(t){return"vec2("+t[0]+", "+t[1]+")"}function ng(t,e){return t[0]===e[0]&&t[1]===e[1]}function sg(t,e){var r=t[0],n=t[1],s=e[0],i=e[1];return Math.abs(r-s)<=K*Math.max(1,Math.abs(r),Math.abs(s))&&Math.abs(n-i)<=K*Math.max(1,Math.abs(n),Math.abs(i))}var ig=Oa,ag=Aa,og=ba,cg=Sa,fg=Na,lg=Ca,ug=Da,hg=(function(){var t=wa();return function(e,r,n,s,i,a){var o,c;for(r||(r=2),n||(n=0),s?c=Math.min(s*r+n,e.length):c=e.length,o=n;o<c;o+=r)t[0]=e[o],t[1]=e[o+1],i(t,t,a),e[o]=t[0],e[o+1]=t[1];return e}})(),dg=Object.freeze({__proto__:null,add:Dp,angle:Qp,ceil:Fp,clone:Sp,copy:Cp,create:wa,cross:Hp,dist:fg,distance:Na,div:cg,divide:Sa,dot:Gp,equals:sg,exactEquals:ng,floor:$p,forEach:hg,fromValues:Np,inverse:zp,len:ig,length:Oa,lerp:qp,max:Up,min:Pp,mul:og,multiply:ba,negate:Vp,normalize:kp,random:Wp,rotate:Zp,round:Lp,scale:Bp,scaleAndAdd:jp,set:Op,signedAngle:eg,sqrDist:lg,sqrLen:ug,squaredDistance:Ca,squaredLength:Da,str:rg,sub:ag,subtract:Aa,transformMat2:Xp,transformMat2d:Kp,transformMat3:Yp,transformMat4:Jp,zero:tg}),pg=Object.freeze({__proto__:null,glMatrix:rl,mat2:Al,mat2d:Jl,mat3:Au,mat4:vh,quat:Xd,quat2:bp,vec2:dg,vec3:ed,vec4:Id}),gg=(()=>{var t=import.meta.url;return(async function(e={}){var r,n=e,s,i,a=new Promise((l,u)=>{s=l,i=u}),o=typeof window=="object",c=typeof importScripts=="function",f=typeof process=="object"&&typeof process.versions=="object"&&typeof process.versions.node=="string";if(f){const{createRequire:l}=await Promise.resolve().then(function(){return im});var h=l(import.meta.url)}var d=!1;n.setup=function(){if(d)return;d=!0,n.initTBB();function l(_,O,L=(H=>H)){if(O)for(let H of O)_.push_back(L(H));return _}function u(_,O=(L=>L)){const L=[],H=_.size();for(let Q=0;Q<H;Q++)L.push(O(_.get(Q)));return L}function m(_,O=(L=>L)){const L=[],H=_.size();for(let Q=0;Q<H;Q++){const fe=_.get(Q),Te=fe.size(),Be=[];for(let be=0;be<Te;be++)Be.push(O(fe.get(be)));L.push(Be)}return L}function y(_){return _[0].length<3&&(_=[_]),l(new n.Vector2_vec2,_,O=>l(new n.Vector_vec2,O,L=>L instanceof Array?{x:L[0],y:L[1]}:L))}function C(_){for(let O=0;O<_.size();O++)_.get(O).delete();_.delete()}function F(_){return _[0]instanceof Array?{x:_[0][0],y:_[0][1]}:typeof _[0]=="number"?{x:_[0]||0,y:_[1]||0}:_[0]}function j(_){return _[0]instanceof Array?{x:_[0][0],y:_[0][1],z:_[0][2]}:typeof _[0]=="number"?{x:_[0]||0,y:_[1]||0,z:_[2]||0}:_[0]}function P(_){return _=="EvenOdd"?0:_=="NonZero"?1:_=="Negative"?3:2}function k(_){return _=="Round"?1:_=="Miter"?2:0}const G=n.CrossSection;function W(_,O="Positive"){if(_ instanceof G)return _;{const L=y(_),H=new G(L,P(O));return C(L),H}}n.CrossSection.prototype.translate=function(..._){return this._Translate(F(_))},n.CrossSection.prototype.scale=function(_){return typeof _=="number"?this._Scale({x:_,y:_}):this._Scale(F([_]))},n.CrossSection.prototype.mirror=function(_){return this._Mirror(F([_]))},n.CrossSection.prototype.warp=function(_){const O=Tr(function(H){const Q=Ye(H,"double"),fe=Ye(H+8,"double"),Te=[Q,fe];_(Te),Zt(H,Te[0],"double"),Zt(H+8,Te[1],"double")},"vi"),L=this._Warp(O);return yr(O),L},n.CrossSection.prototype.decompose=function(){const _=this._Decompose(),O=u(_);return _.delete(),O},n.CrossSection.prototype.bounds=function(){const _=this._Bounds();return{min:["x","y"].map(O=>_.min[O]),max:["x","y"].map(O=>_.max[O])}},n.CrossSection.prototype.offset=function(_,O="Round",L=2,H=0){return this._Offset(_,k(O),L,H)},n.CrossSection.prototype.simplify=function(_=1e-6){return this._Simplify(_)},n.CrossSection.prototype.extrude=function(_,O=0,L=0,H=[1,1],Q=!1){H=F([H]);const fe=n._Extrude(this._ToPolygons(),_,O,L,H);return Q?fe.translate([0,0,-_/2]):fe},n.CrossSection.prototype.revolve=function(_=0,O=360){return n._Revolve(this._ToPolygons(),_,O)},n.CrossSection.prototype.add=function(_){return this._add(W(_))},n.CrossSection.prototype.subtract=function(_){return this._subtract(W(_))},n.CrossSection.prototype.intersect=function(_){return this._intersect(W(_))},n.CrossSection.prototype.toPolygons=function(){const _=this._ToPolygons(),O=m(_,L=>[L.x,L.y]);return _.delete(),O},n.Manifold.prototype.smoothOut=function(_=60,O=0){return this._SmoothOut(_,O)},n.Manifold.prototype.warp=function(_){const O=Tr(function(Q){const fe=Ye(Q,"double"),Te=Ye(Q+8,"double"),Be=Ye(Q+16,"double"),be=[fe,Te,Be];_(be),Zt(Q,be[0],"double"),Zt(Q+8,be[1],"double"),Zt(Q+16,be[2],"double")},"vi"),L=this._Warp(O);yr(O);const H=L.status();if(H!=="NoError")throw new n.ManifoldError(H);return L},n.Manifold.prototype.calculateNormals=function(_,O=60){return this._CalculateNormals(_,O)},n.Manifold.prototype.setProperties=function(_,O){const L=this.numProp(),H=Tr(function(fe,Te,Be){const be=[];for(let ye=0;ye<_;++ye)be[ye]=Ye(fe+8*ye,"double");const nr=[];for(let ye=0;ye<3;++ye)nr[ye]=Ye(Te+8*ye,"double");const sr=[];for(let ye=0;ye<L;++ye)sr[ye]=Ye(Be+8*ye,"double");O(be,nr,sr);for(let ye=0;ye<_;++ye)Zt(fe+8*ye,be[ye],"double")},"viii"),Q=this._SetProperties(_,H);return yr(H),Q},n.Manifold.prototype.translate=function(..._){return this._Translate(j(_))},n.Manifold.prototype.rotate=function(_,O,L){return Array.isArray(_)?this._Rotate(..._):this._Rotate(_,O||0,L||0)},n.Manifold.prototype.scale=function(_){return typeof _=="number"?this._Scale({x:_,y:_,z:_}):this._Scale(j([_]))},n.Manifold.prototype.mirror=function(_){return this._Mirror(j([_]))},n.Manifold.prototype.trimByPlane=function(_,O=0){return this._TrimByPlane(j([_]),O)},n.Manifold.prototype.slice=function(_=0){const O=this._Slice(_),L=new G(O,P("Positive"));return C(O),L},n.Manifold.prototype.project=function(){const _=this._Project(),O=new G(_,P("Positive"));return C(_),O},n.Manifold.prototype.split=function(_){const O=this._Split(_),L=u(O);return O.delete(),L},n.Manifold.prototype.splitByPlane=function(_,O=0){const L=this._SplitByPlane(j([_]),O),H=u(L);return L.delete(),H},n.Manifold.prototype.decompose=function(){const _=this._Decompose(),O=u(_);return _.delete(),O},n.Manifold.prototype.boundingBox=function(){const _=this._boundingBox();return{min:["x","y","z"].map(O=>_.min[O]),max:["x","y","z"].map(O=>_.max[O])}};class Z{constructor({numProp:O=3,triVerts:L=new Uint32Array,vertProperties:H=new Float32Array,mergeFromVert:Q,mergeToVert:fe,runIndex:Te,runOriginalID:Be,faceID:be,halfedgeTangent:nr,runTransform:sr}={}){this.numProp=O,this.triVerts=L,this.vertProperties=H,this.mergeFromVert=Q,this.mergeToVert=fe,this.runIndex=Te,this.runOriginalID=Be,this.faceID=be,this.halfedgeTangent=nr,this.runTransform=sr}get numTri(){return this.triVerts.length/3}get numVert(){return this.vertProperties.length/this.numProp}get numRun(){return this.runOriginalID.length}merge(){const{changed:O,mesh:L}=n._Merge(this);return Object.assign(this,{...L}),O}verts(O){return this.triVerts.subarray(3*O,3*(O+1))}position(O){return this.vertProperties.subarray(this.numProp*O,this.numProp*O+3)}extras(O){return this.vertProperties.subarray(this.numProp*O+3,this.numProp*(O+1))}tangent(O){return this.halfedgeTangent.subarray(4*O,4*(O+1))}transform(O){const L=new Array(16);for(const H of[0,1,2,3])for(const Q of[0,1,2])L[4*H+Q]=this.runTransform[12*O+3*H+Q];return L[15]=1,L}}n.Mesh=Z,n.Manifold.prototype.getMesh=function(_=-1){return new Z(this._GetMeshJS(_))},n.ManifoldError=function(O,...L){let H="Unknown error";switch(O){case"NonFiniteVertex":H="Non-finite vertex";break;case"NotManifold":H="Not manifold";break;case"VertexOutOfBounds":H="Vertex index out of bounds";break;case"PropertiesWrongLength":H="Properties have wrong length";break;case"MissingPositionProperties":H="Less than three properties";break;case"MergeVectorsDifferentLengths":H="Merge vectors have different lengths";break;case"MergeIndexOutOfBounds":H="Merge index out of bounds";break;case"TransformWrongLength":H="Transform vector has wrong length";break;case"RunIndexWrongLength":H="Run index vector has wrong length";break;case"FaceIDWrongLength":H="Face ID vector has wrong length";case"InvalidConstruction":H="Manifold constructed with invalid parameters"}const Q=Error.apply(this,[H,...L]);Q.name=this.name="ManifoldError",this.message=Q.message,this.stack=Q.stack,this.code=O},n.ManifoldError.prototype=Object.create(Error.prototype,{constructor:{value:n.ManifoldError,writable:!0,configurable:!0}}),n.CrossSection=function(_,O="Positive"){const L=y(_),H=new G(L,P(O));return C(L),H},n.CrossSection.ofPolygons=function(_,O="Positive"){return new n.CrossSection(_,O)},n.CrossSection.square=function(..._){let O;_.length==0?O={x:1,y:1}:typeof _[0]=="number"?O={x:_[0],y:_[0]}:O=F(_);const L=_[1]||!1;return n._Square(O,L)},n.CrossSection.circle=function(_,O=0){return n._Circle(_,O)};function se(_){return function(...O){O.length==1&&(O=O[0]);const L=new n.Vector_crossSection;for(const Q of O)L.push_back(W(Q));const H=n["_crossSection"+_](L);return L.delete(),H}}n.CrossSection.compose=se("Compose"),n.CrossSection.union=se("UnionN"),n.CrossSection.difference=se("DifferenceN"),n.CrossSection.intersection=se("IntersectionN");function Ee(_,O){l(_,O,L=>L instanceof Array?{x:L[0],y:L[1]}:L)}n.CrossSection.hull=function(..._){_.length==1&&(_=_[0]);let O=new n.Vector_vec2;for(const H of _)if(H instanceof G)n._crossSectionCollectVertices(O,H);else if(H instanceof Array&&H.length==2&&typeof H[0]=="number")O.push_back({x:H[0],y:H[1]});else if(H.x)O.push_back(H);else{const fe=H[0].length==2&&typeof H[0][0]=="number"||H[0].x?[H]:H;for(const Te of fe)Ee(O,Te)}const L=n._crossSectionHullPoints(O);return O.delete(),L},n.CrossSection.prototype=Object.create(G.prototype),Object.defineProperty(n.CrossSection,Symbol.hasInstance,{get:()=>_=>_ instanceof G});const me=n.Manifold;n.Manifold=function(_){const O=new me(_),L=O.status();if(L!=="NoError")throw new n.ManifoldError(L);return O},n.Manifold.ofMesh=function(_){return new n.Manifold(_)},n.Manifold.tetrahedron=function(){return n._Tetrahedron()},n.Manifold.cube=function(..._){let O;_.length==0?O={x:1,y:1,z:1}:typeof _[0]=="number"?O={x:_[0],y:_[0],z:_[0]}:O=j(_);const L=_[1]||!1;return n._Cube(O,L)},n.Manifold.cylinder=function(_,O,L=-1,H=0,Q=!1){return n._Cylinder(_,O,L,H,Q)},n.Manifold.sphere=function(_,O=0){return n._Sphere(_,O)},n.Manifold.smooth=function(_,O=[]){const L=new n.Vector_smoothness;l(L,O);const H=n._Smooth(_,L);return L.delete(),H},n.Manifold.extrude=function(_,O,L=0,H=0,Q=[1,1],fe=!1){return(_ instanceof G?_:n.CrossSection(_,"Positive")).extrude(O,L,H,Q,fe)},n.Manifold.revolve=function(_,O=0,L=360){return(_ instanceof G?_:n.CrossSection(_,"Positive")).revolve(O,L)},n.Manifold.reserveIDs=function(_){return n._ReserveIDs(_)},n.Manifold.compose=function(_){const O=new n.Vector_manifold;l(O,_);const L=n._manifoldCompose(O);return O.delete(),L};function Qe(_){return function(...O){O.length==1&&(O=O[0]);const L=new n.Vector_manifold;for(const Q of O)L.push_back(Q);const H=n["_manifold"+_+"N"](L);return L.delete(),H}}n.Manifold.union=Qe("Union"),n.Manifold.difference=Qe("Difference"),n.Manifold.intersection=Qe("Intersection"),n.Manifold.levelSet=function(_,O,L,H=0,Q=-1){const fe={min:{x:O.min[0],y:O.min[1],z:O.min[2]},max:{x:O.max[0],y:O.max[1],z:O.max[2]}},Te=Tr(function(be){const nr=Ye(be,"double"),sr=Ye(be+8,"double"),ye=Ye(be+16,"double");return _([nr,sr,ye])},"di"),Be=n._LevelSet(Te,fe,L,H,Q);return yr(Te),Be};function et(_,O){l(_,O,L=>L instanceof Array?{x:L[0],y:L[1],z:L[2]}:L)}n.Manifold.hull=function(..._){_.length==1&&(_=_[0]);let O=new n.Vector_vec3;for(const H of _)H instanceof me?n._manifoldCollectVertices(O,H):H instanceof Array&&H.length==3&&typeof H[0]=="number"?O.push_back({x:H[0],y:H[1],z:H[2]}):H.x?O.push_back(H):et(O,H);const L=n._manifoldHullPoints(O);return O.delete(),L},n.Manifold.prototype=Object.create(me.prototype),Object.defineProperty(n.Manifold,Symbol.hasInstance,{get:()=>_=>_ instanceof me}),n.triangulate=function(_,O=-1,L=!0){const H=y(_),Q=u(n._Triangulate(H,O,L),fe=>[fe[0],fe[1],fe[2]]);return C(H),Q}};var p=Object.assign({},n),g="";function E(l){return n.locateFile?n.locateFile(l,g):g+l}var M,T;if(f){var v=h("fs"),D=h("path");g=h("url").fileURLToPath(new URL("/assets/manifold-B8h_vZ5O.js",import.meta.url)),T=l=>{l=ze(l)?new URL(l):D.normalize(l);var u=v.readFileSync(l);return u},M=(l,u=!0)=>(l=ze(l)?new URL(l):D.normalize(l),new Promise((m,y)=>{v.readFile(l,u?void 0:"utf8",(C,F)=>{C?y(C):m(u?F.buffer:F)})})),!n.thisProgram&&process.argv.length>1&&process.argv[1].replace(/\\/g,"/"),process.argv.slice(2)}else(o||c)&&(c?g=self.location.href:typeof document<"u"&&document.currentScript&&(g=document.currentScript.src),t&&(g=t),g.startsWith("blob:")?g="":g=g.substr(0,g.replace(/[?#].*/,"").lastIndexOf("/")+1),c&&(T=l=>{var u=new XMLHttpRequest;return u.open("GET",l,!1),u.responseType="arraybuffer",u.send(null),new Uint8Array(u.response)}),M=l=>ze(l)?new Promise((u,m)=>{var y=new XMLHttpRequest;y.open("GET",l,!0),y.responseType="arraybuffer",y.onload=()=>{(y.status==200||y.status==0&&y.response)&&m(y.response),u(y.status)},y.onerror=u,y.send(null)}):fetch(l,{credentials:"same-origin"}).then(u=>u.ok?u.arrayBuffer():Promise.reject(new Error(u.status+" : "+u.url))));n.print||console.log.bind(console);var R=n.printErr||console.error.bind(console);Object.assign(n,p),p=null,n.arguments&&n.arguments,n.thisProgram&&n.thisProgram,n.quit&&n.quit;var w;n.wasmBinary&&(w=n.wasmBinary);var A,S=!1,x,I,b,N,B,U,V,z;function X(){var l=A.buffer;n.HEAP8=x=new Int8Array(l),n.HEAP16=b=new Int16Array(l),n.HEAPU8=I=new Uint8Array(l),n.HEAPU16=N=new Uint16Array(l),n.HEAP32=B=new Int32Array(l),n.HEAPU32=U=new Uint32Array(l),n.HEAPF32=V=new Float32Array(l),n.HEAPF64=z=new Float64Array(l)}var Y=[],J=[],re=[];function ae(){if(n.preRun)for(typeof n.preRun=="function"&&(n.preRun=[n.preRun]);n.preRun.length;)Ue(n.preRun.shift());mn(Y)}function lt(){mn(J)}function Me(){if(n.postRun)for(typeof n.postRun=="function"&&(n.postRun=[n.postRun]);n.postRun.length;)xe(n.postRun.shift());mn(re)}function Ue(l){Y.unshift(l)}function Le(l){J.unshift(l)}function xe(l){re.unshift(l)}var oe=0,we=null;function Jt(l){oe++,n.monitorRunDependencies?.(oe)}function Pt(l){if(oe--,n.monitorRunDependencies?.(oe),oe==0&&we){var u=we;we=null,u()}}function st(l){n.onAbort?.(l),l="Aborted("+l+")",R(l),S=!0,l+=". Build with -sASSERTIONS for more info.";var u=new WebAssembly.RuntimeError(l);throw i(u),u}var Re="data:application/octet-stream;base64,",Ie=l=>l.startsWith(Re),ze=l=>l.startsWith("file://");function Ut(){if(n.locateFile){var l="manifold.wasm";return Ie(l)?l:E(l)}return new URL("/assets/manifold-ldiO02fT.wasm",import.meta.url).href}var Ke;function Es(l){if(l==Ke&&w)return new Uint8Array(w);if(T)return T(l);throw"both async and sync fetching of the wasm failed"}function hc(l){return w?Promise.resolve().then(()=>Es(l)):M(l).then(u=>new Uint8Array(u),()=>Es(l))}function Ms(l,u,m){return hc(l).then(y=>WebAssembly.instantiate(y,u)).then(m,y=>{R(`failed to asynchronously prepare wasm: ${y}`),st(y)})}function dc(l,u,m,y){return!l&&typeof WebAssembly.instantiateStreaming=="function"&&!Ie(u)&&!ze(u)&&!f&&typeof fetch=="function"?fetch(u,{credentials:"same-origin"}).then(C=>{var F=WebAssembly.instantiateStreaming(C,m);return F.then(y,function(j){return R(`wasm streaming compile failed: ${j}`),R("falling back to ArrayBuffer instantiation"),Ms(u,m,y)})}):Ms(u,m,y)}function pc(){return{a:Kf}}function gc(){var l=pc();function u(y,C){return Ze=y.exports,Ze=Yf(Ze),A=Ze.J,X(),rr=Ze.M,Le(Ze.K),Pt(),Ze}Jt();function m(y){u(y.instance)}if(n.instantiateWasm)try{return n.instantiateWasm(l,u)}catch(y){R(`Module.instantiateWasm callback failed with error: ${y}`),i(y)}return Ke||(Ke=Ut()),dc(w,Ke,l,m).catch(i),{}}var mn=l=>{for(;l.length>0;)l.shift()(n)};function Ye(l,u="i8"){switch(u.endsWith("*")&&(u="*"),u){case"i1":return x[l>>>0];case"i8":return x[l>>>0];case"i16":return b[l>>>1>>>0];case"i32":return B[l>>>2>>>0];case"i64":st("to do getValue(i64) use WASM_BIGINT");case"float":return V[l>>>2>>>0];case"double":return z[l>>>3>>>0];case"*":return U[l>>>2>>>0];default:st(`invalid type for getValue: ${u}`)}}n.noExitRuntime;function Zt(l,u,m="i8"){switch(m.endsWith("*")&&(m="*"),m){case"i1":x[l>>>0]=u;break;case"i8":x[l>>>0]=u;break;case"i16":b[l>>>1>>>0]=u;break;case"i32":B[l>>>2>>>0]=u;break;case"i64":st("to do setValue(i64) use WASM_BIGINT");case"float":V[l>>>2>>>0]=u;break;case"double":z[l>>>3>>>0]=u;break;case"*":U[l>>>2>>>0]=u;break;default:st(`invalid type for setValue: ${m}`)}}class mc{constructor(u){this.excPtr=u,this.ptr=u-24}set_type(u){U[this.ptr+4>>>2>>>0]=u}get_type(){return U[this.ptr+4>>>2>>>0]}set_destructor(u){U[this.ptr+8>>>2>>>0]=u}get_destructor(){return U[this.ptr+8>>>2>>>0]}set_caught(u){u=u?1:0,x[this.ptr+12>>>0]=u}get_caught(){return x[this.ptr+12>>>0]!=0}set_rethrown(u){u=u?1:0,x[this.ptr+13>>>0]=u}get_rethrown(){return x[this.ptr+13>>>0]!=0}init(u,m){this.set_adjusted_ptr(0),this.set_type(u),this.set_destructor(m)}set_adjusted_ptr(u){U[this.ptr+16>>>2>>>0]=u}get_adjusted_ptr(){return U[this.ptr+16>>>2>>>0]}get_exception_ptr(){var u=Hs(this.get_type());if(u)return U[this.excPtr>>>2>>>0];var m=this.get_adjusted_ptr();return m!==0?m:this.excPtr}}var Rs=0;function vc(l,u,m){l>>>=0,u>>>=0,m>>>=0;var y=new mc(l);throw y.init(u,m),Rs=l,Rs}var xc=()=>{st("")},Ur={},vn=l=>{for(;l.length;){var u=l.pop(),m=l.pop();m(u)}};function pr(l){return this.fromWireType(U[l>>>2>>>0])}var Qt={},Lt={},Lr={},Is,Br=l=>{throw new Is(l)},Bt=(l,u,m)=>{l.forEach(function(P){Lr[P]=u});function y(P){var k=m(P);k.length!==l.length&&Br("Mismatched type converter count");for(var G=0;G<l.length;++G)it(l[G],k[G])}var C=new Array(u.length),F=[],j=0;u.forEach((P,k)=>{Lt.hasOwnProperty(P)?C[k]=Lt[P]:(F.push(P),Qt.hasOwnProperty(P)||(Qt[P]=[]),Qt[P].push(()=>{C[k]=Lt[P],++j,j===F.length&&y(C)}))}),F.length===0&&y(C)},Tc=function(l){l>>>=0;var u=Ur[l];delete Ur[l];var m=u.rawConstructor,y=u.rawDestructor,C=u.fields,F=C.map(j=>j.getterReturnType).concat(C.map(j=>j.setterArgumentType));Bt([l],F,j=>{var P={};return C.forEach((k,G)=>{var W=k.fieldName,Z=j[G],se=k.getter,Ee=k.getterContext,me=j[G+C.length],Qe=k.setter,et=k.setterContext;P[W]={read:_=>Z.fromWireType(se(Ee,_)),write:(_,O)=>{var L=[];Qe(et,_,me.toWireType(L,O)),vn(L)}}}),[{name:u.name,fromWireType:k=>{var G={};for(var W in P)G[W]=P[W].read(k);return y(k),G},toWireType:(k,G)=>{for(var W in P)if(!(W in G))throw new TypeError(`Missing field: "${W}"`);var Z=m();for(W in P)P[W].write(Z,G[W]);return k!==null&&k.push(y,Z),Z},argPackAdvance:at,readValueFromPointer:pr,destructorFunction:y}]})};function yc(l,u,m,y,C){}var Ec=()=>{for(var l=new Array(256),u=0;u<256;++u)l[u]=String.fromCharCode(u);_s=l},_s,Se=l=>{for(var u="",m=l;I[m>>>0];)u+=_s[I[m++>>>0]];return u},er,ne=l=>{throw new er(l)};function Mc(l,u,m={}){var y=u.name;if(l||ne(`type "${y}" must have a positive integer typeid pointer`),Lt.hasOwnProperty(l)){if(m.ignoreDuplicateRegistrations)return;ne(`Cannot register type '${y}' twice`)}if(Lt[l]=u,delete Lr[l],Qt.hasOwnProperty(l)){var C=Qt[l];delete Qt[l],C.forEach(F=>F())}}function it(l,u,m={}){if(!("argPackAdvance"in u))throw new TypeError("registerType registeredInstance requires argPackAdvance");return Mc(l,u,m)}var at=8;function Rc(l,u,m,y){l>>>=0,u>>>=0,u=Se(u),it(l,{name:u,fromWireType:function(C){return!!C},toWireType:function(C,F){return F?m:y},argPackAdvance:at,readValueFromPointer:function(C){return this.fromWireType(I[C>>>0])},destructorFunction:null})}var Ic=l=>({count:l.count,deleteScheduled:l.deleteScheduled,preservePointerOnDelete:l.preservePointerOnDelete,ptr:l.ptr,ptrType:l.ptrType,smartPtr:l.smartPtr,smartPtrType:l.smartPtrType}),xn=l=>{function u(m){return m.$$.ptrType.registeredClass.name}ne(u(l)+" instance already deleted")},Tn=!1,ws=l=>{},_c=l=>{l.smartPtr?l.smartPtrType.rawDestructor(l.smartPtr):l.ptrType.registeredClass.rawDestructor(l.ptr)},As=l=>{l.count.value-=1;var u=l.count.value===0;u&&_c(l)},bs=(l,u,m)=>{if(u===m)return l;if(m.baseClass===void 0)return null;var y=bs(l,u,m.baseClass);return y===null?null:m.downcast(y)},Ss={},wc=()=>Object.keys(vr).length,Ac=()=>{var l=[];for(var u in vr)vr.hasOwnProperty(u)&&l.push(vr[u]);return l},gr=[],yn=()=>{for(;gr.length;){var l=gr.pop();l.$$.deleteScheduled=!1,l.delete()}},mr,bc=l=>{mr=l,gr.length&&mr&&mr(yn)},Sc=()=>{n.getInheritedInstanceCount=wc,n.getLiveInheritedInstances=Ac,n.flushPendingDeletes=yn,n.setDelayFunction=bc},vr={},Nc=(l,u)=>{for(u===void 0&&ne("ptr should not be undefined");l.baseClass;)u=l.upcast(u),l=l.baseClass;return u},Cc=(l,u)=>(u=Nc(l,u),vr[u]),jr=(l,u)=>{(!u.ptrType||!u.ptr)&&Br("makeClassHandle requires ptr and ptrType");var m=!!u.smartPtrType,y=!!u.smartPtr;return m!==y&&Br("Both smartPtrType and smartPtr must be specified"),u.count={value:1},xr(Object.create(l,{$$:{value:u,writable:!0}}))};function Oc(l){var u=this.getPointee(l);if(!u)return this.destructor(l),null;var m=Cc(this.registeredClass,u);if(m!==void 0){if(m.$$.count.value===0)return m.$$.ptr=u,m.$$.smartPtr=l,m.clone();var y=m.clone();return this.destructor(l),y}function C(){return this.isSmartPointer?jr(this.registeredClass.instancePrototype,{ptrType:this.pointeeType,ptr:u,smartPtrType:this,smartPtr:l}):jr(this.registeredClass.instancePrototype,{ptrType:this,ptr:l})}var F=this.registeredClass.getActualType(u),j=Ss[F];if(!j)return C.call(this);var P;this.isConst?P=j.constPointerType:P=j.pointerType;var k=bs(u,this.registeredClass,P.registeredClass);return k===null?C.call(this):this.isSmartPointer?jr(P.registeredClass.instancePrototype,{ptrType:P,ptr:k,smartPtrType:this,smartPtr:l}):jr(P.registeredClass.instancePrototype,{ptrType:P,ptr:k})}var xr=l=>typeof FinalizationRegistry>"u"?(xr=u=>u,l):(Tn=new FinalizationRegistry(u=>{As(u.$$)}),xr=u=>{var m=u.$$,y=!!m.smartPtr;if(y){var C={$$:m};Tn.register(u,C,u)}return u},ws=u=>Tn.unregister(u),xr(l)),Dc=()=>{Object.assign(Vr.prototype,{isAliasOf(l){if(!(this instanceof Vr)||!(l instanceof Vr))return!1;var u=this.$$.ptrType.registeredClass,m=this.$$.ptr;l.$$=l.$$;for(var y=l.$$.ptrType.registeredClass,C=l.$$.ptr;u.baseClass;)m=u.upcast(m),u=u.baseClass;for(;y.baseClass;)C=y.upcast(C),y=y.baseClass;return u===y&&m===C},clone(){if(this.$$.ptr||xn(this),this.$$.preservePointerOnDelete)return this.$$.count.value+=1,this;var l=xr(Object.create(Object.getPrototypeOf(this),{$$:{value:Ic(this.$$)}}));return l.$$.count.value+=1,l.$$.deleteScheduled=!1,l},delete(){this.$$.ptr||xn(this),this.$$.deleteScheduled&&!this.$$.preservePointerOnDelete&&ne("Object already scheduled for deletion"),ws(this),As(this.$$),this.$$.preservePointerOnDelete||(this.$$.smartPtr=void 0,this.$$.ptr=void 0)},isDeleted(){return!this.$$.ptr},deleteLater(){return this.$$.ptr||xn(this),this.$$.deleteScheduled&&!this.$$.preservePointerOnDelete&&ne("Object already scheduled for deletion"),gr.push(this),gr.length===1&&mr&&mr(yn),this.$$.deleteScheduled=!0,this}})};function Vr(){}var tr=(l,u)=>Object.defineProperty(u,"name",{value:l}),Ns=(l,u,m)=>{if(l[u].overloadTable===void 0){var y=l[u];l[u]=function(...C){return l[u].overloadTable.hasOwnProperty(C.length)||ne(`Function '${m}' called with an invalid number of arguments (${C.length}) - expects one of (${l[u].overloadTable})!`),l[u].overloadTable[C.length].apply(this,C)},l[u].overloadTable=[],l[u].overloadTable[y.argCount]=y}},En=(l,u,m)=>{n.hasOwnProperty(l)?((m===void 0||n[l].overloadTable!==void 0&&n[l].overloadTable[m]!==void 0)&&ne(`Cannot register public name '${l}' twice`),Ns(n,l,l),n.hasOwnProperty(m)&&ne(`Cannot register multiple overloads of a function with the same number of arguments (${m})!`),n[l].overloadTable[m]=u):(n[l]=u,m!==void 0&&(n[l].numArguments=m))},Fc=48,$c=57,Pc=l=>{if(l===void 0)return"_unknown";l=l.replace(/[^a-zA-Z0-9_]/g,"$");var u=l.charCodeAt(0);return u>=Fc&&u<=$c?`_${l}`:l};function Uc(l,u,m,y,C,F,j,P){this.name=l,this.constructor=u,this.instancePrototype=m,this.rawDestructor=y,this.baseClass=C,this.getActualType=F,this.upcast=j,this.downcast=P,this.pureVirtualFunctions=[]}var Mn=(l,u,m)=>{for(;u!==m;)u.upcast||ne(`Expected null or instance of ${m.name}, got an instance of ${u.name}`),l=u.upcast(l),u=u.baseClass;return l};function Lc(l,u){if(u===null)return this.isReference&&ne(`null is not a valid ${this.name}`),0;u.$$||ne(`Cannot pass "${An(u)}" as a ${this.name}`),u.$$.ptr||ne(`Cannot pass deleted object as a pointer of type ${this.name}`);var m=u.$$.ptrType.registeredClass,y=Mn(u.$$.ptr,m,this.registeredClass);return y}function Bc(l,u){var m;if(u===null)return this.isReference&&ne(`null is not a valid ${this.name}`),this.isSmartPointer?(m=this.rawConstructor(),l!==null&&l.push(this.rawDestructor,m),m):0;(!u||!u.$$)&&ne(`Cannot pass "${An(u)}" as a ${this.name}`),u.$$.ptr||ne(`Cannot pass deleted object as a pointer of type ${this.name}`),!this.isConst&&u.$$.ptrType.isConst&&ne(`Cannot convert argument of type ${u.$$.smartPtrType?u.$$.smartPtrType.name:u.$$.ptrType.name} to parameter type ${this.name}`);var y=u.$$.ptrType.registeredClass;if(m=Mn(u.$$.ptr,y,this.registeredClass),this.isSmartPointer)switch(u.$$.smartPtr===void 0&&ne("Passing raw pointer to smart pointer is illegal"),this.sharingPolicy){case 0:u.$$.smartPtrType===this?m=u.$$.smartPtr:ne(`Cannot convert argument of type ${u.$$.smartPtrType?u.$$.smartPtrType.name:u.$$.ptrType.name} to parameter type ${this.name}`);break;case 1:m=u.$$.smartPtr;break;case 2:if(u.$$.smartPtrType===this)m=u.$$.smartPtr;else{var C=u.clone();m=this.rawShare(m,Ae.toHandle(()=>C.delete())),l!==null&&l.push(this.rawDestructor,m)}break;default:ne("Unsupporting sharing policy")}return m}function jc(l,u){if(u===null)return this.isReference&&ne(`null is not a valid ${this.name}`),0;u.$$||ne(`Cannot pass "${An(u)}" as a ${this.name}`),u.$$.ptr||ne(`Cannot pass deleted object as a pointer of type ${this.name}`),u.$$.ptrType.isConst&&ne(`Cannot convert argument of type ${u.$$.ptrType.name} to parameter type ${this.name}`);var m=u.$$.ptrType.registeredClass,y=Mn(u.$$.ptr,m,this.registeredClass);return y}var Vc=()=>{Object.assign(zr.prototype,{getPointee(l){return this.rawGetPointee&&(l=this.rawGetPointee(l)),l},destructor(l){this.rawDestructor?.(l)},argPackAdvance:at,readValueFromPointer:pr,fromWireType:Oc})};function zr(l,u,m,y,C,F,j,P,k,G,W){this.name=l,this.registeredClass=u,this.isReference=m,this.isConst=y,this.isSmartPointer=C,this.pointeeType=F,this.sharingPolicy=j,this.rawGetPointee=P,this.rawConstructor=k,this.rawShare=G,this.rawDestructor=W,!C&&u.baseClass===void 0?y?(this.toWireType=Lc,this.destructorFunction=null):(this.toWireType=jc,this.destructorFunction=null):this.toWireType=Bc}var Cs=(l,u,m)=>{n.hasOwnProperty(l)||Br("Replacing nonexistent public symbol"),n[l].overloadTable!==void 0&&m!==void 0?n[l].overloadTable[m]=u:(n[l]=u,n[l].argCount=m)},zc=(l,u,m)=>{l=l.replace(/p/g,"i");var y=n["dynCall_"+l];return y(u,...m)},rr,kr=l=>rr.get(l),kc=(l,u,m=[])=>{if(l.includes("j"))return zc(l,u,m);var y=kr(u)(...m);return l[0]=="p"?y>>>0:y},Os=(l,u)=>(...m)=>kc(l,u,m),Je=(l,u)=>{l=Se(l);function m(){return l.includes("j")||l.includes("p")?Os(l,u):kr(u)}var y=m();return typeof y!="function"&&ne(`unknown function pointer with signature ${l}: ${u}`),y},Gc=(l,u)=>{var m=tr(u,function(y){this.name=u,this.message=y;var C=new Error(y).stack;C!==void 0&&(this.stack=this.toString()+`
`+C.replace(/^Error(:[^\n]*)?\n/,""))});return m.prototype=Object.create(l.prototype),m.prototype.constructor=m,m.prototype.toString=function(){return this.message===void 0?this.name:`${this.name}: ${this.message}`},m},Ds,Fs=l=>{var u=Gs(l),m=Se(u);return ht(u),m},Gr=(l,u)=>{var m=[],y={};function C(F){if(!y[F]&&!Lt[F]){if(Lr[F]){Lr[F].forEach(C);return}m.push(F),y[F]=!0}}throw u.forEach(C),new Ds(`${l}: `+m.map(Fs).join([", "]))};function Hc(l,u,m,y,C,F,j,P,k,G,W,Z,se){l>>>=0,u>>>=0,m>>>=0,y>>>=0,C>>>=0,F>>>=0,j>>>=0,P>>>=0,k>>>=0,G>>>=0,W>>>=0,Z>>>=0,se>>>=0,W=Se(W),F=Je(C,F),P&&=Je(j,P),G&&=Je(k,G),se=Je(Z,se);var Ee=Pc(W);En(Ee,function(){Gr(`Cannot construct ${W} due to unbound types`,[y])}),Bt([l,u,m],y?[y]:[],me=>{me=me[0];var Qe,et;y?(Qe=me.registeredClass,et=Qe.instancePrototype):et=Vr.prototype;var _=tr(W,function(...Te){if(Object.getPrototypeOf(this)!==O)throw new er("Use 'new' to construct "+W);if(L.constructor_body===void 0)throw new er(W+" has no accessible constructor");var Be=L.constructor_body[Te.length];if(Be===void 0)throw new er(`Tried to invoke ctor of ${W} with invalid number of parameters (${Te.length}) - expected (${Object.keys(L.constructor_body).toString()}) parameters instead!`);return Be.apply(this,Te)}),O=Object.create(et,{constructor:{value:_}});_.prototype=O;var L=new Uc(W,_,O,se,Qe,F,P,G);L.baseClass&&(L.baseClass.__derivedClasses??=[],L.baseClass.__derivedClasses.push(L));var H=new zr(W,L,!0,!1,!1),Q=new zr(W+"*",L,!1,!1,!1),fe=new zr(W+" const*",L,!1,!0,!1);return Ss[l]={pointerType:Q,constPointerType:fe},Cs(Ee,_),[H,Q,fe]})}var Rn=(l,u)=>{for(var m=[],y=0;y<l;y++)m.push(U[u+y*4>>>2>>>0]);return m};function $s(l){for(var u=1;u<l.length;++u)if(l[u]!==null&&l[u].destructorFunction===void 0)return!0;return!1}function Ps(l,u){if(!(l instanceof Function))throw new TypeError(`new_ called with constructor type ${typeof l} which is not a function`);var m=tr(l.name||"unknownFunctionName",function(){});m.prototype=l.prototype;var y=new m,C=l.apply(y,u);return C instanceof Object?C:y}function qc(l,u,m,y){for(var C=$s(l),F=l.length,j="",P="",k=0;k<F-2;++k)j+=(k!==0?", ":"")+"arg"+k,P+=(k!==0?", ":"")+"arg"+k+"Wired";var G=`
        return function (${j}) {
        if (arguments.length !== ${F-2}) {
          throwBindingError('function ' + humanName + ' called with ' + arguments.length + ' arguments, expected ${F-2}');
        }`;C&&(G+=`var destructors = [];
`);var W=C?"destructors":"null",Z=["humanName","throwBindingError","invoker","fn","runDestructors","retType","classParam"];u&&(G+="var thisWired = classParam['toWireType']("+W+`, this);
`);for(var k=0;k<F-2;++k)G+="var arg"+k+"Wired = argType"+k+"['toWireType']("+W+", arg"+k+`);
`,Z.push("argType"+k);if(u&&(P="thisWired"+(P.length>0?", ":"")+P),G+=(m||y?"var rv = ":"")+"invoker(fn"+(P.length>0?", ":"")+P+`);
`,C)G+=`runDestructors(destructors);
`;else for(var k=u?1:2;k<l.length;++k){var se=k===1?"thisWired":"arg"+(k-2)+"Wired";l[k].destructorFunction!==null&&(G+=`${se}_dtor(${se});
`,Z.push(`${se}_dtor`))}return m&&(G+=`var ret = retType['fromWireType'](rv);
return ret;
`),G+=`}
`,[Z,G]}function In(l,u,m,y,C,F){var j=u.length;j<2&&ne("argTypes array size mismatch! Must at least get return value and 'this' types!");for(var P=u[1]!==null&&m!==null,k=$s(u),G=u[0].name!=="void",W=[l,ne,y,C,vn,u[0],u[1]],Z=0;Z<j-2;++Z)W.push(u[Z+2]);if(!k)for(var Z=P?1:2;Z<u.length;++Z)u[Z].destructorFunction!==null&&W.push(u[Z].destructorFunction);let[se,Ee]=qc(u,P,G,F);se.push(Ee);var me=Ps(Function,se)(...W);return tr(l,me)}var Wc=function(l,u,m,y,C,F){l>>>=0,m>>>=0,y>>>=0,C>>>=0,F>>>=0;var j=Rn(u,m);C=Je(y,C),Bt([],[l],P=>{P=P[0];var k=`constructor ${P.name}`;if(P.registeredClass.constructor_body===void 0&&(P.registeredClass.constructor_body=[]),P.registeredClass.constructor_body[u-1]!==void 0)throw new er(`Cannot register multiple constructors with identical number of parameters (${u-1}) for class '${P.name}'! Overload resolution is currently only performed using the parameter count, not actual type info!`);return P.registeredClass.constructor_body[u-1]=()=>{Gr(`Cannot construct ${P.name} due to unbound types`,j)},Bt([],j,G=>(G.splice(1,0,null),P.registeredClass.constructor_body[u-1]=In(k,G,null,C,F),[])),[]})},Us=l=>{l=l.trim();const u=l.indexOf("(");return u!==-1?l.substr(0,u):l},Xc=function(l,u,m,y,C,F,j,P,k){l>>>=0,u>>>=0,y>>>=0,C>>>=0,F>>>=0,j>>>=0;var G=Rn(m,y);u=Se(u),u=Us(u),F=Je(C,F),Bt([],[l],W=>{W=W[0];var Z=`${W.name}.${u}`;u.startsWith("@@")&&(u=Symbol[u.substring(2)]),P&&W.registeredClass.pureVirtualFunctions.push(u);function se(){Gr(`Cannot call ${Z} due to unbound types`,G)}var Ee=W.registeredClass.instancePrototype,me=Ee[u];return me===void 0||me.overloadTable===void 0&&me.className!==W.name&&me.argCount===m-2?(se.argCount=m-2,se.className=W.name,Ee[u]=se):(Ns(Ee,u,Z),Ee[u].overloadTable[m-2]=se),Bt([],G,Qe=>{var et=In(Z,Qe,W,F,j,k);return Ee[u].overloadTable===void 0?(et.argCount=m-2,Ee[u]=et):Ee[u].overloadTable[m-2]=et,[]}),[]})},_n=[],ut=[];function wn(l){l>>>=0,l>9&&--ut[l+1]===0&&(ut[l]=void 0,_n.push(l))}var Kc=()=>ut.length/2-5-_n.length,Yc=()=>{ut.push(0,1,void 0,1,null,1,!0,1,!1,1),n.count_emval_handles=Kc},Ae={toValue:l=>(l||ne("Cannot use deleted val. handle = "+l),ut[l]),toHandle:l=>{switch(l){case void 0:return 2;case null:return 4;case!0:return 6;case!1:return 8;default:{const u=_n.pop()||ut.length;return ut[u]=l,ut[u+1]=1,u}}}},Jc={name:"emscripten::val",fromWireType:l=>{var u=Ae.toValue(l);return wn(l),u},toWireType:(l,u)=>Ae.toHandle(u),argPackAdvance:at,readValueFromPointer:pr,destructorFunction:null};function Ls(l){return l>>>=0,it(l,Jc)}var Zc=(l,u,m)=>{switch(u){case 1:return m?function(y){return this.fromWireType(x[y>>>0])}:function(y){return this.fromWireType(I[y>>>0])};case 2:return m?function(y){return this.fromWireType(b[y>>>1>>>0])}:function(y){return this.fromWireType(N[y>>>1>>>0])};case 4:return m?function(y){return this.fromWireType(B[y>>>2>>>0])}:function(y){return this.fromWireType(U[y>>>2>>>0])};default:throw new TypeError(`invalid integer width (${u}): ${l}`)}};function Qc(l,u,m,y){l>>>=0,u>>>=0,m>>>=0,u=Se(u);function C(){}C.values={},it(l,{name:u,constructor:C,fromWireType:function(F){return this.constructor.values[F]},toWireType:(F,j)=>j.value,argPackAdvance:at,readValueFromPointer:Zc(u,m,y),destructorFunction:null}),En(u,C)}var Hr=(l,u)=>{var m=Lt[l];return m===void 0&&ne(`${u} has unknown type ${Fs(l)}`),m};function ef(l,u,m){l>>>=0,u>>>=0;var y=Hr(l,"enum");u=Se(u);var C=y.constructor,F=Object.create(y.constructor.prototype,{value:{value:m},constructor:{value:tr(`${y.name}_${u}`,function(){})}});C.values[m]=F,C[u]=F}var An=l=>{if(l===null)return"null";var u=typeof l;return u==="object"||u==="array"||u==="function"?l.toString():""+l},tf=(l,u)=>{switch(u){case 4:return function(m){return this.fromWireType(V[m>>>2>>>0])};case 8:return function(m){return this.fromWireType(z[m>>>3>>>0])};default:throw new TypeError(`invalid float width (${u}): ${l}`)}},rf=function(l,u,m){l>>>=0,u>>>=0,m>>>=0,u=Se(u),it(l,{name:u,fromWireType:y=>y,toWireType:(y,C)=>C,argPackAdvance:at,readValueFromPointer:tf(u,m),destructorFunction:null})};function nf(l,u,m,y,C,F,j){l>>>=0,m>>>=0,y>>>=0,C>>>=0,F>>>=0;var P=Rn(u,m);l=Se(l),l=Us(l),C=Je(y,C),En(l,function(){Gr(`Cannot call ${l} due to unbound types`,P)},u-1),Bt([],P,k=>{var G=[k[0],null].concat(k.slice(1));return Cs(l,In(l,G,null,C,F,j),u-1),[]})}var sf=(l,u,m)=>{switch(u){case 1:return m?y=>x[y>>>0]:y=>I[y>>>0];case 2:return m?y=>b[y>>>1>>>0]:y=>N[y>>>1>>>0];case 4:return m?y=>B[y>>>2>>>0]:y=>U[y>>>2>>>0];default:throw new TypeError(`invalid integer width (${u}): ${l}`)}};function af(l,u,m,y,C){l>>>=0,u>>>=0,m>>>=0,u=Se(u);var F=W=>W;if(y===0){var j=32-8*m;F=W=>W<<j>>>j}var P=u.includes("unsigned"),k=(W,Z)=>{},G;P?G=function(W,Z){return k(Z,this.name),Z>>>0}:G=function(W,Z){return k(Z,this.name),Z},it(l,{name:u,fromWireType:F,toWireType:G,argPackAdvance:at,readValueFromPointer:sf(u,m,y!==0),destructorFunction:null})}function of(l,u,m){l>>>=0,m>>>=0;var y=[Int8Array,Uint8Array,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array],C=y[u];function F(j){var P=U[j>>>2>>>0],k=U[j+4>>>2>>>0];return new C(x.buffer,k,P)}m=Se(m),it(l,{name:m,fromWireType:F,argPackAdvance:at,readValueFromPointer:F},{ignoreDuplicateRegistrations:!0})}function cf(l,u){l>>>=0,Ls(l)}var ff=(l,u,m,y)=>{if(m>>>=0,!(y>0))return 0;for(var C=m,F=m+y-1,j=0;j<l.length;++j){var P=l.charCodeAt(j);if(P>=55296&&P<=57343){var k=l.charCodeAt(++j);P=65536+((P&1023)<<10)|k&1023}if(P<=127){if(m>=F)break;u[m++>>>0]=P}else if(P<=2047){if(m+1>=F)break;u[m++>>>0]=192|P>>6,u[m++>>>0]=128|P&63}else if(P<=65535){if(m+2>=F)break;u[m++>>>0]=224|P>>12,u[m++>>>0]=128|P>>6&63,u[m++>>>0]=128|P&63}else{if(m+3>=F)break;u[m++>>>0]=240|P>>18,u[m++>>>0]=128|P>>12&63,u[m++>>>0]=128|P>>6&63,u[m++>>>0]=128|P&63}}return u[m>>>0]=0,m-C},lf=(l,u,m)=>ff(l,I,u,m),uf=l=>{for(var u=0,m=0;m<l.length;++m){var y=l.charCodeAt(m);y<=127?u++:y<=2047?u+=2:y>=55296&&y<=57343?(u+=4,++m):u+=3}return u},Bs=typeof TextDecoder<"u"?new TextDecoder:void 0,hf=(l,u,m)=>{u>>>=0;for(var y=u+m,C=u;l[C]&&!(C>=y);)++C;if(C-u>16&&l.buffer&&Bs)return Bs.decode(l.subarray(u,C));for(var F="";u<C;){var j=l[u++];if(!(j&128)){F+=String.fromCharCode(j);continue}var P=l[u++]&63;if((j&224)==192){F+=String.fromCharCode((j&31)<<6|P);continue}var k=l[u++]&63;if((j&240)==224?j=(j&15)<<12|P<<6|k:j=(j&7)<<18|P<<12|k<<6|l[u++]&63,j<65536)F+=String.fromCharCode(j);else{var G=j-65536;F+=String.fromCharCode(55296|G>>10,56320|G&1023)}}return F},df=(l,u)=>(l>>>=0,l?hf(I,l,u):"");function pf(l,u){l>>>=0,u>>>=0,u=Se(u);var m=u==="std::string";it(l,{name:u,fromWireType(y){var C=U[y>>>2>>>0],F=y+4,j;if(m)for(var P=F,k=0;k<=C;++k){var G=F+k;if(k==C||I[G>>>0]==0){var W=G-P,Z=df(P,W);j===void 0?j=Z:(j+="\0",j+=Z),P=G+1}}else{for(var se=new Array(C),k=0;k<C;++k)se[k]=String.fromCharCode(I[F+k>>>0]);j=se.join("")}return ht(y),j},toWireType(y,C){C instanceof ArrayBuffer&&(C=new Uint8Array(C));var F,j=typeof C=="string";j||C instanceof Uint8Array||C instanceof Uint8ClampedArray||C instanceof Int8Array||ne("Cannot pass non-string to std::string"),m&&j?F=uf(C):F=C.length;var P=Cn(4+F+1),k=P+4;if(U[P>>>2>>>0]=F,m&&j)lf(C,k,F+1);else if(j)for(var G=0;G<F;++G){var W=C.charCodeAt(G);W>255&&(ht(k),ne("String has UTF-16 code units that do not fit in 8 bits")),I[k+G>>>0]=W}else for(var G=0;G<F;++G)I[k+G>>>0]=C[G];return y!==null&&y.push(ht,P),P},argPackAdvance:at,readValueFromPointer:pr,destructorFunction(y){ht(y)}})}var js=typeof TextDecoder<"u"?new TextDecoder("utf-16le"):void 0,gf=(l,u)=>{for(var m=l,y=m>>1,C=y+u/2;!(y>=C)&&N[y>>>0];)++y;if(m=y<<1,m-l>32&&js)return js.decode(I.subarray(l>>>0,m>>>0));for(var F="",j=0;!(j>=u/2);++j){var P=b[l+j*2>>>1>>>0];if(P==0)break;F+=String.fromCharCode(P)}return F},mf=(l,u,m)=>{if(m??=2147483647,m<2)return 0;m-=2;for(var y=u,C=m<l.length*2?m/2:l.length,F=0;F<C;++F){var j=l.charCodeAt(F);b[u>>>1>>>0]=j,u+=2}return b[u>>>1>>>0]=0,u-y},vf=l=>l.length*2,xf=(l,u)=>{for(var m=0,y="";!(m>=u/4);){var C=B[l+m*4>>>2>>>0];if(C==0)break;if(++m,C>=65536){var F=C-65536;y+=String.fromCharCode(55296|F>>10,56320|F&1023)}else y+=String.fromCharCode(C)}return y},Tf=(l,u,m)=>{if(u>>>=0,m??=2147483647,m<4)return 0;for(var y=u,C=y+m-4,F=0;F<l.length;++F){var j=l.charCodeAt(F);if(j>=55296&&j<=57343){var P=l.charCodeAt(++F);j=65536+((j&1023)<<10)|P&1023}if(B[u>>>2>>>0]=j,u+=4,u+4>C)break}return B[u>>>2>>>0]=0,u-y},yf=l=>{for(var u=0,m=0;m<l.length;++m){var y=l.charCodeAt(m);y>=55296&&y<=57343&&++m,u+=4}return u},Ef=function(l,u,m){l>>>=0,u>>>=0,m>>>=0,m=Se(m);var y,C,F,j;u===2?(y=gf,C=mf,j=vf,F=P=>N[P>>>1>>>0]):u===4&&(y=xf,C=Tf,j=yf,F=P=>U[P>>>2>>>0]),it(l,{name:m,fromWireType:P=>{for(var k=U[P>>>2>>>0],G,W=P+4,Z=0;Z<=k;++Z){var se=P+4+Z*u;if(Z==k||F(se)==0){var Ee=se-W,me=y(W,Ee);G===void 0?G=me:(G+="\0",G+=me),W=se+u}}return ht(P),G},toWireType:(P,k)=>{typeof k!="string"&&ne(`Cannot pass non-string to C++ string type ${m}`);var G=j(k),W=Cn(4+G+u);return U[W>>>2>>>0]=G/u,C(k,W+4,G+u),P!==null&&P.push(ht,W),W},argPackAdvance:at,readValueFromPointer:pr,destructorFunction(P){ht(P)}})};function Mf(l,u,m,y,C,F){l>>>=0,u>>>=0,m>>>=0,y>>>=0,C>>>=0,F>>>=0,Ur[l]={name:Se(u),rawConstructor:Je(m,y),rawDestructor:Je(C,F),fields:[]}}function Rf(l,u,m,y,C,F,j,P,k,G){l>>>=0,u>>>=0,m>>>=0,y>>>=0,C>>>=0,F>>>=0,j>>>=0,P>>>=0,k>>>=0,G>>>=0,Ur[l].fields.push({fieldName:Se(u),getterReturnType:m,getter:Je(y,C),getterContext:F,setterArgumentType:j,setter:Je(P,k),setterContext:G})}var If=function(l,u){l>>>=0,u>>>=0,u=Se(u),it(l,{isVoid:!0,name:u,argPackAdvance:0,fromWireType:()=>{},toWireType:(m,y)=>{}})};function _f(l,u,m){return l>>>=0,u>>>=0,m>>>=0,I.copyWithin(l>>>0,u>>>0,u+m>>>0)}var Vs=(l,u,m)=>{var y=[],C=l.toWireType(y,m);return y.length&&(U[u>>>2>>>0]=Ae.toHandle(y)),C};function wf(l,u,m){return l>>>=0,u>>>=0,m>>>=0,l=Ae.toValue(l),u=Hr(u,"emval::as"),Vs(u,m,l)}var Af={},zs=l=>{var u=Af[l];return u===void 0?Se(l):u},bn=[];function bf(l,u,m,y,C){return l>>>=0,u>>>=0,m>>>=0,y>>>=0,C>>>=0,l=bn[l],u=Ae.toValue(u),m=zs(m),l(u,u[m],y,C)}function Sf(l,u){return l>>>=0,u>>>=0,l=Ae.toValue(l),u=Ae.toValue(u),l==u}var Nf=l=>{var u=bn.length;return bn.push(l),u},Cf=(l,u)=>{for(var m=new Array(l),y=0;y<l;++y)m[y]=Hr(U[u+y*4>>>2>>>0],"parameter "+y);return m};function Of(l,u,m){u>>>=0;var y=Cf(l,u),C=y.shift();l--;var F=`return function (obj, func, destructorsRef, args) {
`,j=0,P=[];m===0&&P.push("obj");for(var k=["retType"],G=[C],W=0;W<l;++W)P.push("arg"+W),k.push("argType"+W),G.push(y[W]),F+=`  var arg${W} = argType${W}.readValueFromPointer(args${j?"+"+j:""});
`,j+=y[W].argPackAdvance;var Z=m===1?"new func":"func.call";F+=`  var rv = ${Z}(${P.join(", ")});
`,C.isVoid||(k.push("emval_returnValue"),G.push(Vs),F+=`  return emval_returnValue(retType, destructorsRef, rv);
`),F+=`};
`,k.push(F);var se=Ps(Function,k)(...G),Ee=`methodCaller<(${y.map(me=>me.name).join(", ")}) => ${C.name}>`;return Nf(tr(Ee,se))}function Df(l,u){return l>>>=0,u>>>=0,l=Ae.toValue(l),u=Ae.toValue(u),Ae.toHandle(l[u])}function Ff(l){l>>>=0,l>9&&(ut[l+1]+=1)}function $f(l){return l>>>=0,Ae.toHandle(zs(l))}function Pf(){return Ae.toHandle({})}function Uf(l){l>>>=0;var u=Ae.toValue(l);vn(u),wn(l)}function Lf(l,u,m){l>>>=0,u>>>=0,m>>>=0,l=Ae.toValue(l),u=Ae.toValue(u),m=Ae.toValue(m),l[u]=m}function Bf(l,u){l>>>=0,u>>>=0,l=Hr(l,"_emval_take_value");var m=l.readValueFromPointer(u);return Ae.toHandle(m)}var jf=()=>4294901760,Vf=l=>{var u=A.buffer,m=(l-u.byteLength+65535)/65536;try{return A.grow(m),X(),1}catch{}};function zf(l){l>>>=0;var u=I.length,m=jf();if(l>m)return!1;for(var y=(k,G)=>k+(G-k%G)%G,C=1;C<=4;C*=2){var F=u*(1+.2/C);F=Math.min(F,l+100663296);var j=Math.min(m,y(Math.max(l,F),65536)),P=Vf(j);if(P)return!0}return!1}var ks=(l,u)=>{l<128?u.push(l):u.push(l%128|128,l>>7)},kf=l=>{for(var u={i:"i32",j:"i64",f:"f32",d:"f64",e:"externref",p:"i32"},m={parameters:[],results:l[0]=="v"?[]:[u[l[0]]]},y=1;y<l.length;++y)m.parameters.push(u[l[y]]);return m},Gf=(l,u)=>{var m=l.slice(0,1),y=l.slice(1),C={i:127,p:127,j:126,f:125,d:124,e:111};u.push(96),ks(y.length,u);for(var F=0;F<y.length;++F)u.push(C[y[F]]);m=="v"?u.push(0):u.push(1,C[m])},Hf=(l,u)=>{if(typeof WebAssembly.Function=="function")return new WebAssembly.Function(kf(u),l);var m=[1];Gf(u,m);var y=[0,97,115,109,1,0,0,0,1];ks(m.length,y),y.push(...m),y.push(2,7,1,1,101,1,102,0,0,7,5,1,1,102,0,0);var C=new WebAssembly.Module(new Uint8Array(y)),F=new WebAssembly.Instance(C,{e:{f:l}}),j=F.exports.f;return j},qf=(l,u)=>{if(jt)for(var m=l;m<l+u;m++){var y=kr(m);y&&jt.set(y,m)}},jt,Wf=l=>(jt||(jt=new WeakMap,qf(0,rr.length)),jt.get(l)||0),Sn=[],Xf=()=>{if(Sn.length)return Sn.pop();try{rr.grow(1)}catch(l){throw l instanceof RangeError?"Unable to grow wasm table. Set ALLOW_TABLE_GROWTH.":l}return rr.length-1},Nn=(l,u)=>rr.set(l,u),Tr=(l,u)=>{var m=Wf(l);if(m)return m;var y=Xf();try{Nn(y,l)}catch(F){if(!(F instanceof TypeError))throw F;var C=Hf(l,u);Nn(y,C)}return jt.set(l,y),y},yr=l=>{jt.delete(kr(l)),Nn(l,null),Sn.push(l)};Is=n.InternalError=class extends Error{constructor(u){super(u),this.name="InternalError"}},Ec(),er=n.BindingError=class extends Error{constructor(u){super(u),this.name="BindingError"}},Dc(),Sc(),Vc(),Ds=n.UnboundTypeError=Gc(Error,"UnboundTypeError"),Yc();var Kf={i:vc,D:xc,n:Tc,C:yc,H:Rc,h:Hc,g:Wc,a:Xc,G:Ls,t:Qc,e:ef,x:rf,c:nf,j:af,f:of,k:cf,w:pf,s:Ef,o:Mf,l:Rf,I:If,F:_f,v:wf,z:bf,b:wn,m:Sf,y:Of,B:Df,u:Ff,q:$f,A:Pf,p:Uf,r:Lf,d:Bf,E:zf},Ze=gc(),Gs=l=>(Gs=Ze.L)(l),Cn=l=>(Cn=Ze.N)(l),ht=l=>(ht=Ze.O)(l),Hs=l=>(Hs=Ze.P)(l);function Yf(l){l=Object.assign({},l);var u=y=>C=>y(C)>>>0,m=y=>()=>y()>>>0;return l.L=u(l.L),l.N=u(l.N),l._emscripten_stack_alloc=u(l._emscripten_stack_alloc),l.emscripten_stack_get_current=m(l.emscripten_stack_get_current),l}n.addFunction=Tr,n.removeFunction=yr;var qr;we=function l(){qr||qs(),qr||(we=l)};function qs(){if(oe>0||(ae(),oe>0))return;function l(){qr||(qr=!0,n.calledRun=!0,!S&&(lt(),s(n),n.onRuntimeInitialized?.(),Me()))}n.setStatus?(n.setStatus("Running..."),setTimeout(function(){setTimeout(function(){n.setStatus("")},1),l()},1)):l()}if(n.preInit)for(typeof n.preInit=="function"&&(n.preInit=[n.preInit]);n.preInit.length>0;)n.preInit.pop()();return qs(),r=a,r})})();const Fa=await gg();Fa.setup();const mg=["cube","cylinder","sphere","tetrahedron","extrude","revolve","compose","union","difference","intersection","levelSet","smooth","ofMesh","hull"],vg=["add","subtract","intersect","decompose","warp","transform","translate","rotate","scale","mirror","calculateCurvature","calculateNormals","smoothByNormals","smoothOut","refine","refineToLength","refineToTolerance","setProperties","setTolerance","simplify","asOriginal","trimByPlane","split","splitByPlane","slice","project","hull"],xg=["square","circle","union","difference","intersection","compose","ofPolygons","hull"],Tg=["add","subtract","intersect","rectClip","decompose","transform","translate","rotate","scale","mirror","simplify","offset","hull"],yg=["setMinCircularAngle","setMinCircularEdgeLength","setCircularSegments","getCircularSegments","resetToCircularDefaults","Mesh","Manifold","CrossSection"];class Eg{context={};beforeScript="resetToCircularDefaults();";afterScript='return typeof result === "undefined" ? undefined : result;';module=Fa;memoryRegistry;constructor(){this.memoryRegistry=new Array,this.addMembers("Manifold",vg,!1),this.addMembers("Manifold",mg,!0),this.addMembers("CrossSection",Tg,!1),this.addMembers("CrossSection",xg,!0)}addMembers(e,r,n){const s=this.module[e],i=n?s:s.prototype;for(const a of r){const o=i[a];i[a]=(...c)=>{const f=o(...c);return this.memoryRegistry.push(f),f}}}clearContext(){this.context={}}addContext(e){Object.assign(this.context,e)}addContextMethodWithCleanup(e,r){this.context[e]=(...n)=>{const s=r(...n);return this.memoryRegistry.push(s),s}}cleanup(){for(const e of this.memoryRegistry)if(e instanceof Array)for(const r of e)r.delete();else e.delete();this.memoryRegistry.length=0}evaluate(e){const r=yg.map(i=>[i,this.module[i]]),n={...Object.fromEntries(r),module:this.module,...this.context};return new Function(...Object.keys(n),this.beforeScript+`
`+e+`
`+this.afterScript+`
`)(...Object.values(n))}getModule(){return this.module}}class $a{constructor(){this._listeners={}}addEventListener(e,r){const n=this._listeners;return n[e]===void 0&&(n[e]=[]),n[e].indexOf(r)===-1&&n[e].push(r),this}removeEventListener(e,r){const s=this._listeners[e];if(s!==void 0){const i=s.indexOf(r);i!==-1&&s.splice(i,1)}return this}dispatchEvent(e){const n=this._listeners[e.type];if(n!==void 0){const s=n.slice(0);for(let i=0,a=s.length;i<a;i++)s[i].call(this,e)}return this}dispose(){for(const e in this._listeners)delete this._listeners[e]}}class ir{constructor(e,r,n,s={}){if(this._name=void 0,this._parent=void 0,this._child=void 0,this._attributes=void 0,this._disposed=!1,this._name=e,this._parent=r,this._child=n,this._attributes=s,!r.isOnGraph(n))throw new Error("Cannot connect disconnected graphs.")}getName(){return this._name}getParent(){return this._parent}getChild(){return this._child}setChild(e){return this._child=e,this}getAttributes(){return this._attributes}dispose(){this._disposed||(this._parent._destroyRef(this),this._disposed=!0)}isDisposed(){return this._disposed}}class Mg extends $a{constructor(...e){super(...e),this._emptySet=new Set,this._edges=new Set,this._parentEdges=new Map,this._childEdges=new Map}listEdges(){return Array.from(this._edges)}listParentEdges(e){return Array.from(this._childEdges.get(e)||this._emptySet)}listParents(e){const r=new Set;for(const n of this.listParentEdges(e))r.add(n.getParent());return Array.from(r)}listChildEdges(e){return Array.from(this._parentEdges.get(e)||this._emptySet)}listChildren(e){const r=new Set;for(const n of this.listChildEdges(e))r.add(n.getChild());return Array.from(r)}disconnectParents(e,r){for(const n of this.listParentEdges(e))(!r||r(n.getParent()))&&n.dispose();return this}_createEdge(e,r,n,s){const i=new ir(e,r,n,s);this._edges.add(i);const a=i.getParent();this._parentEdges.has(a)||this._parentEdges.set(a,new Set),this._parentEdges.get(a).add(i);const o=i.getChild();return this._childEdges.has(o)||this._childEdges.set(o,new Set),this._childEdges.get(o).add(i),i}_destroyEdge(e){return this._edges.delete(e),this._parentEdges.get(e.getParent()).delete(e),this._childEdges.get(e.getChild()).delete(e),this}}function br(){return br=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var r=arguments[e];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=r[n])}return t},br.apply(this,arguments)}class Ot{constructor(e){if(this.list=[],e)for(const r of e)this.list.push(r)}add(e){this.list.push(e)}remove(e){const r=this.list.indexOf(e);r>=0&&this.list.splice(r,1)}removeChild(e){const r=[];for(const n of this.list)n.getChild()===e&&r.push(n);for(const n of r)this.remove(n);return r}listRefsByChild(e){const r=[];for(const n of this.list)n.getChild()===e&&r.push(n);return r}values(){return this.list}}class ue{constructor(e){if(this.set=new Set,this.map=new Map,e)for(const r of e)this.add(r)}add(e){const r=e.getChild();this.removeChild(r),this.set.add(e),this.map.set(r,e)}remove(e){this.set.delete(e),this.map.delete(e.getChild())}removeChild(e){const r=this.map.get(e)||null;return r&&this.remove(r),r}getRefByChild(e){return this.map.get(e)||null}values(){return Array.from(this.set)}}class rt{constructor(e){this.map={},e&&Object.assign(this.map,e)}set(e,r){this.map[e]=r}delete(e){delete this.map[e]}get(e){return this.map[e]||null}keys(){return Object.keys(this.map)}values(){return Object.values(this.map)}}const ie=Symbol("attributes"),Vt=Symbol("immutableKeys");class ls extends $a{constructor(e){super(),this._disposed=!1,this.graph=void 0,this[ie]=void 0,this[Vt]=void 0,this.graph=e,this[Vt]=new Set,this[ie]=this._createAttributes()}getDefaults(){return{}}_createAttributes(){const e=this.getDefaults(),r={};for(const n in e){const s=e[n];if(s instanceof ls){const i=this.graph._createEdge(n,this,s);this[Vt].add(n),r[n]=i}else r[n]=s}return r}isOnGraph(e){return this.graph===e.graph}isDisposed(){return this._disposed}dispose(){this._disposed||(this.graph.listChildEdges(this).forEach(e=>e.dispose()),this.graph.disconnectParents(this),this._disposed=!0,this.dispatchEvent({type:"dispose"}))}detach(){return this.graph.disconnectParents(this),this}swap(e,r){for(const n in this[ie]){const s=this[ie][n];if(s instanceof ir){const i=s;i.getChild()===e&&this.setRef(n,r,i.getAttributes())}else if(s instanceof Ot)for(const i of s.listRefsByChild(e)){const a=i.getAttributes();this.removeRef(n,e),this.addRef(n,r,a)}else if(s instanceof ue){const i=s.getRefByChild(e);if(i){const a=i.getAttributes();this.removeRef(n,e),this.addRef(n,r,a)}}else if(s instanceof rt)for(const i of s.keys()){const a=s.get(i);a.getChild()===e&&this.setRefMap(n,i,r,a.getAttributes())}}return this}get(e){return this[ie][e]}set(e,r){return this[ie][e]=r,this.dispatchEvent({type:"change",attribute:e})}getRef(e){const r=this[ie][e];return r?r.getChild():null}setRef(e,r,n){if(this[Vt].has(e))throw new Error(`Cannot overwrite immutable attribute, "${e}".`);const s=this[ie][e];if(s&&s.dispose(),!r)return this;const i=this.graph._createEdge(e,this,r,n);return this[ie][e]=i,this.dispatchEvent({type:"change",attribute:e})}listRefs(e){return this.assertRefList(e).values().map(n=>n.getChild())}addRef(e,r,n){const s=this.graph._createEdge(e,this,r,n);return this.assertRefList(e).add(s),this.dispatchEvent({type:"change",attribute:e})}removeRef(e,r){const n=this.assertRefList(e);if(n instanceof Ot)for(const s of n.listRefsByChild(r))s.dispose();else{const s=n.getRefByChild(r);s&&s.dispose()}return this}assertRefList(e){const r=this[ie][e];if(r instanceof Ot||r instanceof ue)return r;throw new Error(`Expected RefList or RefSet for attribute "${e}"`)}listRefMapKeys(e){return this.assertRefMap(e).keys()}listRefMapValues(e){return this.assertRefMap(e).values().map(r=>r.getChild())}getRefMap(e,r){const s=this.assertRefMap(e).get(r);return s?s.getChild():null}setRefMap(e,r,n,s){const i=this.assertRefMap(e),a=i.get(r);if(a&&a.dispose(),!n)return this;s=Object.assign(s||{},{key:r});const o=this.graph._createEdge(e,this,n,br({},s,{key:r}));return i.set(r,o),this.dispatchEvent({type:"change",attribute:e,key:r})}assertRefMap(e){const r=this[ie][e];if(r instanceof rt)return r;throw new Error(`Expected RefMap for attribute "${e}"`)}dispatchEvent(e){return super.dispatchEvent(br({},e,{target:this})),this.graph.dispatchEvent(br({},e,{target:this,type:`node:${e.type}`})),this}_destroyRef(e){const r=e.getName();if(this[ie][r]===e)this[ie][r]=null,this[Vt].has(r)&&e.getChild().dispose();else if(this[ie][r]instanceof Ot)this[ie][r].remove(e);else if(this[ie][r]instanceof ue)this[ie][r].remove(e);else if(this[ie][r]instanceof rt){const n=this[ie][r];for(const s of n.keys())n.get(s)===e&&n.delete(s)}else return;this.graph._destroyEdge(e),this.dispatchEvent({type:"change",attribute:r})}}const Pa="v4.2.1",fr="@glb.bin";var $;(function(t){t.ACCESSOR="Accessor",t.ANIMATION="Animation",t.ANIMATION_CHANNEL="AnimationChannel",t.ANIMATION_SAMPLER="AnimationSampler",t.BUFFER="Buffer",t.CAMERA="Camera",t.MATERIAL="Material",t.MESH="Mesh",t.PRIMITIVE="Primitive",t.PRIMITIVE_TARGET="PrimitiveTarget",t.NODE="Node",t.ROOT="Root",t.SCENE="Scene",t.SKIN="Skin",t.TEXTURE="Texture",t.TEXTURE_INFO="TextureInfo"})($||($={}));var nn;(function(t){t.INTERLEAVED="interleaved",t.SEPARATE="separate"})(nn||(nn={}));var Ve;(function(t){t.ARRAY_BUFFER="ARRAY_BUFFER",t.ELEMENT_ARRAY_BUFFER="ELEMENT_ARRAY_BUFFER",t.INVERSE_BIND_MATRICES="INVERSE_BIND_MATRICES",t.OTHER="OTHER",t.SPARSE="SPARSE"})(Ve||(Ve={}));var Xe;(function(t){t[t.R=4096]="R",t[t.G=256]="G",t[t.B=16]="B",t[t.A=1]="A"})(Xe||(Xe={}));var Dt;(function(t){t.GLTF="GLTF",t.GLB="GLB"})(Dt||(Dt={}));const dn={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array};class ee{static createBufferFromDataURI(e){if(typeof Buffer>"u"){const r=atob(e.split(",")[1]),n=new Uint8Array(r.length);for(let s=0;s<r.length;s++)n[s]=r.charCodeAt(s);return n}else{const r=e.split(",")[1],n=e.indexOf("base64")>=0;return Buffer.from(r,n?"base64":"utf8")}}static encodeText(e){return new TextEncoder().encode(e)}static decodeText(e){return new TextDecoder().decode(e)}static concat(e){let r=0;for(const i of e)r+=i.byteLength;const n=new Uint8Array(r);let s=0;for(const i of e)n.set(i,s),s+=i.byteLength;return n}static pad(e,r=0){const n=this.padNumber(e.byteLength);if(n===e.byteLength)return e;const s=new Uint8Array(n);if(s.set(e),r!==0)for(let i=e.byteLength;i<n;i++)s[i]=r;return s}static padNumber(e){return Math.ceil(e/4)*4}static equals(e,r){if(e===r)return!0;if(e.byteLength!==r.byteLength)return!1;let n=e.byteLength;for(;n--;)if(e[n]!==r[n])return!1;return!0}static toView(e,r=0,n=1/0){return new Uint8Array(e.buffer,e.byteOffset+r,Math.min(e.byteLength,n))}static assertView(e){if(e&&!ArrayBuffer.isView(e))throw new Error(`Method requires Uint8Array parameter; received "${typeof e}".`);return e}}class Rg{match(e){return e.length>=3&&e[0]===255&&e[1]===216&&e[2]===255}getSize(e){let r=new DataView(e.buffer,e.byteOffset+4),n,s;for(;r.byteLength;){if(n=r.getUint16(0,!1),Ig(r,n),s=r.getUint8(n+1),s===192||s===193||s===194)return[r.getUint16(n+7,!1),r.getUint16(n+5,!1)];r=new DataView(e.buffer,r.byteOffset+n+2)}throw new TypeError("Invalid JPG, no size found")}getChannels(e){return 3}}class pn{match(e){return e.length>=8&&e[0]===137&&e[1]===80&&e[2]===78&&e[3]===71&&e[4]===13&&e[5]===10&&e[6]===26&&e[7]===10}getSize(e){const r=new DataView(e.buffer,e.byteOffset);return ee.decodeText(e.slice(12,16))===pn.PNG_FRIED_CHUNK_NAME?[r.getUint32(32,!1),r.getUint32(36,!1)]:[r.getUint32(16,!1),r.getUint32(20,!1)]}getChannels(e){return 4}}pn.PNG_FRIED_CHUNK_NAME="CgBI";class ft{static registerFormat(e,r){this.impls[e]=r}static getMimeType(e){for(const r in this.impls)if(this.impls[r].match(e))return r;return null}static getSize(e,r){return this.impls[r]?this.impls[r].getSize(e):null}static getChannels(e,r){return this.impls[r]?this.impls[r].getChannels(e):null}static getVRAMByteLength(e,r){if(!this.impls[r])return null;if(this.impls[r].getVRAMByteLength)return this.impls[r].getVRAMByteLength(e);let n=0;const s=4,i=this.getSize(e,r);if(!i)return null;for(;i[0]>1||i[1]>1;)n+=i[0]*i[1]*s,i[0]=Math.max(Math.floor(i[0]/2),1),i[1]=Math.max(Math.floor(i[1]/2),1);return n+=1*s,n}static mimeTypeToExtension(e){return e==="image/jpeg"?"jpg":e.split("/").pop()}static extensionToMimeType(e){return e==="jpg"?"image/jpeg":e?`image/${e}`:""}}ft.impls={"image/jpeg":new Rg,"image/png":new pn};function Ig(t,e){if(e>t.byteLength)throw new TypeError("Corrupt JPG, exceeded buffer limits");if(t.getUint8(e)!==255)throw new TypeError("Invalid JPG, marker table corrupted");return t}class lr{static basename(e){const r=e.split(/[\\/]/).pop();return r.substring(0,r.lastIndexOf("."))}static extension(e){if(e.startsWith("data:image/")){const r=e.match(/data:(image\/\w+)/)[1];return ft.mimeTypeToExtension(r)}else{if(e.startsWith("data:model/gltf+json"))return"gltf";if(e.startsWith("data:model/gltf-binary"))return"glb";if(e.startsWith("data:application/"))return"bin"}return e.split(/[\\/]/).pop().split(/[.]/).pop()}}var Vn=typeof Float32Array<"u"?Float32Array:Array;Math.hypot||(Math.hypot=function(){for(var t=0,e=arguments.length;e--;)t+=arguments[e]*arguments[e];return Math.sqrt(t)});function _g(){var t=new Vn(3);return Vn!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t}function On(t){var e=t[0],r=t[1],n=t[2];return Math.hypot(e,r,n)}function wg(t,e,r){var n=e[0],s=e[1],i=e[2],a=r[3]*n+r[7]*s+r[11]*i+r[15];return a=a||1,t[0]=(r[0]*n+r[4]*s+r[8]*i+r[12])/a,t[1]=(r[1]*n+r[5]*s+r[9]*i+r[13])/a,t[2]=(r[2]*n+r[6]*s+r[10]*i+r[14])/a,t}(function(){var t=_g();return function(e,r,n,s,i,a){var o,c;for(r||(r=3),n||(n=0),s?c=Math.min(s*r+n,e.length):c=e.length,o=n;o<c;o+=r)t[0]=e[o],t[1]=e[o+1],t[2]=e[o+2],i(t,t,a),e[o]=t[0],e[o+1]=t[1],e[o+2]=t[2];return e}})();function Ag(t){const e=Ua(),r=t.propertyType===$.NODE?[t]:t.listChildren();for(const n of r)n.traverse(s=>{const i=s.getMesh();if(!i)return;const a=bg(i,s.getWorldMatrix());a.min.every(isFinite)&&a.max.every(isFinite)&&(zn(a.min,e),zn(a.max,e))});return e}function bg(t,e){const r=Ua();for(const n of t.listPrimitives()){const s=n.getAttribute("POSITION"),i=n.getIndices();if(!s)continue;let a=[0,0,0],o=[0,0,0];for(let c=0,f=i?i.getCount():s.getCount();c<f;c++){const h=i?i.getScalar(c):c;a=s.getElement(h,a),o=wg(o,a,e),zn(o,r)}}return r}function zn(t,e){for(let r=0;r<3;r++)e.min[r]=Math.min(t[r],e.min[r]),e.max[r]=Math.max(t[r],e.max[r])}function Ua(){return{min:[1/0,1/0,1/0],max:[-1/0,-1/0,-1/0]}}const Ws="https://null.example";class Sr{static dirname(e){const r=e.lastIndexOf("/");return r===-1?"./":e.substring(0,r+1)}static basename(e){return lr.basename(new URL(e,Ws).pathname)}static extension(e){return lr.extension(new URL(e,Ws).pathname)}static resolve(e,r){if(!this.isRelativePath(r))return r;const n=e.split("/"),s=r.split("/");n.pop();for(let i=0;i<s.length;i++)s[i]!=="."&&(s[i]===".."?n.pop():n.push(s[i]));return n.join("/")}static isAbsoluteURL(e){return this.PROTOCOL_REGEXP.test(e)}static isRelativePath(e){return!/^(?:[a-zA-Z]+:)?\//.test(e)}}Sr.DEFAULT_INIT={};Sr.PROTOCOL_REGEXP=/^[a-zA-Z]+:\/\//;function Xs(t){return Object.prototype.toString.call(t)==="[object Object]"}function kt(t){if(Xs(t)===!1)return!1;const e=t.constructor;if(e===void 0)return!0;const r=e.prototype;return!(Xs(r)===!1||Object.hasOwn(r,"isPrototypeOf")===!1)}var kn,Gn;(function(t){t[t.SILENT=4]="SILENT",t[t.ERROR=3]="ERROR",t[t.WARN=2]="WARN",t[t.INFO=1]="INFO",t[t.DEBUG=0]="DEBUG"})(Gn||(Gn={}));class We{constructor(e){this.verbosity=void 0,this.verbosity=e}debug(e){this.verbosity<=We.Verbosity.DEBUG&&console.debug(e)}info(e){this.verbosity<=We.Verbosity.INFO&&console.info(e)}warn(e){this.verbosity<=We.Verbosity.WARN&&console.warn(e)}error(e){this.verbosity<=We.Verbosity.ERROR&&console.error(e)}}kn=We;We.Verbosity=Gn;We.DEFAULT_INSTANCE=new kn(kn.Verbosity.INFO);function Sg(t){var e=t[0],r=t[1],n=t[2],s=t[3],i=t[4],a=t[5],o=t[6],c=t[7],f=t[8],h=t[9],d=t[10],p=t[11],g=t[12],E=t[13],M=t[14],T=t[15],v=e*a-r*i,D=e*o-n*i,R=e*c-s*i,w=r*o-n*a,A=r*c-s*a,S=n*c-s*o,x=f*E-h*g,I=f*M-d*g,b=f*T-p*g,N=h*M-d*E,B=h*T-p*E,U=d*T-p*M;return v*U-D*B+R*N+w*b-A*I+S*x}function Ng(t,e,r){var n=e[0],s=e[1],i=e[2],a=e[3],o=e[4],c=e[5],f=e[6],h=e[7],d=e[8],p=e[9],g=e[10],E=e[11],M=e[12],T=e[13],v=e[14],D=e[15],R=r[0],w=r[1],A=r[2],S=r[3];return t[0]=R*n+w*o+A*d+S*M,t[1]=R*s+w*c+A*p+S*T,t[2]=R*i+w*f+A*g+S*v,t[3]=R*a+w*h+A*E+S*D,R=r[4],w=r[5],A=r[6],S=r[7],t[4]=R*n+w*o+A*d+S*M,t[5]=R*s+w*c+A*p+S*T,t[6]=R*i+w*f+A*g+S*v,t[7]=R*a+w*h+A*E+S*D,R=r[8],w=r[9],A=r[10],S=r[11],t[8]=R*n+w*o+A*d+S*M,t[9]=R*s+w*c+A*p+S*T,t[10]=R*i+w*f+A*g+S*v,t[11]=R*a+w*h+A*E+S*D,R=r[12],w=r[13],A=r[14],S=r[15],t[12]=R*n+w*o+A*d+S*M,t[13]=R*s+w*c+A*p+S*T,t[14]=R*i+w*f+A*g+S*v,t[15]=R*a+w*h+A*E+S*D,t}function Cg(t,e){var r=e[0],n=e[1],s=e[2],i=e[4],a=e[5],o=e[6],c=e[8],f=e[9],h=e[10];return t[0]=Math.hypot(r,n,s),t[1]=Math.hypot(i,a,o),t[2]=Math.hypot(c,f,h),t}function Og(t,e){var r=new Vn(3);Cg(r,e);var n=1/r[0],s=1/r[1],i=1/r[2],a=e[0]*n,o=e[1]*s,c=e[2]*i,f=e[4]*n,h=e[5]*s,d=e[6]*i,p=e[8]*n,g=e[9]*s,E=e[10]*i,M=a+h+E,T=0;return M>0?(T=Math.sqrt(M+1)*2,t[3]=.25*T,t[0]=(d-g)/T,t[1]=(p-c)/T,t[2]=(o-f)/T):a>h&&a>E?(T=Math.sqrt(1+a-h-E)*2,t[3]=(d-g)/T,t[0]=.25*T,t[1]=(o+f)/T,t[2]=(p+c)/T):h>E?(T=Math.sqrt(1+h-a-E)*2,t[3]=(p-c)/T,t[0]=(o+f)/T,t[1]=.25*T,t[2]=(d+g)/T):(T=Math.sqrt(1+E-a-h)*2,t[3]=(o-f)/T,t[0]=(p+c)/T,t[1]=(d+g)/T,t[2]=.25*T),t}class ce{static identity(e){return e}static eq(e,r,n=1e-5){if(e.length!==r.length)return!1;for(let s=0;s<e.length;s++)if(Math.abs(e[s]-r[s])>n)return!1;return!0}static clamp(e,r,n){return e<r?r:e>n?n:e}static decodeNormalizedInt(e,r){switch(r){case 5126:return e;case 5123:return e/65535;case 5121:return e/255;case 5122:return Math.max(e/32767,-1);case 5120:return Math.max(e/127,-1);default:throw new Error("Invalid component type.")}}static encodeNormalizedInt(e,r){switch(r){case 5126:return e;case 5123:return Math.round(ce.clamp(e,0,1)*65535);case 5121:return Math.round(ce.clamp(e,0,1)*255);case 5122:return Math.round(ce.clamp(e,-1,1)*32767);case 5120:return Math.round(ce.clamp(e,-1,1)*127);default:throw new Error("Invalid component type.")}}static decompose(e,r,n,s){let i=On([e[0],e[1],e[2]]);const a=On([e[4],e[5],e[6]]),o=On([e[8],e[9],e[10]]);Sg(e)<0&&(i=-i),r[0]=e[12],r[1]=e[13],r[2]=e[14];const f=e.slice(),h=1/i,d=1/a,p=1/o;f[0]*=h,f[1]*=h,f[2]*=h,f[4]*=d,f[5]*=d,f[6]*=d,f[8]*=p,f[9]*=p,f[10]*=p,Og(n,f),s[0]=i,s[1]=a,s[2]=o}static compose(e,r,n,s){const i=s,a=r[0],o=r[1],c=r[2],f=r[3],h=a+a,d=o+o,p=c+c,g=a*h,E=a*d,M=a*p,T=o*d,v=o*p,D=c*p,R=f*h,w=f*d,A=f*p,S=n[0],x=n[1],I=n[2];return i[0]=(1-(T+D))*S,i[1]=(E+A)*S,i[2]=(M-w)*S,i[3]=0,i[4]=(E-A)*x,i[5]=(1-(g+D))*x,i[6]=(v+R)*x,i[7]=0,i[8]=(M+w)*I,i[9]=(v-R)*I,i[10]=(1-(g+T))*I,i[11]=0,i[12]=e[0],i[13]=e[1],i[14]=e[2],i[15]=1,i}}function Dg(t,e){if(!!t!=!!e)return!1;const r=t.getChild(),n=e.getChild();return r===n||r.equals(n)}function Fg(t,e){if(!!t!=!!e)return!1;const r=t.values(),n=e.values();if(r.length!==n.length)return!1;for(let s=0;s<r.length;s++){const i=r[s],a=n[s];if(i.getChild()!==a.getChild()&&!i.getChild().equals(a.getChild()))return!1}return!0}function $g(t,e){if(!!t!=!!e)return!1;const r=t.keys(),n=e.keys();if(r.length!==n.length)return!1;for(const s of r){const i=t.get(s),a=e.get(s);if(!!i!=!!a)return!1;const o=i.getChild(),c=a.getChild();if(o!==c&&!o.equals(c))return!1}return!0}function La(t,e){if(t===e)return!0;if(!!t!=!!e||!t||!e||t.length!==e.length)return!1;for(let r=0;r<t.length;r++)if(t[r]!==e[r])return!1;return!0}function Ba(t,e){if(t===e)return!0;if(!!t!=!!e)return!1;if(!kt(t)||!kt(e))return t===e;const r=t,n=e;let s=0,i=0,a;for(a in r)s++;for(a in n)i++;if(s!==i)return!1;for(a in r){const o=r[a],c=n[a];if(sn(o)&&sn(c)){if(!La(o,c))return!1}else if(kt(o)&&kt(c)){if(!Ba(o,c))return!1}else if(o!==c)return!1}return!0}function sn(t){return Array.isArray(t)||ArrayBuffer.isView(t)}const Ks="23456789abdegjkmnpqrvwxyzABDEGJKMNPQRVWXYZ",Pg=999,Ug=6,Ys=new Set,Lg=function(){let e="";for(let r=0;r<Ug;r++)e+=Ks.charAt(Math.floor(Math.random()*Ks.length));return e},Bg=function(){for(let e=0;e<Pg;e++){const r=Lg();if(!Ys.has(r))return Ys.add(r),r}return""},Ft=t=>t,jg=new Set;class us extends ls{constructor(e,r=""){super(e),this[ie].name=r,this.init(),this.dispatchEvent({type:"create"})}getGraph(){return this.graph}getDefaults(){return Object.assign(super.getDefaults(),{name:"",extras:{}})}set(e,r){return Array.isArray(r)&&(r=r.slice()),super.set(e,r)}getName(){return this.get("name")}setName(e){return this.set("name",e)}getExtras(){return this.get("extras")}setExtras(e){return this.set("extras",e)}clone(){const e=this.constructor;return new e(this.graph).copy(this,Ft)}copy(e,r=Ft){for(const n in this[ie]){const s=this[ie][n];if(s instanceof ir)this[Vt].has(n)||s.dispose();else if(s instanceof Ot||s instanceof ue)for(const i of s.values())i.dispose();else if(s instanceof rt)for(const i of s.values())i.dispose()}for(const n in e[ie]){const s=this[ie][n],i=e[ie][n];if(i instanceof ir)this[Vt].has(n)?s.getChild().copy(r(i.getChild()),r):this.setRef(n,r(i.getChild()),i.getAttributes());else if(i instanceof ue||i instanceof Ot)for(const a of i.values())this.addRef(n,r(a.getChild()),a.getAttributes());else if(i instanceof rt)for(const a of i.keys()){const o=i.get(a);this.setRefMap(n,a,r(o.getChild()),o.getAttributes())}else kt(i)?this[ie][n]=JSON.parse(JSON.stringify(i)):Array.isArray(i)||i instanceof ArrayBuffer||ArrayBuffer.isView(i)?this[ie][n]=i.slice():this[ie][n]=i}return this}equals(e,r=jg){if(this===e)return!0;if(this.propertyType!==e.propertyType)return!1;for(const n in this[ie]){if(r.has(n))continue;const s=this[ie][n],i=e[ie][n];if(s instanceof ir||i instanceof ir){if(!Dg(s,i))return!1}else if(s instanceof ue||i instanceof ue||s instanceof Ot||i instanceof Ot){if(!Fg(s,i))return!1}else if(s instanceof rt||i instanceof rt){if(!$g(s,i))return!1}else if(kt(s)||kt(i)){if(!Ba(s,i))return!1}else if(sn(s)||sn(i)){if(!La(s,i))return!1}else if(s!==i)return!1}return!0}detach(){return this.graph.disconnectParents(this,e=>e.propertyType!=="Root"),this}listParents(){return this.graph.listParents(this)}}class Pe extends us{getDefaults(){return Object.assign(super.getDefaults(),{extensions:new rt})}getExtension(e){return this.getRefMap("extensions",e)}setExtension(e,r){return r&&r._validateParent(this),this.setRefMap("extensions",e,r)}listExtensions(){return this.listRefMapValues("extensions")}}class q extends Pe{init(){this.propertyType=$.ACCESSOR}getDefaults(){return Object.assign(super.getDefaults(),{array:null,type:q.Type.SCALAR,componentType:q.ComponentType.FLOAT,normalized:!1,sparse:!1,buffer:null})}static getElementSize(e){switch(e){case q.Type.SCALAR:return 1;case q.Type.VEC2:return 2;case q.Type.VEC3:return 3;case q.Type.VEC4:return 4;case q.Type.MAT2:return 4;case q.Type.MAT3:return 9;case q.Type.MAT4:return 16;default:throw new Error("Unexpected type: "+e)}}static getComponentSize(e){switch(e){case q.ComponentType.BYTE:return 1;case q.ComponentType.UNSIGNED_BYTE:return 1;case q.ComponentType.SHORT:return 2;case q.ComponentType.UNSIGNED_SHORT:return 2;case q.ComponentType.UNSIGNED_INT:return 4;case q.ComponentType.FLOAT:return 4;default:throw new Error("Unexpected component type: "+e)}}getMinNormalized(e){const r=this.getNormalized(),n=this.getElementSize(),s=this.getComponentType();if(this.getMin(e),r)for(let i=0;i<n;i++)e[i]=ce.decodeNormalizedInt(e[i],s);return e}getMin(e){const r=this.getArray(),n=this.getCount(),s=this.getElementSize();for(let i=0;i<s;i++)e[i]=1/0;for(let i=0;i<n*s;i+=s)for(let a=0;a<s;a++){const o=r[i+a];Number.isFinite(o)&&(e[a]=Math.min(e[a],o))}return e}getMaxNormalized(e){const r=this.getNormalized(),n=this.getElementSize(),s=this.getComponentType();if(this.getMax(e),r)for(let i=0;i<n;i++)e[i]=ce.decodeNormalizedInt(e[i],s);return e}getMax(e){const r=this.get("array"),n=this.getCount(),s=this.getElementSize();for(let i=0;i<s;i++)e[i]=-1/0;for(let i=0;i<n*s;i+=s)for(let a=0;a<s;a++){const o=r[i+a];Number.isFinite(o)&&(e[a]=Math.max(e[a],o))}return e}getCount(){const e=this.get("array");return e?e.length/this.getElementSize():0}getType(){return this.get("type")}setType(e){return this.set("type",e)}getElementSize(){return q.getElementSize(this.get("type"))}getComponentSize(){return this.get("array").BYTES_PER_ELEMENT}getComponentType(){return this.get("componentType")}getNormalized(){return this.get("normalized")}setNormalized(e){return this.set("normalized",e)}getScalar(e){const r=this.getElementSize(),n=this.getComponentType(),s=this.getArray();return this.getNormalized()?ce.decodeNormalizedInt(s[e*r],n):s[e*r]}setScalar(e,r){const n=this.getElementSize(),s=this.getComponentType(),i=this.getArray();return this.getNormalized()?i[e*n]=ce.encodeNormalizedInt(r,s):i[e*n]=r,this}getElement(e,r){const n=this.getNormalized(),s=this.getElementSize(),i=this.getComponentType(),a=this.getArray();for(let o=0;o<s;o++)n?r[o]=ce.decodeNormalizedInt(a[e*s+o],i):r[o]=a[e*s+o];return r}setElement(e,r){const n=this.getNormalized(),s=this.getElementSize(),i=this.getComponentType(),a=this.getArray();for(let o=0;o<s;o++)n?a[e*s+o]=ce.encodeNormalizedInt(r[o],i):a[e*s+o]=r[o];return this}getSparse(){return this.get("sparse")}setSparse(e){return this.set("sparse",e)}getBuffer(){return this.getRef("buffer")}setBuffer(e){return this.setRef("buffer",e)}getArray(){return this.get("array")}setArray(e){return this.set("componentType",e?Vg(e):q.ComponentType.FLOAT),this.set("array",e),this}getByteLength(){const e=this.get("array");return e?e.byteLength:0}}q.Type={SCALAR:"SCALAR",VEC2:"VEC2",VEC3:"VEC3",VEC4:"VEC4",MAT2:"MAT2",MAT3:"MAT3",MAT4:"MAT4"};q.ComponentType={BYTE:5120,UNSIGNED_BYTE:5121,SHORT:5122,UNSIGNED_SHORT:5123,UNSIGNED_INT:5125,FLOAT:5126};function Vg(t){switch(t.constructor){case Float32Array:return q.ComponentType.FLOAT;case Uint32Array:return q.ComponentType.UNSIGNED_INT;case Uint16Array:return q.ComponentType.UNSIGNED_SHORT;case Uint8Array:return q.ComponentType.UNSIGNED_BYTE;case Int16Array:return q.ComponentType.SHORT;case Int8Array:return q.ComponentType.BYTE;default:throw new Error("Unknown accessor componentType.")}}class ja extends Pe{init(){this.propertyType=$.ANIMATION}getDefaults(){return Object.assign(super.getDefaults(),{channels:new ue,samplers:new ue})}addChannel(e){return this.addRef("channels",e)}removeChannel(e){return this.removeRef("channels",e)}listChannels(){return this.listRefs("channels")}addSampler(e){return this.addRef("samplers",e)}removeSampler(e){return this.removeRef("samplers",e)}listSamplers(){return this.listRefs("samplers")}}class hs extends Pe{init(){this.propertyType=$.ANIMATION_CHANNEL}getDefaults(){return Object.assign(super.getDefaults(),{targetPath:null,targetNode:null,sampler:null})}getTargetPath(){return this.get("targetPath")}setTargetPath(e){return this.set("targetPath",e)}getTargetNode(){return this.getRef("targetNode")}setTargetNode(e){return this.setRef("targetNode",e)}getSampler(){return this.getRef("sampler")}setSampler(e){return this.setRef("sampler",e)}}hs.TargetPath={TRANSLATION:"translation",ROTATION:"rotation",SCALE:"scale",WEIGHTS:"weights"};class dr extends Pe{init(){this.propertyType=$.ANIMATION_SAMPLER}getDefaultAttributes(){return Object.assign(super.getDefaults(),{interpolation:dr.Interpolation.LINEAR,input:null,output:null})}getInterpolation(){return this.get("interpolation")}setInterpolation(e){return this.set("interpolation",e)}getInput(){return this.getRef("input")}setInput(e){return this.setRef("input",e,{usage:Ve.OTHER})}getOutput(){return this.getRef("output")}setOutput(e){return this.setRef("output",e,{usage:Ve.OTHER})}}dr.Interpolation={LINEAR:"LINEAR",STEP:"STEP",CUBICSPLINE:"CUBICSPLINE"};class Va extends Pe{init(){this.propertyType=$.BUFFER}getDefaults(){return Object.assign(super.getDefaults(),{uri:""})}getURI(){return this.get("uri")}setURI(e){return this.set("uri",e)}}class Yt extends Pe{init(){this.propertyType=$.CAMERA}getDefaults(){return Object.assign(super.getDefaults(),{type:Yt.Type.PERSPECTIVE,znear:.1,zfar:100,aspectRatio:null,yfov:Math.PI*2*50/360,xmag:1,ymag:1})}getType(){return this.get("type")}setType(e){return this.set("type",e)}getZNear(){return this.get("znear")}setZNear(e){return this.set("znear",e)}getZFar(){return this.get("zfar")}setZFar(e){return this.set("zfar",e)}getAspectRatio(){return this.get("aspectRatio")}setAspectRatio(e){return this.set("aspectRatio",e)}getYFov(){return this.get("yfov")}setYFov(e){return this.set("yfov",e)}getXMag(){return this.get("xmag")}setXMag(e){return this.set("xmag",e)}getYMag(){return this.get("ymag")}setYMag(e){return this.set("ymag",e)}}Yt.Type={PERSPECTIVE:"perspective",ORTHOGRAPHIC:"orthographic"};class ge extends us{_validateParent(e){if(!this.parentTypes.includes(e.propertyType))throw new Error(`Parent "${e.propertyType}" invalid for child "${this.propertyType}".`)}}ge.EXTENSION_NAME=void 0;class le extends Pe{init(){this.propertyType=$.TEXTURE_INFO}getDefaults(){return Object.assign(super.getDefaults(),{texCoord:0,magFilter:null,minFilter:null,wrapS:le.WrapMode.REPEAT,wrapT:le.WrapMode.REPEAT})}getTexCoord(){return this.get("texCoord")}setTexCoord(e){return this.set("texCoord",e)}getMagFilter(){return this.get("magFilter")}setMagFilter(e){return this.set("magFilter",e)}getMinFilter(){return this.get("minFilter")}setMinFilter(e){return this.set("minFilter",e)}getWrapS(){return this.get("wrapS")}setWrapS(e){return this.set("wrapS",e)}getWrapT(){return this.get("wrapT")}setWrapT(e){return this.set("wrapT",e)}}le.WrapMode={CLAMP_TO_EDGE:33071,MIRRORED_REPEAT:33648,REPEAT:10497};le.MagFilter={NEAREST:9728,LINEAR:9729};le.MinFilter={NEAREST:9728,LINEAR:9729,NEAREST_MIPMAP_NEAREST:9984,LINEAR_MIPMAP_NEAREST:9985,NEAREST_MIPMAP_LINEAR:9986,LINEAR_MIPMAP_LINEAR:9987};const{R:Wr,G:Xr,B:Kr,A:zg}=Xe;class $t extends Pe{init(){this.propertyType=$.MATERIAL}getDefaults(){return Object.assign(super.getDefaults(),{alphaMode:$t.AlphaMode.OPAQUE,alphaCutoff:.5,doubleSided:!1,baseColorFactor:[1,1,1,1],baseColorTexture:null,baseColorTextureInfo:new le(this.graph,"baseColorTextureInfo"),emissiveFactor:[0,0,0],emissiveTexture:null,emissiveTextureInfo:new le(this.graph,"emissiveTextureInfo"),normalScale:1,normalTexture:null,normalTextureInfo:new le(this.graph,"normalTextureInfo"),occlusionStrength:1,occlusionTexture:null,occlusionTextureInfo:new le(this.graph,"occlusionTextureInfo"),roughnessFactor:1,metallicFactor:1,metallicRoughnessTexture:null,metallicRoughnessTextureInfo:new le(this.graph,"metallicRoughnessTextureInfo")})}getDoubleSided(){return this.get("doubleSided")}setDoubleSided(e){return this.set("doubleSided",e)}getAlpha(){return this.get("baseColorFactor")[3]}setAlpha(e){const r=this.get("baseColorFactor").slice();return r[3]=e,this.set("baseColorFactor",r)}getAlphaMode(){return this.get("alphaMode")}setAlphaMode(e){return this.set("alphaMode",e)}getAlphaCutoff(){return this.get("alphaCutoff")}setAlphaCutoff(e){return this.set("alphaCutoff",e)}getBaseColorFactor(){return this.get("baseColorFactor")}setBaseColorFactor(e){return this.set("baseColorFactor",e)}getBaseColorTexture(){return this.getRef("baseColorTexture")}getBaseColorTextureInfo(){return this.getRef("baseColorTexture")?this.getRef("baseColorTextureInfo"):null}setBaseColorTexture(e){return this.setRef("baseColorTexture",e,{channels:Wr|Xr|Kr|zg,isColor:!0})}getEmissiveFactor(){return this.get("emissiveFactor")}setEmissiveFactor(e){return this.set("emissiveFactor",e)}getEmissiveTexture(){return this.getRef("emissiveTexture")}getEmissiveTextureInfo(){return this.getRef("emissiveTexture")?this.getRef("emissiveTextureInfo"):null}setEmissiveTexture(e){return this.setRef("emissiveTexture",e,{channels:Wr|Xr|Kr,isColor:!0})}getNormalScale(){return this.get("normalScale")}setNormalScale(e){return this.set("normalScale",e)}getNormalTexture(){return this.getRef("normalTexture")}getNormalTextureInfo(){return this.getRef("normalTexture")?this.getRef("normalTextureInfo"):null}setNormalTexture(e){return this.setRef("normalTexture",e,{channels:Wr|Xr|Kr})}getOcclusionStrength(){return this.get("occlusionStrength")}setOcclusionStrength(e){return this.set("occlusionStrength",e)}getOcclusionTexture(){return this.getRef("occlusionTexture")}getOcclusionTextureInfo(){return this.getRef("occlusionTexture")?this.getRef("occlusionTextureInfo"):null}setOcclusionTexture(e){return this.setRef("occlusionTexture",e,{channels:Wr})}getRoughnessFactor(){return this.get("roughnessFactor")}setRoughnessFactor(e){return this.set("roughnessFactor",e)}getMetallicFactor(){return this.get("metallicFactor")}setMetallicFactor(e){return this.set("metallicFactor",e)}getMetallicRoughnessTexture(){return this.getRef("metallicRoughnessTexture")}getMetallicRoughnessTextureInfo(){return this.getRef("metallicRoughnessTexture")?this.getRef("metallicRoughnessTextureInfo"):null}setMetallicRoughnessTexture(e){return this.setRef("metallicRoughnessTexture",e,{channels:Xr|Kr})}}$t.AlphaMode={OPAQUE:"OPAQUE",MASK:"MASK",BLEND:"BLEND"};class za extends Pe{init(){this.propertyType=$.MESH}getDefaults(){return Object.assign(super.getDefaults(),{weights:[],primitives:new ue})}addPrimitive(e){return this.addRef("primitives",e)}removePrimitive(e){return this.removeRef("primitives",e)}listPrimitives(){return this.listRefs("primitives")}getWeights(){return this.get("weights")}setWeights(e){return this.set("weights",e)}}class ka extends Pe{init(){this.propertyType=$.NODE}getDefaults(){return Object.assign(super.getDefaults(),{translation:[0,0,0],rotation:[0,0,0,1],scale:[1,1,1],weights:[],camera:null,mesh:null,skin:null,children:new ue})}copy(e,r=Ft){if(r===Ft)throw new Error("Node cannot be copied.");return super.copy(e,r)}getTranslation(){return this.get("translation")}getRotation(){return this.get("rotation")}getScale(){return this.get("scale")}setTranslation(e){return this.set("translation",e)}setRotation(e){return this.set("rotation",e)}setScale(e){return this.set("scale",e)}getMatrix(){return ce.compose(this.get("translation"),this.get("rotation"),this.get("scale"),[])}setMatrix(e){const r=this.get("translation").slice(),n=this.get("rotation").slice(),s=this.get("scale").slice();return ce.decompose(e,r,n,s),this.set("translation",r).set("rotation",n).set("scale",s)}getWorldTranslation(){const e=[0,0,0];return ce.decompose(this.getWorldMatrix(),e,[0,0,0,1],[1,1,1]),e}getWorldRotation(){const e=[0,0,0,1];return ce.decompose(this.getWorldMatrix(),[0,0,0],e,[1,1,1]),e}getWorldScale(){const e=[1,1,1];return ce.decompose(this.getWorldMatrix(),[0,0,0],[0,0,0,1],e),e}getWorldMatrix(){const e=[];for(let s=this;s!=null;s=s.getParentNode())e.push(s);let r;const n=e.pop().getMatrix();for(;r=e.pop();)Ng(n,n,r.getMatrix());return n}addChild(e){const r=e.getParentNode();r&&r.removeChild(e);for(const n of e.listParents())n.propertyType===$.SCENE&&n.removeChild(e);return this.addRef("children",e)}removeChild(e){return this.removeRef("children",e)}listChildren(){return this.listRefs("children")}getParentNode(){for(const e of this.listParents())if(e.propertyType===$.NODE)return e;return null}getMesh(){return this.getRef("mesh")}setMesh(e){return this.setRef("mesh",e)}getCamera(){return this.getRef("camera")}setCamera(e){return this.setRef("camera",e)}getSkin(){return this.getRef("skin")}setSkin(e){return this.setRef("skin",e)}getWeights(){return this.get("weights")}setWeights(e){return this.set("weights",e)}traverse(e){e(this);for(const r of this.listChildren())r.traverse(e);return this}}class qt extends Pe{init(){this.propertyType=$.PRIMITIVE}getDefaults(){return Object.assign(super.getDefaults(),{mode:qt.Mode.TRIANGLES,material:null,indices:null,attributes:new rt,targets:new ue})}getIndices(){return this.getRef("indices")}setIndices(e){return this.setRef("indices",e,{usage:Ve.ELEMENT_ARRAY_BUFFER})}getAttribute(e){return this.getRefMap("attributes",e)}setAttribute(e,r){return this.setRefMap("attributes",e,r,{usage:Ve.ARRAY_BUFFER})}listAttributes(){return this.listRefMapValues("attributes")}listSemantics(){return this.listRefMapKeys("attributes")}getMaterial(){return this.getRef("material")}setMaterial(e){return this.setRef("material",e)}getMode(){return this.get("mode")}setMode(e){return this.set("mode",e)}listTargets(){return this.listRefs("targets")}addTarget(e){return this.addRef("targets",e)}removeTarget(e){return this.removeRef("targets",e)}}qt.Mode={POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6};class kg extends us{init(){this.propertyType=$.PRIMITIVE_TARGET}getDefaults(){return Object.assign(super.getDefaults(),{attributes:new rt})}getAttribute(e){return this.getRefMap("attributes",e)}setAttribute(e,r){return this.setRefMap("attributes",e,r,{usage:Ve.ARRAY_BUFFER})}listAttributes(){return this.listRefMapValues("attributes")}listSemantics(){return this.listRefMapKeys("attributes")}}function $e(){return $e=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var r=arguments[e];for(var n in r)({}).hasOwnProperty.call(r,n)&&(t[n]=r[n])}return t},$e.apply(null,arguments)}class Ga extends Pe{init(){this.propertyType=$.SCENE}getDefaults(){return Object.assign(super.getDefaults(),{children:new ue})}copy(e,r=Ft){if(r===Ft)throw new Error("Scene cannot be copied.");return super.copy(e,r)}addChild(e){const r=e.getParentNode();return r&&r.removeChild(e),this.addRef("children",e)}removeChild(e){return this.removeRef("children",e)}listChildren(){return this.listRefs("children")}traverse(e){for(const r of this.listChildren())r.traverse(e);return this}}class Ha extends Pe{init(){this.propertyType=$.SKIN}getDefaults(){return Object.assign(super.getDefaults(),{skeleton:null,inverseBindMatrices:null,joints:new ue})}getSkeleton(){return this.getRef("skeleton")}setSkeleton(e){return this.setRef("skeleton",e)}getInverseBindMatrices(){return this.getRef("inverseBindMatrices")}setInverseBindMatrices(e){return this.setRef("inverseBindMatrices",e,{usage:Ve.INVERSE_BIND_MATRICES})}addJoint(e){return this.addRef("joints",e)}removeJoint(e){return this.removeRef("joints",e)}listJoints(){return this.listRefs("joints")}}class qa extends Pe{init(){this.propertyType=$.TEXTURE}getDefaults(){return Object.assign(super.getDefaults(),{image:null,mimeType:"",uri:""})}getMimeType(){return this.get("mimeType")||ft.extensionToMimeType(lr.extension(this.get("uri")))}setMimeType(e){return this.set("mimeType",e)}getURI(){return this.get("uri")}setURI(e){this.set("uri",e);const r=ft.extensionToMimeType(lr.extension(e));return r&&this.set("mimeType",r),this}getImage(){return this.get("image")}setImage(e){return this.set("image",ee.assertView(e))}getSize(){const e=this.get("image");return e?ft.getSize(e,this.getMimeType()):null}}class Wa extends Pe{init(){this.propertyType=$.ROOT}getDefaults(){return Object.assign(super.getDefaults(),{asset:{generator:`glTF-Transform ${Pa}`,version:"2.0"},defaultScene:null,accessors:new ue,animations:new ue,buffers:new ue,cameras:new ue,materials:new ue,meshes:new ue,nodes:new ue,scenes:new ue,skins:new ue,textures:new ue})}constructor(e){super(e),this._extensions=new Set,e.addEventListener("node:create",r=>{this._addChildOfRoot(r.target)})}clone(){throw new Error("Root cannot be cloned.")}copy(e,r=Ft){if(r===Ft)throw new Error("Root cannot be copied.");this.set("asset",$e({},e.get("asset"))),this.setName(e.getName()),this.setExtras($e({},e.getExtras())),this.setDefaultScene(e.getDefaultScene()?r(e.getDefaultScene()):null);for(const n of e.listRefMapKeys("extensions")){const s=e.getExtension(n);this.setExtension(n,r(s))}return this}_addChildOfRoot(e){return e instanceof Ga?this.addRef("scenes",e):e instanceof ka?this.addRef("nodes",e):e instanceof Yt?this.addRef("cameras",e):e instanceof Ha?this.addRef("skins",e):e instanceof za?this.addRef("meshes",e):e instanceof $t?this.addRef("materials",e):e instanceof qa?this.addRef("textures",e):e instanceof ja?this.addRef("animations",e):e instanceof q?this.addRef("accessors",e):e instanceof Va&&this.addRef("buffers",e),this}getAsset(){return this.get("asset")}listExtensionsUsed(){return Array.from(this._extensions)}listExtensionsRequired(){return this.listExtensionsUsed().filter(e=>e.isRequired())}_enableExtension(e){return this._extensions.add(e),this}_disableExtension(e){return this._extensions.delete(e),this}listScenes(){return this.listRefs("scenes")}setDefaultScene(e){return this.setRef("defaultScene",e)}getDefaultScene(){return this.getRef("defaultScene")}listNodes(){return this.listRefs("nodes")}listCameras(){return this.listRefs("cameras")}listSkins(){return this.listRefs("skins")}listMeshes(){return this.listRefs("meshes")}listMaterials(){return this.listRefs("materials")}listTextures(){return this.listRefs("textures")}listAnimations(){return this.listRefs("animations")}listAccessors(){return this.listRefs("accessors")}listBuffers(){return this.listRefs("buffers")}}class ur{static fromGraph(e){return ur._GRAPH_DOCUMENTS.get(e)||null}constructor(){this._graph=new Mg,this._root=new Wa(this._graph),this._logger=We.DEFAULT_INSTANCE,ur._GRAPH_DOCUMENTS.set(this._graph,this)}getRoot(){return this._root}getGraph(){return this._graph}getLogger(){return this._logger}setLogger(e){return this._logger=e,this}clone(){throw new Error("Use 'cloneDocument(source)' from '@gltf-transform/functions'.")}merge(e){throw new Error("Use 'mergeDocuments(target, source)' from '@gltf-transform/functions'.")}async transform(...e){const r=e.map(n=>n.name);for(const n of e)await n(this,{stack:r});return this}createExtension(e){const r=e.EXTENSION_NAME;return this.getRoot().listExtensionsUsed().find(s=>s.extensionName===r)||new e(this)}createScene(e=""){return new Ga(this._graph,e)}createNode(e=""){return new ka(this._graph,e)}createCamera(e=""){return new Yt(this._graph,e)}createSkin(e=""){return new Ha(this._graph,e)}createMesh(e=""){return new za(this._graph,e)}createPrimitive(){return new qt(this._graph)}createPrimitiveTarget(e=""){return new kg(this._graph,e)}createMaterial(e=""){return new $t(this._graph,e)}createTexture(e=""){return new qa(this._graph,e)}createAnimation(e=""){return new ja(this._graph,e)}createAnimationChannel(e=""){return new hs(this._graph,e)}createAnimationSampler(e=""){return new dr(this._graph,e)}createAccessor(e="",r=null){return r||(r=this.getRoot().listBuffers()[0]),new q(this._graph,e).setBuffer(r)}createBuffer(e=""){return new Va(this._graph,e)}}ur._GRAPH_DOCUMENTS=new WeakMap;class he{constructor(e){this.extensionName="",this.prereadTypes=[],this.prewriteTypes=[],this.readDependencies=[],this.writeDependencies=[],this.document=void 0,this.required=!1,this.properties=new Set,this._listener=void 0,this.document=e,e.getRoot()._enableExtension(this),this._listener=n=>{const s=n,i=s.target;i instanceof ge&&i.extensionName===this.extensionName&&(s.type==="node:create"&&this._addExtensionProperty(i),s.type==="node:dispose"&&this._removeExtensionProperty(i))};const r=e.getGraph();r.addEventListener("node:create",this._listener),r.addEventListener("node:dispose",this._listener)}dispose(){this.document.getRoot()._disableExtension(this);const e=this.document.getGraph();e.removeEventListener("node:create",this._listener),e.removeEventListener("node:dispose",this._listener);for(const r of this.properties)r.dispose()}static register(){}isRequired(){return this.required}setRequired(e){return this.required=e,this}listProperties(){return Array.from(this.properties)}_addExtensionProperty(e){return this.properties.add(e),this}_removeExtensionProperty(e){return this.properties.delete(e),this}install(e,r){return this}preread(e,r){return this}prewrite(e,r){return this}}he.EXTENSION_NAME=void 0;class Gg{constructor(e){this.jsonDoc=void 0,this.buffers=[],this.bufferViews=[],this.bufferViewBuffers=[],this.accessors=[],this.textures=[],this.textureInfos=new Map,this.materials=[],this.meshes=[],this.cameras=[],this.nodes=[],this.skins=[],this.animations=[],this.scenes=[],this.jsonDoc=e}setTextureInfo(e,r){this.textureInfos.set(e,r),r.texCoord!==void 0&&e.setTexCoord(r.texCoord),r.extras!==void 0&&e.setExtras(r.extras);const n=this.jsonDoc.json.textures[r.index];if(n.sampler===void 0)return;const s=this.jsonDoc.json.samplers[n.sampler];s.magFilter!==void 0&&e.setMagFilter(s.magFilter),s.minFilter!==void 0&&e.setMinFilter(s.minFilter),s.wrapS!==void 0&&e.setWrapS(s.wrapS),s.wrapT!==void 0&&e.setWrapT(s.wrapT)}}const Js={logger:We.DEFAULT_INSTANCE,extensions:[],dependencies:{}},Hg=new Set([$.BUFFER,$.TEXTURE,$.MATERIAL,$.MESH,$.PRIMITIVE,$.NODE,$.SCENE]);class qg{static read(e,r=Js){const n=$e({},Js,r),{json:s}=e,i=new ur().setLogger(n.logger);this.validate(e,n);const a=new Gg(e),o=s.asset,c=i.getRoot().getAsset();o.copyright&&(c.copyright=o.copyright),o.extras&&(c.extras=o.extras),s.extras!==void 0&&i.getRoot().setExtras($e({},s.extras));const f=s.extensionsUsed||[],h=s.extensionsRequired||[];n.extensions.sort((x,I)=>x.EXTENSION_NAME>I.EXTENSION_NAME?1:-1);for(const x of n.extensions)if(f.includes(x.EXTENSION_NAME)){const I=i.createExtension(x).setRequired(h.includes(x.EXTENSION_NAME)),b=I.prereadTypes.filter(N=>!Hg.has(N));b.length&&n.logger.warn(`Preread hooks for some types (${b.join()}), requested by extension ${I.extensionName}, are unsupported. Please file an issue or a PR.`);for(const N of I.readDependencies)I.install(N,n.dependencies[N])}const d=s.buffers||[];i.getRoot().listExtensionsUsed().filter(x=>x.prereadTypes.includes($.BUFFER)).forEach(x=>x.preread(a,$.BUFFER)),a.buffers=d.map(x=>{const I=i.createBuffer(x.name);return x.extras&&I.setExtras(x.extras),x.uri&&x.uri.indexOf("__")!==0&&I.setURI(x.uri),I});const p=s.bufferViews||[];a.bufferViewBuffers=p.map((x,I)=>{if(!a.bufferViews[I]){const b=e.json.buffers[x.buffer],N=b.uri?e.resources[b.uri]:e.resources[fr],B=x.byteOffset||0;a.bufferViews[I]=ee.toView(N,B,x.byteLength)}return a.buffers[x.buffer]});const g=s.accessors||[];a.accessors=g.map(x=>{const I=a.bufferViewBuffers[x.bufferView],b=i.createAccessor(x.name,I).setType(x.type);return x.extras&&b.setExtras(x.extras),x.normalized!==void 0&&b.setNormalized(x.normalized),x.bufferView===void 0||b.setArray(Qr(x,a)),b});const E=s.images||[],M=s.textures||[];i.getRoot().listExtensionsUsed().filter(x=>x.prereadTypes.includes($.TEXTURE)).forEach(x=>x.preread(a,$.TEXTURE)),a.textures=E.map(x=>{const I=i.createTexture(x.name);if(x.extras&&I.setExtras(x.extras),x.bufferView!==void 0){const b=s.bufferViews[x.bufferView],N=e.json.buffers[b.buffer],B=N.uri?e.resources[N.uri]:e.resources[fr],U=b.byteOffset||0,V=b.byteLength,z=B.slice(U,U+V);I.setImage(z)}else x.uri!==void 0&&(I.setImage(e.resources[x.uri]),x.uri.indexOf("__")!==0&&I.setURI(x.uri));if(x.mimeType!==void 0)I.setMimeType(x.mimeType);else if(x.uri){const b=lr.extension(x.uri);I.setMimeType(ft.extensionToMimeType(b))}return I}),i.getRoot().listExtensionsUsed().filter(x=>x.prereadTypes.includes($.MATERIAL)).forEach(x=>x.preread(a,$.MATERIAL));const T=s.materials||[];a.materials=T.map(x=>{const I=i.createMaterial(x.name);x.extras&&I.setExtras(x.extras),x.alphaMode!==void 0&&I.setAlphaMode(x.alphaMode),x.alphaCutoff!==void 0&&I.setAlphaCutoff(x.alphaCutoff),x.doubleSided!==void 0&&I.setDoubleSided(x.doubleSided);const b=x.pbrMetallicRoughness||{};if(b.baseColorFactor!==void 0&&I.setBaseColorFactor(b.baseColorFactor),x.emissiveFactor!==void 0&&I.setEmissiveFactor(x.emissiveFactor),b.metallicFactor!==void 0&&I.setMetallicFactor(b.metallicFactor),b.roughnessFactor!==void 0&&I.setRoughnessFactor(b.roughnessFactor),b.baseColorTexture!==void 0){const N=b.baseColorTexture,B=a.textures[M[N.index].source];I.setBaseColorTexture(B),a.setTextureInfo(I.getBaseColorTextureInfo(),N)}if(x.emissiveTexture!==void 0){const N=x.emissiveTexture,B=a.textures[M[N.index].source];I.setEmissiveTexture(B),a.setTextureInfo(I.getEmissiveTextureInfo(),N)}if(x.normalTexture!==void 0){const N=x.normalTexture,B=a.textures[M[N.index].source];I.setNormalTexture(B),a.setTextureInfo(I.getNormalTextureInfo(),N),x.normalTexture.scale!==void 0&&I.setNormalScale(x.normalTexture.scale)}if(x.occlusionTexture!==void 0){const N=x.occlusionTexture,B=a.textures[M[N.index].source];I.setOcclusionTexture(B),a.setTextureInfo(I.getOcclusionTextureInfo(),N),x.occlusionTexture.strength!==void 0&&I.setOcclusionStrength(x.occlusionTexture.strength)}if(b.metallicRoughnessTexture!==void 0){const N=b.metallicRoughnessTexture,B=a.textures[M[N.index].source];I.setMetallicRoughnessTexture(B),a.setTextureInfo(I.getMetallicRoughnessTextureInfo(),N)}return I}),i.getRoot().listExtensionsUsed().filter(x=>x.prereadTypes.includes($.MESH)).forEach(x=>x.preread(a,$.MESH));const v=s.meshes||[];i.getRoot().listExtensionsUsed().filter(x=>x.prereadTypes.includes($.PRIMITIVE)).forEach(x=>x.preread(a,$.PRIMITIVE)),a.meshes=v.map(x=>{const I=i.createMesh(x.name);return x.extras&&I.setExtras(x.extras),x.weights!==void 0&&I.setWeights(x.weights),(x.primitives||[]).forEach(N=>{const B=i.createPrimitive();N.extras&&B.setExtras(N.extras),N.material!==void 0&&B.setMaterial(a.materials[N.material]),N.mode!==void 0&&B.setMode(N.mode);for(const[z,X]of Object.entries(N.attributes||{}))B.setAttribute(z,a.accessors[X]);N.indices!==void 0&&B.setIndices(a.accessors[N.indices]);const U=x.extras&&x.extras.targetNames||[];(N.targets||[]).forEach((z,X)=>{const Y=U[X]||X.toString(),J=i.createPrimitiveTarget(Y);for(const[re,ae]of Object.entries(z))J.setAttribute(re,a.accessors[ae]);B.addTarget(J)}),I.addPrimitive(B)}),I});const D=s.cameras||[];a.cameras=D.map(x=>{const I=i.createCamera(x.name).setType(x.type);if(x.extras&&I.setExtras(x.extras),x.type===Yt.Type.PERSPECTIVE){const b=x.perspective;I.setYFov(b.yfov),I.setZNear(b.znear),b.zfar!==void 0&&I.setZFar(b.zfar),b.aspectRatio!==void 0&&I.setAspectRatio(b.aspectRatio)}else{const b=x.orthographic;I.setZNear(b.znear).setZFar(b.zfar).setXMag(b.xmag).setYMag(b.ymag)}return I});const R=s.nodes||[];i.getRoot().listExtensionsUsed().filter(x=>x.prereadTypes.includes($.NODE)).forEach(x=>x.preread(a,$.NODE)),a.nodes=R.map(x=>{const I=i.createNode(x.name);if(x.extras&&I.setExtras(x.extras),x.translation!==void 0&&I.setTranslation(x.translation),x.rotation!==void 0&&I.setRotation(x.rotation),x.scale!==void 0&&I.setScale(x.scale),x.matrix!==void 0){const b=[0,0,0],N=[0,0,0,1],B=[1,1,1];ce.decompose(x.matrix,b,N,B),I.setTranslation(b),I.setRotation(N),I.setScale(B)}return x.weights!==void 0&&I.setWeights(x.weights),I});const w=s.skins||[];a.skins=w.map(x=>{const I=i.createSkin(x.name);x.extras&&I.setExtras(x.extras),x.inverseBindMatrices!==void 0&&I.setInverseBindMatrices(a.accessors[x.inverseBindMatrices]),x.skeleton!==void 0&&I.setSkeleton(a.nodes[x.skeleton]);for(const b of x.joints)I.addJoint(a.nodes[b]);return I}),R.map((x,I)=>{const b=a.nodes[I];(x.children||[]).forEach(B=>b.addChild(a.nodes[B])),x.mesh!==void 0&&b.setMesh(a.meshes[x.mesh]),x.camera!==void 0&&b.setCamera(a.cameras[x.camera]),x.skin!==void 0&&b.setSkin(a.skins[x.skin])});const A=s.animations||[];a.animations=A.map(x=>{const I=i.createAnimation(x.name);x.extras&&I.setExtras(x.extras);const N=(x.samplers||[]).map(U=>{const V=i.createAnimationSampler().setInput(a.accessors[U.input]).setOutput(a.accessors[U.output]).setInterpolation(U.interpolation||dr.Interpolation.LINEAR);return U.extras&&V.setExtras(U.extras),I.addSampler(V),V});return(x.channels||[]).forEach(U=>{const V=i.createAnimationChannel().setSampler(N[U.sampler]).setTargetPath(U.target.path);U.target.node!==void 0&&V.setTargetNode(a.nodes[U.target.node]),U.extras&&V.setExtras(U.extras),I.addChannel(V)}),I});const S=s.scenes||[];return i.getRoot().listExtensionsUsed().filter(x=>x.prereadTypes.includes($.SCENE)).forEach(x=>x.preread(a,$.SCENE)),a.scenes=S.map(x=>{const I=i.createScene(x.name);return x.extras&&I.setExtras(x.extras),(x.nodes||[]).map(N=>a.nodes[N]).forEach(N=>I.addChild(N)),I}),s.scene!==void 0&&i.getRoot().setDefaultScene(a.scenes[s.scene]),i.getRoot().listExtensionsUsed().forEach(x=>x.read(a)),g.forEach((x,I)=>{const b=a.accessors[I],N=!!x.sparse,B=!x.bufferView&&!b.getArray();(N||B)&&b.setSparse(!0).setArray(Xg(x,a))}),i}static validate(e,r){const n=e.json;if(n.asset.version!=="2.0")throw new Error(`Unsupported glTF version, "${n.asset.version}".`);if(n.extensionsRequired){for(const s of n.extensionsRequired)if(!r.extensions.find(i=>i.EXTENSION_NAME===s))throw new Error(`Missing required extension, "${s}".`)}if(n.extensionsUsed)for(const s of n.extensionsUsed)r.extensions.find(i=>i.EXTENSION_NAME===s)||r.logger.warn(`Missing optional extension, "${s}".`)}}function Wg(t,e){const r=e.jsonDoc,n=e.bufferViews[t.bufferView],s=r.json.bufferViews[t.bufferView],i=dn[t.componentType],a=q.getElementSize(t.type),o=i.BYTES_PER_ELEMENT,c=t.byteOffset||0,f=new i(t.count*a),h=new DataView(n.buffer,n.byteOffset,n.byteLength),d=s.byteStride;for(let p=0;p<t.count;p++)for(let g=0;g<a;g++){const E=c+p*d+g*o;let M;switch(t.componentType){case q.ComponentType.FLOAT:M=h.getFloat32(E,!0);break;case q.ComponentType.UNSIGNED_INT:M=h.getUint32(E,!0);break;case q.ComponentType.UNSIGNED_SHORT:M=h.getUint16(E,!0);break;case q.ComponentType.UNSIGNED_BYTE:M=h.getUint8(E);break;case q.ComponentType.SHORT:M=h.getInt16(E,!0);break;case q.ComponentType.BYTE:M=h.getInt8(E);break;default:throw new Error(`Unexpected componentType "${t.componentType}".`)}f[p*a+g]=M}return f}function Qr(t,e){const r=e.jsonDoc,n=e.bufferViews[t.bufferView],s=r.json.bufferViews[t.bufferView],i=dn[t.componentType],a=q.getElementSize(t.type),o=i.BYTES_PER_ELEMENT,c=a*o;if(s.byteStride!==void 0&&s.byteStride!==c)return Wg(t,e);const f=n.byteOffset+(t.byteOffset||0),h=t.count*a*o;return new i(n.buffer.slice(f,f+h))}function Xg(t,e){const r=dn[t.componentType],n=q.getElementSize(t.type);let s;t.bufferView!==void 0?s=Qr(t,e):s=new r(t.count*n);const i=t.sparse;if(!i)return s;const a=i.count,o=$e({},t,i.indices,{count:a,type:"SCALAR"}),c=$e({},t,i.values,{count:a}),f=Qr(o,e),h=Qr(c,e);for(let d=0;d<o.count;d++)for(let p=0;p<n;p++)s[f[d]*n+p]=h[d*n+p];return s}var Dr;(function(t){t[t.ARRAY_BUFFER=34962]="ARRAY_BUFFER",t[t.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER"})(Dr||(Dr={}));class nt{constructor(e,r,n){this._doc=void 0,this.jsonDoc=void 0,this.options=void 0,this.accessorIndexMap=new Map,this.animationIndexMap=new Map,this.bufferIndexMap=new Map,this.cameraIndexMap=new Map,this.skinIndexMap=new Map,this.materialIndexMap=new Map,this.meshIndexMap=new Map,this.nodeIndexMap=new Map,this.imageIndexMap=new Map,this.textureDefIndexMap=new Map,this.textureInfoDefMap=new Map,this.samplerDefIndexMap=new Map,this.sceneIndexMap=new Map,this.imageBufferViews=[],this.otherBufferViews=new Map,this.otherBufferViewsIndexMap=new Map,this.extensionData={},this.bufferURIGenerator=void 0,this.imageURIGenerator=void 0,this.logger=void 0,this._accessorUsageMap=new Map,this.accessorUsageGroupedByParent=new Set(["ARRAY_BUFFER"]),this.accessorParents=new Map,this._doc=e,this.jsonDoc=r,this.options=n;const s=e.getRoot(),i=s.listBuffers().length,a=s.listTextures().length;this.bufferURIGenerator=new Zs(i>1,()=>n.basename||"buffer"),this.imageURIGenerator=new Zs(a>1,o=>Kg(e,o)||n.basename||"texture"),this.logger=e.getLogger()}createTextureInfoDef(e,r){const n={magFilter:r.getMagFilter()||void 0,minFilter:r.getMinFilter()||void 0,wrapS:r.getWrapS(),wrapT:r.getWrapT()},s=JSON.stringify(n);this.samplerDefIndexMap.has(s)||(this.samplerDefIndexMap.set(s,this.jsonDoc.json.samplers.length),this.jsonDoc.json.samplers.push(n));const i={source:this.imageIndexMap.get(e),sampler:this.samplerDefIndexMap.get(s)},a=JSON.stringify(i);this.textureDefIndexMap.has(a)||(this.textureDefIndexMap.set(a,this.jsonDoc.json.textures.length),this.jsonDoc.json.textures.push(i));const o={index:this.textureDefIndexMap.get(a)};return r.getTexCoord()!==0&&(o.texCoord=r.getTexCoord()),Object.keys(r.getExtras()).length>0&&(o.extras=r.getExtras()),this.textureInfoDefMap.set(r,o),o}createPropertyDef(e){const r={};return e.getName()&&(r.name=e.getName()),Object.keys(e.getExtras()).length>0&&(r.extras=e.getExtras()),r}createAccessorDef(e){const r=this.createPropertyDef(e);return r.type=e.getType(),r.componentType=e.getComponentType(),r.count=e.getCount(),this._doc.getGraph().listParentEdges(e).some(s=>s.getName()==="attributes"&&s.getAttributes().key==="POSITION"||s.getName()==="input")&&(r.max=e.getMax([]).map(Math.fround),r.min=e.getMin([]).map(Math.fround)),e.getNormalized()&&(r.normalized=e.getNormalized()),r}createImageData(e,r,n){if(this.options.format===Dt.GLB)this.imageBufferViews.push(r),e.bufferView=this.jsonDoc.json.bufferViews.length,this.jsonDoc.json.bufferViews.push({buffer:0,byteOffset:-1,byteLength:r.byteLength});else{const s=ft.mimeTypeToExtension(n.getMimeType());e.uri=this.imageURIGenerator.createURI(n,s),this.assignResourceURI(e.uri,r,!1)}}assignResourceURI(e,r,n){const s=this.jsonDoc.resources;if(!(e in s)){s[e]=r;return}if(r===s[e]){this.logger.warn(`Duplicate resource URI, "${e}".`);return}const i=`Resource URI "${e}" already assigned to different data.`;if(!n){this.logger.warn(i);return}throw new Error(i)}getAccessorUsage(e){const r=this._accessorUsageMap.get(e);if(r)return r;if(e.getSparse())return Ve.SPARSE;for(const n of this._doc.getGraph().listParentEdges(e)){const{usage:s}=n.getAttributes();if(s)return s;n.getParent().propertyType!==$.ROOT&&this.logger.warn(`Missing attribute ".usage" on edge, "${n.getName()}".`)}return Ve.OTHER}addAccessorToUsageGroup(e,r){const n=this._accessorUsageMap.get(e);if(n&&n!==r)throw new Error(`Accessor with usage "${n}" cannot be reused as "${r}".`);return this._accessorUsageMap.set(e,r),this}}nt.BufferViewTarget=Dr;nt.BufferViewUsage=Ve;nt.USAGE_TO_TARGET={[Ve.ARRAY_BUFFER]:Dr.ARRAY_BUFFER,[Ve.ELEMENT_ARRAY_BUFFER]:Dr.ELEMENT_ARRAY_BUFFER};class Zs{constructor(e,r){this.multiple=void 0,this.basename=void 0,this.counter={},this.multiple=e,this.basename=r}createURI(e,r){if(e.getURI())return e.getURI();if(this.multiple){const n=this.basename(e);return this.counter[n]=this.counter[n]||1,`${n}_${this.counter[n]++}.${r}`}else return`${this.basename(e)}.${r}`}}function Kg(t,e){const r=t.getGraph().listParentEdges(e).find(n=>n.getParent()!==t.getRoot());return r?r.getName().replace(/texture$/i,""):""}const{BufferViewUsage:Yr}=nt,{UNSIGNED_INT:Yg,UNSIGNED_SHORT:Jg,UNSIGNED_BYTE:Zg}=q.ComponentType,Qg=new Set([$.ACCESSOR,$.BUFFER,$.MATERIAL,$.MESH]);class e0{static write(e,r){const n=e.getGraph(),s=e.getRoot(),i={asset:$e({generator:`glTF-Transform ${Pa}`},s.getAsset()),extras:$e({},s.getExtras())},a={json:i,resources:{}},o=new nt(e,a,r),c=r.logger||We.DEFAULT_INSTANCE,f=new Set(r.extensions.map(v=>v.EXTENSION_NAME)),h=e.getRoot().listExtensionsUsed().filter(v=>f.has(v.extensionName)).sort((v,D)=>v.extensionName>D.extensionName?1:-1),d=e.getRoot().listExtensionsRequired().filter(v=>f.has(v.extensionName)).sort((v,D)=>v.extensionName>D.extensionName?1:-1);h.length<e.getRoot().listExtensionsUsed().length&&c.warn("Some extensions were not registered for I/O, and will not be written.");for(const v of h){const D=v.prewriteTypes.filter(R=>!Qg.has(R));D.length&&c.warn(`Prewrite hooks for some types (${D.join()}), requested by extension ${v.extensionName}, are unsupported. Please file an issue or a PR.`);for(const R of v.writeDependencies)v.install(R,r.dependencies[R])}function p(v,D,R,w){const A=[];let S=0;for(const b of v){const N=o.createAccessorDef(b);N.bufferView=i.bufferViews.length;const B=b.getArray(),U=ee.pad(ee.toView(B));N.byteOffset=S,S+=U.byteLength,A.push(U),o.accessorIndexMap.set(b,i.accessors.length),i.accessors.push(N)}const x=ee.concat(A),I={buffer:D,byteOffset:R,byteLength:x.byteLength};return w&&(I.target=w),i.bufferViews.push(I),{buffers:A,byteLength:S}}function g(v,D,R){const w=v[0].getCount();let A=0;for(const N of v){const B=o.createAccessorDef(N);B.bufferView=i.bufferViews.length,B.byteOffset=A;const U=N.getElementSize(),V=N.getComponentSize();A+=ee.padNumber(U*V),o.accessorIndexMap.set(N,i.accessors.length),i.accessors.push(B)}const S=w*A,x=new ArrayBuffer(S),I=new DataView(x);for(let N=0;N<w;N++){let B=0;for(const U of v){const V=U.getElementSize(),z=U.getComponentSize(),X=U.getComponentType(),Y=U.getArray();for(let J=0;J<V;J++){const re=N*A+B+J*z,ae=Y[N*V+J];switch(X){case q.ComponentType.FLOAT:I.setFloat32(re,ae,!0);break;case q.ComponentType.BYTE:I.setInt8(re,ae);break;case q.ComponentType.SHORT:I.setInt16(re,ae,!0);break;case q.ComponentType.UNSIGNED_BYTE:I.setUint8(re,ae);break;case q.ComponentType.UNSIGNED_SHORT:I.setUint16(re,ae,!0);break;case q.ComponentType.UNSIGNED_INT:I.setUint32(re,ae,!0);break;default:throw new Error("Unexpected component type: "+X)}}B+=ee.padNumber(V*z)}}const b={buffer:D,byteOffset:R,byteLength:S,byteStride:A,target:nt.BufferViewTarget.ARRAY_BUFFER};return i.bufferViews.push(b),{byteLength:S,buffers:[new Uint8Array(x)]}}function E(v,D,R){const w=[];let A=0;const S=new Map;let x=-1/0,I=!1;for(const X of v){const Y=o.createAccessorDef(X);i.accessors.push(Y),o.accessorIndexMap.set(X,i.accessors.length-1);const J=[],re=[],ae=[],lt=new Array(X.getElementSize()).fill(0);for(let xe=0,oe=X.getCount();xe<oe;xe++)if(X.getElement(xe,ae),!ce.eq(ae,lt,0)){x=Math.max(xe,x),J.push(xe);for(let we=0;we<ae.length;we++)re.push(ae[we])}const Me=J.length,Ue={accessorDef:Y,count:Me};if(S.set(X,Ue),Me===0)continue;Me>X.getCount()/2&&(I=!0);const Le=dn[X.getComponentType()];Ue.indices=J,Ue.values=new Le(re)}if(!Number.isFinite(x))return{buffers:w,byteLength:A};I&&c.warn("Some sparse accessors have >50% non-zero elements, which may increase file size.");const b=x<255?Uint8Array:x<65535?Uint16Array:Uint32Array,N=x<255?Zg:x<65535?Jg:Yg,B={buffer:D,byteOffset:R+A,byteLength:0};for(const X of v){const Y=S.get(X);if(Y.count===0)continue;Y.indicesByteOffset=B.byteLength;const J=ee.pad(ee.toView(new b(Y.indices)));w.push(J),A+=J.byteLength,B.byteLength+=J.byteLength}i.bufferViews.push(B);const U=i.bufferViews.length-1,V={buffer:D,byteOffset:R+A,byteLength:0};for(const X of v){const Y=S.get(X);if(Y.count===0)continue;Y.valuesByteOffset=V.byteLength;const J=ee.pad(ee.toView(Y.values));w.push(J),A+=J.byteLength,V.byteLength+=J.byteLength}i.bufferViews.push(V);const z=i.bufferViews.length-1;for(const X of v){const Y=S.get(X);Y.count!==0&&(Y.accessorDef.sparse={count:Y.count,indices:{bufferView:U,byteOffset:Y.indicesByteOffset,componentType:N},values:{bufferView:z,byteOffset:Y.valuesByteOffset}})}return{buffers:w,byteLength:A}}if(i.accessors=[],i.bufferViews=[],i.samplers=[],i.textures=[],i.images=s.listTextures().map((v,D)=>{const R=o.createPropertyDef(v);v.getMimeType()&&(R.mimeType=v.getMimeType());const w=v.getImage();return w&&o.createImageData(R,w,v),o.imageIndexMap.set(v,D),R}),h.filter(v=>v.prewriteTypes.includes($.ACCESSOR)).forEach(v=>v.prewrite(o,$.ACCESSOR)),s.listAccessors().forEach(v=>{const D=o.accessorUsageGroupedByParent,R=o.accessorParents;if(o.accessorIndexMap.has(v))return;const w=o.getAccessorUsage(v);if(o.addAccessorToUsageGroup(v,w),D.has(w)){const A=n.listParents(v).find(S=>S.propertyType!==$.ROOT);R.set(v,A)}}),h.filter(v=>v.prewriteTypes.includes($.BUFFER)).forEach(v=>v.prewrite(o,$.BUFFER)),(s.listAccessors().length>0||o.otherBufferViews.size>0||s.listTextures().length>0&&r.format===Dt.GLB)&&s.listBuffers().length===0)throw new Error("Buffer required for Document resources, but none was found.");i.buffers=[],s.listBuffers().forEach((v,D)=>{const R=o.createPropertyDef(v),w=o.accessorUsageGroupedByParent,A=v.listParents().filter(V=>V instanceof q),S=new Set(A.map(V=>o.accessorParents.get(V))),x=new Map(Array.from(S).map((V,z)=>[V,z])),I={};for(const V of A){var b;if(o.accessorIndexMap.has(V))continue;const z=o.getAccessorUsage(V);let X=z;if(w.has(z)){const Y=o.accessorParents.get(V);X+=`:${x.get(Y)}`}I[b=X]||(I[b]={usage:z,accessors:[]}),I[X].accessors.push(V)}const N=[],B=i.buffers.length;let U=0;for(const{usage:V,accessors:z}of Object.values(I))if(V===Yr.ARRAY_BUFFER&&r.vertexLayout===nn.INTERLEAVED){const X=g(z,B,U);U+=X.byteLength;for(const Y of X.buffers)N.push(Y)}else if(V===Yr.ARRAY_BUFFER)for(const X of z){const Y=g([X],B,U);U+=Y.byteLength;for(const J of Y.buffers)N.push(J)}else if(V===Yr.SPARSE){const X=E(z,B,U);U+=X.byteLength;for(const Y of X.buffers)N.push(Y)}else if(V===Yr.ELEMENT_ARRAY_BUFFER){const X=nt.BufferViewTarget.ELEMENT_ARRAY_BUFFER,Y=p(z,B,U,X);U+=Y.byteLength;for(const J of Y.buffers)N.push(J)}else{const X=p(z,B,U);U+=X.byteLength;for(const Y of X.buffers)N.push(Y)}if(o.imageBufferViews.length&&D===0){for(let V=0;V<o.imageBufferViews.length;V++)if(i.bufferViews[i.images[V].bufferView].byteOffset=U,U+=o.imageBufferViews[V].byteLength,N.push(o.imageBufferViews[V]),U%8){const z=8-U%8;U+=z,N.push(new Uint8Array(z))}}if(o.otherBufferViews.has(v))for(const V of o.otherBufferViews.get(v))i.bufferViews.push({buffer:B,byteOffset:U,byteLength:V.byteLength}),o.otherBufferViewsIndexMap.set(V,i.bufferViews.length-1),U+=V.byteLength,N.push(V);if(U){let V;r.format===Dt.GLB?V=fr:(V=o.bufferURIGenerator.createURI(v,"bin"),R.uri=V),R.byteLength=U,o.assignResourceURI(V,ee.concat(N),!0)}i.buffers.push(R),o.bufferIndexMap.set(v,D)}),s.listAccessors().find(v=>!v.getBuffer())&&c.warn("Skipped writing one or more Accessors: no Buffer assigned."),h.filter(v=>v.prewriteTypes.includes($.MATERIAL)).forEach(v=>v.prewrite(o,$.MATERIAL)),i.materials=s.listMaterials().map((v,D)=>{const R=o.createPropertyDef(v);if(v.getAlphaMode()!==$t.AlphaMode.OPAQUE&&(R.alphaMode=v.getAlphaMode()),v.getAlphaMode()===$t.AlphaMode.MASK&&(R.alphaCutoff=v.getAlphaCutoff()),v.getDoubleSided()&&(R.doubleSided=!0),R.pbrMetallicRoughness={},ce.eq(v.getBaseColorFactor(),[1,1,1,1])||(R.pbrMetallicRoughness.baseColorFactor=v.getBaseColorFactor()),ce.eq(v.getEmissiveFactor(),[0,0,0])||(R.emissiveFactor=v.getEmissiveFactor()),v.getRoughnessFactor()!==1&&(R.pbrMetallicRoughness.roughnessFactor=v.getRoughnessFactor()),v.getMetallicFactor()!==1&&(R.pbrMetallicRoughness.metallicFactor=v.getMetallicFactor()),v.getBaseColorTexture()){const w=v.getBaseColorTexture(),A=v.getBaseColorTextureInfo();R.pbrMetallicRoughness.baseColorTexture=o.createTextureInfoDef(w,A)}if(v.getEmissiveTexture()){const w=v.getEmissiveTexture(),A=v.getEmissiveTextureInfo();R.emissiveTexture=o.createTextureInfoDef(w,A)}if(v.getNormalTexture()){const w=v.getNormalTexture(),A=v.getNormalTextureInfo(),S=o.createTextureInfoDef(w,A);v.getNormalScale()!==1&&(S.scale=v.getNormalScale()),R.normalTexture=S}if(v.getOcclusionTexture()){const w=v.getOcclusionTexture(),A=v.getOcclusionTextureInfo(),S=o.createTextureInfoDef(w,A);v.getOcclusionStrength()!==1&&(S.strength=v.getOcclusionStrength()),R.occlusionTexture=S}if(v.getMetallicRoughnessTexture()){const w=v.getMetallicRoughnessTexture(),A=v.getMetallicRoughnessTextureInfo();R.pbrMetallicRoughness.metallicRoughnessTexture=o.createTextureInfoDef(w,A)}return o.materialIndexMap.set(v,D),R}),h.filter(v=>v.prewriteTypes.includes($.MESH)).forEach(v=>v.prewrite(o,$.MESH)),i.meshes=s.listMeshes().map((v,D)=>{const R=o.createPropertyDef(v);let w=null;return R.primitives=v.listPrimitives().map(A=>{const S={attributes:{}};S.mode=A.getMode();const x=A.getMaterial();x&&(S.material=o.materialIndexMap.get(x)),Object.keys(A.getExtras()).length&&(S.extras=A.getExtras());const I=A.getIndices();I&&(S.indices=o.accessorIndexMap.get(I));for(const b of A.listSemantics())S.attributes[b]=o.accessorIndexMap.get(A.getAttribute(b));for(const b of A.listTargets()){const N={};for(const B of b.listSemantics())N[B]=o.accessorIndexMap.get(b.getAttribute(B));S.targets=S.targets||[],S.targets.push(N)}return A.listTargets().length&&!w&&(w=A.listTargets().map(b=>b.getName())),S}),v.getWeights().length&&(R.weights=v.getWeights()),w&&(R.extras=R.extras||{},R.extras.targetNames=w),o.meshIndexMap.set(v,D),R}),i.cameras=s.listCameras().map((v,D)=>{const R=o.createPropertyDef(v);if(R.type=v.getType(),R.type===Yt.Type.PERSPECTIVE){R.perspective={znear:v.getZNear(),zfar:v.getZFar(),yfov:v.getYFov()};const w=v.getAspectRatio();w!==null&&(R.perspective.aspectRatio=w)}else R.orthographic={znear:v.getZNear(),zfar:v.getZFar(),xmag:v.getXMag(),ymag:v.getYMag()};return o.cameraIndexMap.set(v,D),R}),i.nodes=s.listNodes().map((v,D)=>{const R=o.createPropertyDef(v);return ce.eq(v.getTranslation(),[0,0,0])||(R.translation=v.getTranslation()),ce.eq(v.getRotation(),[0,0,0,1])||(R.rotation=v.getRotation()),ce.eq(v.getScale(),[1,1,1])||(R.scale=v.getScale()),v.getWeights().length&&(R.weights=v.getWeights()),o.nodeIndexMap.set(v,D),R}),i.skins=s.listSkins().map((v,D)=>{const R=o.createPropertyDef(v),w=v.getInverseBindMatrices();w&&(R.inverseBindMatrices=o.accessorIndexMap.get(w));const A=v.getSkeleton();return A&&(R.skeleton=o.nodeIndexMap.get(A)),R.joints=v.listJoints().map(S=>o.nodeIndexMap.get(S)),o.skinIndexMap.set(v,D),R}),s.listNodes().forEach((v,D)=>{const R=i.nodes[D],w=v.getMesh();w&&(R.mesh=o.meshIndexMap.get(w));const A=v.getCamera();A&&(R.camera=o.cameraIndexMap.get(A));const S=v.getSkin();S&&(R.skin=o.skinIndexMap.get(S)),v.listChildren().length>0&&(R.children=v.listChildren().map(x=>o.nodeIndexMap.get(x)))}),i.animations=s.listAnimations().map((v,D)=>{const R=o.createPropertyDef(v),w=new Map;return R.samplers=v.listSamplers().map((A,S)=>{const x=o.createPropertyDef(A);return x.input=o.accessorIndexMap.get(A.getInput()),x.output=o.accessorIndexMap.get(A.getOutput()),x.interpolation=A.getInterpolation(),w.set(A,S),x}),R.channels=v.listChannels().map(A=>{const S=o.createPropertyDef(A);return S.sampler=w.get(A.getSampler()),S.target={node:o.nodeIndexMap.get(A.getTargetNode()),path:A.getTargetPath()},S}),o.animationIndexMap.set(v,D),R}),i.scenes=s.listScenes().map((v,D)=>{const R=o.createPropertyDef(v);return R.nodes=v.listChildren().map(w=>o.nodeIndexMap.get(w)),o.sceneIndexMap.set(v,D),R});const T=s.getDefaultScene();return T&&(i.scene=s.listScenes().indexOf(T)),i.extensionsUsed=h.map(v=>v.extensionName),i.extensionsRequired=d.map(v=>v.extensionName),h.forEach(v=>v.write(o)),t0(i),a}}function t0(t){const e=[];for(const r in t){const n=t[r];(Array.isArray(n)&&n.length===0||n===null||n===""||n&&typeof n=="object"&&Object.keys(n).length===0)&&e.push(r)}for(const r of e)delete t[r]}var an;(function(t){t[t.JSON=1313821514]="JSON",t[t.BIN=5130562]="BIN"})(an||(an={}));class r0{constructor(){this._logger=We.DEFAULT_INSTANCE,this._extensions=new Set,this._dependencies={},this._vertexLayout=nn.INTERLEAVED,this.lastReadBytes=0,this.lastWriteBytes=0}setLogger(e){return this._logger=e,this}registerExtensions(e){for(const r of e)this._extensions.add(r),r.register();return this}registerDependencies(e){return Object.assign(this._dependencies,e),this}setVertexLayout(e){return this._vertexLayout=e,this}async read(e){return await this.readJSON(await this.readAsJSON(e))}async readAsJSON(e){const r=await this.readURI(e,"view");this.lastReadBytes=r.byteLength;const n=Qs(r)?this._binaryToJSON(r):{json:JSON.parse(ee.decodeText(r)),resources:{}};return await this._readResourcesExternal(n,this.dirname(e)),this._readResourcesInternal(n),n}async readJSON(e){return e=this._copyJSON(e),this._readResourcesInternal(e),qg.read(e,{extensions:Array.from(this._extensions),dependencies:this._dependencies,logger:this._logger})}async binaryToJSON(e){const r=this._binaryToJSON(ee.assertView(e));this._readResourcesInternal(r);const n=r.json;if(n.buffers&&n.buffers.some(s=>n0(r,s)))throw new Error("Cannot resolve external buffers with binaryToJSON().");if(n.images&&n.images.some(s=>s0(r,s)))throw new Error("Cannot resolve external images with binaryToJSON().");return r}async readBinary(e){return this.readJSON(await this.binaryToJSON(ee.assertView(e)))}async writeJSON(e,r={}){if(r.format===Dt.GLB&&e.getRoot().listBuffers().length>1)throw new Error("GLB must have 01 buffers.");return e0.write(e,{format:r.format||Dt.GLTF,basename:r.basename||"",logger:this._logger,vertexLayout:this._vertexLayout,dependencies:$e({},this._dependencies),extensions:Array.from(this._extensions)})}async writeBinary(e){const{json:r,resources:n}=await this.writeJSON(e,{format:Dt.GLB}),s=new Uint32Array([1179937895,2,12]),i=JSON.stringify(r),a=ee.pad(ee.encodeText(i),32),o=ee.toView(new Uint32Array([a.byteLength,1313821514])),c=ee.concat([o,a]);s[s.length-1]+=c.byteLength;const f=Object.values(n)[0];if(!f||!f.byteLength)return ee.concat([ee.toView(s),c]);const h=ee.pad(f,0),d=ee.toView(new Uint32Array([h.byteLength,5130562])),p=ee.concat([d,h]);return s[s.length-1]+=p.byteLength,ee.concat([ee.toView(s),c,p])}async _readResourcesExternal(e,r){var n=this;const s=e.json.images||[],i=e.json.buffers||[],a=[...s,...i].map(async function(o){const c=o.uri;if(!c||c.match(/data:/))return Promise.resolve();e.resources[c]=await n.readURI(n.resolve(r,c),"view"),n.lastReadBytes+=e.resources[c].byteLength});await Promise.all(a)}_readResourcesInternal(e){function r(i){if(i.uri){if(i.uri in e.resources){ee.assertView(e.resources[i.uri]);return}if(i.uri.match(/data:/)){const a=`__${Bg()}.${lr.extension(i.uri)}`;e.resources[a]=ee.createBufferFromDataURI(i.uri),i.uri=a}}}(e.json.images||[]).forEach(i=>{if(i.bufferView===void 0&&i.uri===void 0)throw new Error("Missing resource URI or buffer view.");r(i)}),(e.json.buffers||[]).forEach(r)}_copyJSON(e){const{images:r,buffers:n}=e.json;return e={json:$e({},e.json),resources:$e({},e.resources)},r&&(e.json.images=r.map(s=>$e({},s))),n&&(e.json.buffers=n.map(s=>$e({},s))),e}_binaryToJSON(e){if(!Qs(e))throw new Error("Invalid glTF 2.0 binary.");const r=new Uint32Array(e.buffer,e.byteOffset+12,2);if(r[1]!==an.JSON)throw new Error("Missing required GLB JSON chunk.");const n=20,s=r[0],i=ee.decodeText(ee.toView(e,n,s)),a=JSON.parse(i),o=n+s;if(e.byteLength<=o)return{json:a,resources:{}};const c=new Uint32Array(e.buffer,e.byteOffset+o,2);if(c[1]!==an.BIN)return{json:a,resources:{}};const f=c[0],h=ee.toView(e,o+8,f);return{json:a,resources:{[fr]:h}}}}function n0(t,e){return e.uri!==void 0&&!(e.uri in t.resources)}function s0(t,e){return e.uri!==void 0&&!(e.uri in t.resources)&&e.bufferView===void 0}function Qs(t){if(t.byteLength<3*Uint32Array.BYTES_PER_ELEMENT)return!1;const e=new Uint32Array(t.buffer,t.byteOffset,3);return e[0]===1179937895&&e[1]===2}class i0 extends r0{constructor(e=Sr.DEFAULT_INIT){super(),this._fetchConfig=void 0,this._fetchConfig=e}async readURI(e,r){const n=await fetch(e,this._fetchConfig);switch(r){case"view":return new Uint8Array(await n.arrayBuffer());case"text":return n.text()}}resolve(e,r){return Sr.resolve(e,r)}dirname(e){return Sr.dirname(e)}}const a0=0,o0=0,c0=0,f0=2,l0=0,u0=163,h0=166,d0=0,p0=2,g0=1,m0=64,v0=0;function x0(){return{vkFormat:v0,typeSize:1,pixelWidth:0,pixelHeight:0,pixelDepth:0,layerCount:0,faceCount:1,levelCount:0,supercompressionScheme:a0,levels:[],dataFormatDescriptor:[{vendorId:c0,descriptorType:o0,versionNumber:f0,colorModel:l0,colorPrimaries:g0,transferFunction:p0,flags:d0,texelBlockDimension:[0,0,0,0],bytesPlane:[0,0,0,0,0,0,0,0],samples:[]}],keyValue:{},globalData:null}}class Er{constructor(e,r,n,s){this._dataView=void 0,this._littleEndian=void 0,this._offset=void 0,this._dataView=new DataView(e.buffer,e.byteOffset+r,n),this._littleEndian=s,this._offset=0}_nextUint8(){const e=this._dataView.getUint8(this._offset);return this._offset+=1,e}_nextUint16(){const e=this._dataView.getUint16(this._offset,this._littleEndian);return this._offset+=2,e}_nextUint32(){const e=this._dataView.getUint32(this._offset,this._littleEndian);return this._offset+=4,e}_nextUint64(){const e=this._dataView.getUint32(this._offset,this._littleEndian),r=this._dataView.getUint32(this._offset+4,this._littleEndian),n=e+2**32*r;return this._offset+=8,n}_nextInt32(){const e=this._dataView.getInt32(this._offset,this._littleEndian);return this._offset+=4,e}_nextUint8Array(e){const r=new Uint8Array(this._dataView.buffer,this._dataView.byteOffset+this._offset,e);return this._offset+=e,r}_skip(e){return this._offset+=e,this}_scan(e,r=0){const n=this._offset;let s=0;for(;this._dataView.getUint8(this._offset)!==r&&s<e;)s++,this._offset++;return s<e&&this._offset++,new Uint8Array(this._dataView.buffer,this._dataView.byteOffset+n,s)}}const Fe=[171,75,84,88,32,50,48,187,13,10,26,10];function ei(t){return new TextDecoder().decode(t)}function Dn(t){const e=new Uint8Array(t.buffer,t.byteOffset,Fe.length);if(e[0]!==Fe[0]||e[1]!==Fe[1]||e[2]!==Fe[2]||e[3]!==Fe[3]||e[4]!==Fe[4]||e[5]!==Fe[5]||e[6]!==Fe[6]||e[7]!==Fe[7]||e[8]!==Fe[8]||e[9]!==Fe[9]||e[10]!==Fe[10]||e[11]!==Fe[11])throw new Error("Missing KTX 2.0 identifier.");const r=x0(),n=17*Uint32Array.BYTES_PER_ELEMENT,s=new Er(t,Fe.length,n,!0);r.vkFormat=s._nextUint32(),r.typeSize=s._nextUint32(),r.pixelWidth=s._nextUint32(),r.pixelHeight=s._nextUint32(),r.pixelDepth=s._nextUint32(),r.layerCount=s._nextUint32(),r.faceCount=s._nextUint32(),r.levelCount=s._nextUint32(),r.supercompressionScheme=s._nextUint32();const i=s._nextUint32(),a=s._nextUint32(),o=s._nextUint32(),c=s._nextUint32(),f=s._nextUint64(),h=s._nextUint64(),d=Math.max(r.levelCount,1)*3*8,p=new Er(t,Fe.length+n,d,!0);for(let Re=0,Ie=Math.max(r.levelCount,1);Re<Ie;Re++)r.levels.push({levelData:new Uint8Array(t.buffer,t.byteOffset+p._nextUint64(),p._nextUint64()),uncompressedByteLength:p._nextUint64()});const g=new Er(t,i,a,!0);g._skip(4);const E=g._nextUint16(),M=g._nextUint16(),T=g._nextUint16(),v=g._nextUint16(),D=g._nextUint8(),R=g._nextUint8(),w=g._nextUint8(),A=g._nextUint8(),S=[g._nextUint8(),g._nextUint8(),g._nextUint8(),g._nextUint8()],x=[g._nextUint8(),g._nextUint8(),g._nextUint8(),g._nextUint8(),g._nextUint8(),g._nextUint8(),g._nextUint8(),g._nextUint8()],b={vendorId:E,descriptorType:M,versionNumber:T,colorModel:D,colorPrimaries:R,transferFunction:w,flags:A,texelBlockDimension:S,bytesPlane:x,samples:[]},U=(v/4-6)/4;for(let Re=0;Re<U;Re++){const Ie={bitOffset:g._nextUint16(),bitLength:g._nextUint8(),channelType:g._nextUint8(),samplePosition:[g._nextUint8(),g._nextUint8(),g._nextUint8(),g._nextUint8()],sampleLower:Number.NEGATIVE_INFINITY,sampleUpper:Number.POSITIVE_INFINITY};Ie.channelType&m0?(Ie.sampleLower=g._nextInt32(),Ie.sampleUpper=g._nextInt32()):(Ie.sampleLower=g._nextUint32(),Ie.sampleUpper=g._nextUint32()),b.samples[Re]=Ie}r.dataFormatDescriptor.length=0,r.dataFormatDescriptor.push(b);const V=new Er(t,o,c,!0);for(;V._offset<c;){const Re=V._nextUint32(),Ie=V._scan(Re),ze=ei(Ie);if(r.keyValue[ze]=V._nextUint8Array(Re-Ie.byteLength-1),ze.match(/^ktx/i)){const Ke=ei(r.keyValue[ze]);r.keyValue[ze]=Ke.substring(0,Ke.lastIndexOf("\0"))}const Ut=Re%4?4-Re%4:0;V._skip(Ut)}if(h<=0)return r;const z=new Er(t,f,h,!0),X=z._nextUint16(),Y=z._nextUint16(),J=z._nextUint32(),re=z._nextUint32(),ae=z._nextUint32(),lt=z._nextUint32(),Me=[];for(let Re=0,Ie=Math.max(r.levelCount,1);Re<Ie;Re++)Me.push({imageFlags:z._nextUint32(),rgbSliceByteOffset:z._nextUint32(),rgbSliceByteLength:z._nextUint32(),alphaSliceByteOffset:z._nextUint32(),alphaSliceByteLength:z._nextUint32()});const Ue=f+z._offset,Le=Ue+J,xe=Le+re,oe=xe+ae,we=new Uint8Array(t.buffer,t.byteOffset+Ue,J),Jt=new Uint8Array(t.buffer,t.byteOffset+Le,re),Pt=new Uint8Array(t.buffer,t.byteOffset+xe,ae),st=new Uint8Array(t.buffer,t.byteOffset+oe,lt);return r.globalData={endpointCount:X,selectorCount:Y,imageDescs:Me,endpointsData:we,selectorsData:Jt,tablesData:Pt,extendedData:st},r}const pt="EXT_mesh_gpu_instancing",Ne="EXT_meshopt_compression",_r="EXT_texture_webp",wr="EXT_texture_avif",pe="KHR_draco_mesh_compression",Ge="KHR_lights_punctual",gt="KHR_materials_anisotropy",mt="KHR_materials_clearcoat",vt="KHR_materials_diffuse_transmission",xt="KHR_materials_dispersion",Tt="KHR_materials_emissive_strength",yt="KHR_materials_ior",Et="KHR_materials_iridescence",Mt="KHR_materials_pbrSpecularGlossiness",Rt="KHR_materials_sheen",It="KHR_materials_specular",_t="KHR_materials_transmission",Ct="KHR_materials_unlit",wt="KHR_materials_volume",Oe="KHR_materials_variants",Xa="KHR_mesh_quantization",Ar="KHR_texture_basisu",At="KHR_texture_transform",He="KHR_xmp_json_ld",Hn="INSTANCE_ATTRIBUTE";class Ka extends ge{init(){this.extensionName=pt,this.propertyType="InstancedMesh",this.parentTypes=[$.NODE]}getDefaults(){return Object.assign(super.getDefaults(),{attributes:new rt})}getAttribute(e){return this.getRefMap("attributes",e)}setAttribute(e,r){return this.setRefMap("attributes",e,r,{usage:Hn})}listAttributes(){return this.listRefMapValues("attributes")}listSemantics(){return this.listRefMapKeys("attributes")}}Ka.EXTENSION_NAME=pt;class Ya extends he{constructor(...e){super(...e),this.extensionName=pt,this.provideTypes=[$.NODE],this.prewriteTypes=[$.ACCESSOR]}createInstancedMesh(){return new Ka(this.document.getGraph())}read(e){return(e.jsonDoc.json.nodes||[]).forEach((s,i)=>{if(!s.extensions||!s.extensions[pt])return;const a=s.extensions[pt],o=this.createInstancedMesh();for(const c in a.attributes)o.setAttribute(c,e.accessors[a.attributes[c]]);e.nodes[i].setExtension(pt,o)}),this}prewrite(e){e.accessorUsageGroupedByParent.add(Hn);for(const r of this.properties)for(const n of r.listAttributes())e.addAccessorToUsageGroup(n,Hn);return this}write(e){const r=e.jsonDoc;return this.document.getRoot().listNodes().forEach(n=>{const s=n.getExtension(pt);if(s){const i=e.nodeIndexMap.get(n),a=r.json.nodes[i],o={attributes:{}};s.listSemantics().forEach(c=>{const f=s.getAttribute(c);o.attributes[c]=e.accessorIndexMap.get(f)}),a.extensions=a.extensions||{},a.extensions[pt]=o}}),this}}Ya.EXTENSION_NAME=pt;function bt(){return bt=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var r=arguments[e];for(var n in r)({}).hasOwnProperty.call(r,n)&&(t[n]=r[n])}return t},bt.apply(null,arguments)}var Fr;(function(t){t.QUANTIZE="quantize",t.FILTER="filter"})(Fr||(Fr={}));var or;(function(t){t.ATTRIBUTES="ATTRIBUTES",t.TRIANGLES="TRIANGLES",t.INDICES="INDICES"})(or||(or={}));var ve;(function(t){t.NONE="NONE",t.OCTAHEDRAL="OCTAHEDRAL",t.QUATERNION="QUATERNION",t.EXPONENTIAL="EXPONENTIAL"})(ve||(ve={}));function T0(t){return!t.extensions||!t.extensions[Ne]?!1:!!t.extensions[Ne].fallback}const{BYTE:y0,SHORT:ti,FLOAT:E0}=q.ComponentType,{encodeNormalizedInt:ri,decodeNormalizedInt:qn}=ce;function M0(t,e,r,n){const{filter:s,bits:i}=n,a={array:t.getArray(),byteStride:t.getElementSize()*t.getComponentSize(),componentType:t.getComponentType(),normalized:t.getNormalized()};if(r!==or.ATTRIBUTES)return a;if(s!==ve.NONE){let o=t.getNormalized()?R0(t):new Float32Array(a.array);switch(s){case ve.EXPONENTIAL:a.byteStride=t.getElementSize()*4,a.componentType=E0,a.normalized=!1,a.array=e.encodeFilterExp(o,t.getCount(),a.byteStride,i);break;case ve.OCTAHEDRAL:a.byteStride=i>8?8:4,a.componentType=i>8?ti:y0,a.normalized=!0,o=t.getElementSize()===3?_0(o):o,a.array=e.encodeFilterOct(o,t.getCount(),a.byteStride,i);break;case ve.QUATERNION:a.byteStride=8,a.componentType=ti,a.normalized=!0,a.array=e.encodeFilterQuat(o,t.getCount(),a.byteStride,i);break;default:throw new Error("Invalid filter.")}a.min=t.getMin([]),a.max=t.getMax([]),t.getNormalized()&&(a.min=a.min.map(c=>qn(c,t.getComponentType())),a.max=a.max.map(c=>qn(c,t.getComponentType()))),a.normalized&&(a.min=a.min.map(c=>ri(c,a.componentType)),a.max=a.max.map(c=>ri(c,a.componentType)))}else a.byteStride%4&&(a.array=I0(a.array,t.getElementSize()),a.byteStride=a.array.byteLength/t.getCount());return a}function R0(t){const e=t.getComponentType(),r=t.getArray(),n=new Float32Array(r.length);for(let s=0;s<r.length;s++)n[s]=qn(r[s],e);return n}function I0(t,e){const n=ee.padNumber(t.BYTES_PER_ELEMENT*e)/t.BYTES_PER_ELEMENT,s=t.length/e,i=new t.constructor(s*n);for(let a=0;a*e<t.length;a++)for(let o=0;o<e;o++)i[a*n+o]=t[a*e+o];return i}function _0(t){const e=new Float32Array(t.length*4/3);for(let r=0,n=t.length/3;r<n;r++)e[r*4]=t[r*3],e[r*4+1]=t[r*3+1],e[r*4+2]=t[r*3+2];return e}function w0(t,e){return e===nt.BufferViewUsage.ELEMENT_ARRAY_BUFFER?t.listParents().some(n=>n instanceof qt&&n.getMode()===qt.Mode.TRIANGLES)?or.TRIANGLES:or.INDICES:or.ATTRIBUTES}function A0(t,e){const r=e.getGraph().listParentEdges(t).filter(n=>!(n.getParent()instanceof Wa));for(const n of r){const s=n.getName(),i=n.getAttributes().key||"",a=n.getParent().propertyType===$.PRIMITIVE_TARGET;if(s==="indices")return{filter:ve.NONE};if(s==="attributes"){if(i==="POSITION")return{filter:ve.NONE};if(i==="TEXCOORD_0")return{filter:ve.NONE};if(i.startsWith("JOINTS_"))return{filter:ve.NONE};if(i.startsWith("WEIGHTS_"))return{filter:ve.NONE};if(i==="NORMAL"||i==="TANGENT")return a?{filter:ve.NONE}:{filter:ve.OCTAHEDRAL,bits:8}}if(s==="output"){const o=Ja(t);return o==="rotation"?{filter:ve.QUATERNION,bits:16}:o==="translation"?{filter:ve.EXPONENTIAL,bits:12}:o==="scale"?{filter:ve.EXPONENTIAL,bits:12}:{filter:ve.NONE}}if(s==="input")return{filter:ve.NONE};if(s==="inverseBindMatrices")return{filter:ve.NONE}}return{filter:ve.NONE}}function Ja(t){for(const e of t.listParents())if(e instanceof dr){for(const r of e.listParents())if(r instanceof hs)return r.getTargetPath()}return null}const ni={method:Fr.QUANTIZE};class ds extends he{constructor(...e){super(...e),this.extensionName=Ne,this.prereadTypes=[$.BUFFER,$.PRIMITIVE],this.prewriteTypes=[$.BUFFER,$.ACCESSOR],this.readDependencies=["meshopt.decoder"],this.writeDependencies=["meshopt.encoder"],this._decoder=null,this._decoderFallbackBufferMap=new Map,this._encoder=null,this._encoderOptions=ni,this._encoderFallbackBuffer=null,this._encoderBufferViews={},this._encoderBufferViewData={},this._encoderBufferViewAccessors={}}install(e,r){return e==="meshopt.decoder"&&(this._decoder=r),e==="meshopt.encoder"&&(this._encoder=r),this}setEncoderOptions(e){return this._encoderOptions=bt({},ni,e),this}preread(e,r){if(!this._decoder){if(!this.isRequired())return this;throw new Error(`[${Ne}] Please install extension dependency, "meshopt.decoder".`)}if(!this._decoder.supported){if(!this.isRequired())return this;throw new Error(`[${Ne}]: Missing WASM support.`)}return r===$.BUFFER?this._prereadBuffers(e):r===$.PRIMITIVE&&this._prereadPrimitives(e),this}_prereadBuffers(e){const r=e.jsonDoc;(r.json.bufferViews||[]).forEach((s,i)=>{if(!s.extensions||!s.extensions[Ne])return;const a=s.extensions[Ne],o=a.byteOffset||0,c=a.byteLength||0,f=a.count,h=a.byteStride,d=new Uint8Array(f*h),p=r.json.buffers[a.buffer],g=p.uri?r.resources[p.uri]:r.resources[fr],E=ee.toView(g,o,c);this._decoder.decodeGltfBuffer(d,f,h,E,a.mode,a.filter),e.bufferViews[i]=d})}_prereadPrimitives(e){const r=e.jsonDoc;(r.json.bufferViews||[]).forEach(s=>{if(!s.extensions||!s.extensions[Ne])return;const i=s.extensions[Ne],a=e.buffers[i.buffer],o=e.buffers[s.buffer],c=r.json.buffers[s.buffer];T0(c)&&this._decoderFallbackBufferMap.set(o,a)})}read(e){if(!this.isRequired())return this;for(const[r,n]of this._decoderFallbackBufferMap){for(const s of r.listParents())s instanceof q&&s.swap(r,n);r.dispose()}return this}prewrite(e,r){return r===$.ACCESSOR?this._prewriteAccessors(e):r===$.BUFFER&&this._prewriteBuffers(e),this}_prewriteAccessors(e){const r=e.jsonDoc.json,n=this._encoder,s=this._encoderOptions,i=this.document.getGraph(),a=this.document.createBuffer(),o=this.document.getRoot().listBuffers().indexOf(a);let c=1;const f=new Map,h=d=>{for(const p of i.listParents(d)){if(p.propertyType===$.ROOT)continue;let g=f.get(d);return g===void 0&&f.set(d,g=c++),g}return-1};this._encoderFallbackBuffer=a,this._encoderBufferViews={},this._encoderBufferViewData={},this._encoderBufferViewAccessors={};for(const d of this.document.getRoot().listAccessors()){if(Ja(d)==="weights"||d.getSparse())continue;const p=e.getAccessorUsage(d),g=e.accessorUsageGroupedByParent.has(p)?h(d):null,E=w0(d,p),M=s.method===Fr.FILTER?A0(d,this.document):{filter:ve.NONE},T=M0(d,n,E,M),{array:v,byteStride:D}=T,R=d.getBuffer();if(!R)throw new Error(`${Ne}: Missing buffer for accessor.`);const w=this.document.getRoot().listBuffers().indexOf(R),A=[p,g,E,M.filter,D,w].join(":");let S=this._encoderBufferViews[A],x=this._encoderBufferViewData[A],I=this._encoderBufferViewAccessors[A];(!S||!x)&&(I=this._encoderBufferViewAccessors[A]=[],x=this._encoderBufferViewData[A]=[],S=this._encoderBufferViews[A]={buffer:o,target:nt.USAGE_TO_TARGET[p],byteOffset:0,byteLength:0,byteStride:p===nt.BufferViewUsage.ARRAY_BUFFER?D:void 0,extensions:{[Ne]:{buffer:w,byteOffset:0,byteLength:0,mode:E,filter:M.filter!==ve.NONE?M.filter:void 0,byteStride:D,count:0}}});const b=e.createAccessorDef(d);b.componentType=T.componentType,b.normalized=T.normalized,b.byteOffset=S.byteLength,b.min&&T.min&&(b.min=T.min),b.max&&T.max&&(b.max=T.max),e.accessorIndexMap.set(d,r.accessors.length),r.accessors.push(b),I.push(b),x.push(new Uint8Array(v.buffer,v.byteOffset,v.byteLength)),S.byteLength+=v.byteLength,S.extensions.EXT_meshopt_compression.count+=d.getCount()}}_prewriteBuffers(e){const r=this._encoder;for(const n in this._encoderBufferViews){const s=this._encoderBufferViews[n],i=this._encoderBufferViewData[n],a=this.document.getRoot().listBuffers()[s.extensions[Ne].buffer],o=e.otherBufferViews.get(a)||[],{count:c,byteStride:f,mode:h}=s.extensions[Ne],d=ee.concat(i),p=r.encodeGltfBuffer(d,c,f,h),g=ee.pad(p);s.extensions[Ne].byteLength=p.byteLength,i.length=0,i.push(g),o.push(g),e.otherBufferViews.set(a,o)}}write(e){let r=0;for(const a in this._encoderBufferViews){const o=this._encoderBufferViews[a],c=this._encoderBufferViewData[a][0],f=e.otherBufferViewsIndexMap.get(c),h=this._encoderBufferViewAccessors[a];for(const E of h)E.bufferView=f;const d=e.jsonDoc.json.bufferViews[f],p=d.byteOffset||0;Object.assign(d,o),d.byteOffset=r;const g=d.extensions[Ne];g.byteOffset=p,r+=ee.padNumber(o.byteLength)}const n=this._encoderFallbackBuffer,s=e.bufferIndexMap.get(n),i=e.jsonDoc.json.buffers[s];return i.byteLength=r,i.extensions={[Ne]:{fallback:!0}},n.dispose(),this}}ds.EXTENSION_NAME=Ne;ds.EncoderMethod=Fr;class b0{match(e){return e.length>=12&&ee.decodeText(e.slice(4,12))==="ftypavif"}getSize(e){if(!this.match(e))return null;const r=new DataView(e.buffer,e.byteOffset,e.byteLength);let n=si(r,0);if(!n)return null;let s=n.end;for(;n=si(r,s);)if(n.type==="meta")s=n.start+4;else if(n.type==="iprp"||n.type==="ipco")s=n.start;else{if(n.type==="ispe")return[r.getUint32(n.start+4),r.getUint32(n.start+8)];if(n.type==="mdat")break;s=n.end}return null}getChannels(e){return 4}}class Za extends he{constructor(...e){super(...e),this.extensionName=wr,this.prereadTypes=[$.TEXTURE]}static register(){ft.registerFormat("image/avif",new b0)}preread(e){return(e.jsonDoc.json.textures||[]).forEach(n=>{n.extensions&&n.extensions[wr]&&(n.source=n.extensions[wr].source)}),this}read(e){return this}write(e){const r=e.jsonDoc;return this.document.getRoot().listTextures().forEach(n=>{if(n.getMimeType()==="image/avif"){const s=e.imageIndexMap.get(n);(r.json.textures||[]).forEach(a=>{a.source===s&&(a.extensions=a.extensions||{},a.extensions[wr]={source:a.source},delete a.source)})}}),this}}Za.EXTENSION_NAME=wr;function si(t,e){if(t.byteLength<4+e)return null;const r=t.getUint32(e);return t.byteLength<r+e||r<8?null:{type:ee.decodeText(new Uint8Array(t.buffer,t.byteOffset+e+4,4)),start:e+8,end:e+r}}class S0{match(e){return e.length>=12&&e[8]===87&&e[9]===69&&e[10]===66&&e[11]===80}getSize(e){const r=ee.decodeText(e.slice(0,4)),n=ee.decodeText(e.slice(8,12));if(r!=="RIFF"||n!=="WEBP")return null;const s=new DataView(e.buffer,e.byteOffset);let i=12;for(;i<s.byteLength;){const a=ee.decodeText(new Uint8Array([s.getUint8(i),s.getUint8(i+1),s.getUint8(i+2),s.getUint8(i+3)])),o=s.getUint32(i+4,!0);if(a==="VP8 "){const c=s.getInt16(i+14,!0)&16383,f=s.getInt16(i+16,!0)&16383;return[c,f]}else if(a==="VP8L"){const c=s.getUint8(i+9),f=s.getUint8(i+10),h=s.getUint8(i+11),d=s.getUint8(i+12),p=1+((f&63)<<8|c),g=1+((d&15)<<10|h<<2|(f&192)>>6);return[p,g]}i+=8+o+o%2}return null}getChannels(e){return 4}}class Qa extends he{constructor(...e){super(...e),this.extensionName=_r,this.prereadTypes=[$.TEXTURE]}static register(){ft.registerFormat("image/webp",new S0)}preread(e){return(e.jsonDoc.json.textures||[]).forEach(n=>{n.extensions&&n.extensions[_r]&&(n.source=n.extensions[_r].source)}),this}read(e){return this}write(e){const r=e.jsonDoc;return this.document.getRoot().listTextures().forEach(n=>{if(n.getMimeType()==="image/webp"){const s=e.imageIndexMap.get(n);(r.json.textures||[]).forEach(a=>{a.source===s&&(a.extensions=a.extensions||{},a.extensions[_r]={source:a.source},delete a.source)})}}),this}}Qa.EXTENSION_NAME=_r;let _e,eo,to;function N0(t,e){const r=new _e.DecoderBuffer;try{if(r.Init(e,e.length),t.GetEncodedGeometryType(r)!==_e.TRIANGULAR_MESH)throw new Error(`[${pe}] Unknown geometry type.`);const s=new _e.Mesh;if(!t.DecodeBufferToMesh(r,s).ok()||s.ptr===0)throw new Error(`[${pe}] Decoding failure.`);return s}finally{_e.destroy(r)}}function C0(t,e){const n=e.num_faces()*3;let s,i;if(e.num_points()<=65534){const a=n*Uint16Array.BYTES_PER_ELEMENT;s=_e._malloc(a),t.GetTrianglesUInt16Array(e,a,s),i=new Uint16Array(_e.HEAPU16.buffer,s,n).slice()}else{const a=n*Uint32Array.BYTES_PER_ELEMENT;s=_e._malloc(a),t.GetTrianglesUInt32Array(e,a,s),i=new Uint32Array(_e.HEAPU32.buffer,s,n).slice()}return _e._free(s),i}function O0(t,e,r,n){const s=to[n.componentType],i=eo[n.componentType],a=r.num_components(),c=e.num_points()*a,f=c*i.BYTES_PER_ELEMENT,h=_e._malloc(f);t.GetAttributeDataArrayForAllPoints(e,r,s,f,h);const d=new i(_e.HEAPF32.buffer,h,c).slice();return _e._free(h),d}function D0(t){_e=t,eo={[q.ComponentType.FLOAT]:Float32Array,[q.ComponentType.UNSIGNED_INT]:Uint32Array,[q.ComponentType.UNSIGNED_SHORT]:Uint16Array,[q.ComponentType.UNSIGNED_BYTE]:Uint8Array,[q.ComponentType.SHORT]:Int16Array,[q.ComponentType.BYTE]:Int8Array},to={[q.ComponentType.FLOAT]:_e.DT_FLOAT32,[q.ComponentType.UNSIGNED_INT]:_e.DT_UINT32,[q.ComponentType.UNSIGNED_SHORT]:_e.DT_UINT16,[q.ComponentType.UNSIGNED_BYTE]:_e.DT_UINT8,[q.ComponentType.SHORT]:_e.DT_INT16,[q.ComponentType.BYTE]:_e.DT_INT8}}let ke;var $r;(function(t){t[t.EDGEBREAKER=1]="EDGEBREAKER",t[t.SEQUENTIAL=0]="SEQUENTIAL"})($r||($r={}));var qe;(function(t){t.POSITION="POSITION",t.NORMAL="NORMAL",t.COLOR="COLOR",t.TEX_COORD="TEX_COORD",t.GENERIC="GENERIC"})(qe||(qe={}));const ro={[qe.POSITION]:14,[qe.NORMAL]:10,[qe.COLOR]:8,[qe.TEX_COORD]:12,[qe.GENERIC]:12},ii={decodeSpeed:5,encodeSpeed:5,method:$r.EDGEBREAKER,quantizationBits:ro,quantizationVolume:"mesh"};function F0(t){ke=t}function $0(t,e=ii){const r=bt({},ii,e);r.quantizationBits=bt({},ro,e.quantizationBits);const n=new ke.MeshBuilder,s=new ke.Mesh,i=new ke.ExpertEncoder(s),a={},o=new ke.DracoInt8Array,c=t.listTargets().length>0;let f=!1;for(const M of t.listSemantics()){const T=t.getAttribute(M);if(T.getSparse()){f=!0;continue}const v=P0(M),D=U0(n,T.getComponentType(),s,ke[v],T.getCount(),T.getElementSize(),T.getArray());if(D===-1)throw new Error(`Error compressing "${M}" attribute.`);if(a[M]=D,r.quantizationVolume==="mesh"||M!=="POSITION")i.SetAttributeQuantization(D,r.quantizationBits[v]);else if(typeof r.quantizationVolume=="object"){const{quantizationVolume:R}=r,w=Math.max(R.max[0]-R.min[0],R.max[1]-R.min[1],R.max[2]-R.min[2]);i.SetAttributeExplicitQuantization(D,r.quantizationBits[v],T.getElementSize(),R.min,w)}else throw new Error("Invalid quantization volume state.")}const h=t.getIndices();if(!h)throw new Wn("Primitive must have indices.");n.AddFacesToMesh(s,h.getCount()/3,h.getArray()),i.SetSpeedOptions(r.encodeSpeed,r.decodeSpeed),i.SetTrackEncodedProperties(!0),r.method===$r.SEQUENTIAL||c||f?i.SetEncodingMethod(ke.MESH_SEQUENTIAL_ENCODING):i.SetEncodingMethod(ke.MESH_EDGEBREAKER_ENCODING);const d=i.EncodeToDracoBuffer(!(c||f),o);if(d<=0)throw new Wn("Error applying Draco compression.");const p=new Uint8Array(d);for(let M=0;M<d;++M)p[M]=o.GetValue(M);const g=i.GetNumberOfEncodedPoints(),E=i.GetNumberOfEncodedFaces()*3;return ke.destroy(o),ke.destroy(s),ke.destroy(n),ke.destroy(i),{numVertices:g,numIndices:E,data:p,attributeIDs:a}}function P0(t){return t==="POSITION"?qe.POSITION:t==="NORMAL"?qe.NORMAL:t.startsWith("COLOR_")?qe.COLOR:t.startsWith("TEXCOORD_")?qe.TEX_COORD:qe.GENERIC}function U0(t,e,r,n,s,i,a){switch(e){case q.ComponentType.UNSIGNED_BYTE:return t.AddUInt8Attribute(r,n,s,i,a);case q.ComponentType.BYTE:return t.AddInt8Attribute(r,n,s,i,a);case q.ComponentType.UNSIGNED_SHORT:return t.AddUInt16Attribute(r,n,s,i,a);case q.ComponentType.SHORT:return t.AddInt16Attribute(r,n,s,i,a);case q.ComponentType.UNSIGNED_INT:return t.AddUInt32Attribute(r,n,s,i,a);case q.ComponentType.FLOAT:return t.AddFloatAttribute(r,n,s,i,a);default:throw new Error(`Unexpected component type, "${e}".`)}}class Wn extends Error{}class ps extends he{constructor(...e){super(...e),this.extensionName=pe,this.prereadTypes=[$.PRIMITIVE],this.prewriteTypes=[$.ACCESSOR],this.readDependencies=["draco3d.decoder"],this.writeDependencies=["draco3d.encoder"],this._decoderModule=null,this._encoderModule=null,this._encoderOptions={}}install(e,r){return e==="draco3d.decoder"&&(this._decoderModule=r,D0(this._decoderModule)),e==="draco3d.encoder"&&(this._encoderModule=r,F0(this._encoderModule)),this}setEncoderOptions(e){return this._encoderOptions=e,this}preread(e){if(!this._decoderModule)throw new Error(`[${pe}] Please install extension dependency, "draco3d.decoder".`);const r=this.document.getLogger(),n=e.jsonDoc,s=new Map;try{const i=n.json.meshes||[];for(const a of i)for(const o of a.primitives){if(!o.extensions||!o.extensions[pe])continue;const c=o.extensions[pe];let[f,h]=s.get(c.bufferView)||[];if(!h||!f){const d=n.json.bufferViews[c.bufferView],p=n.json.buffers[d.buffer],g=p.uri?n.resources[p.uri]:n.resources[fr],E=d.byteOffset||0,M=d.byteLength,T=ee.toView(g,E,M);f=new this._decoderModule.Decoder,h=N0(f,T),s.set(c.bufferView,[f,h]),r.debug(`[${pe}] Decompressed ${T.byteLength} bytes.`)}for(const d in c.attributes){const p=e.jsonDoc.json.accessors[o.attributes[d]],g=f.GetAttributeByUniqueId(h,c.attributes[d]),E=O0(f,h,g,p);e.accessors[o.attributes[d]].setArray(E)}o.indices!==void 0&&e.accessors[o.indices].setArray(C0(f,h))}}finally{for(const[i,a]of Array.from(s.values()))this._decoderModule.destroy(i),this._decoderModule.destroy(a)}return this}read(e){return this}prewrite(e,r){if(!this._encoderModule)throw new Error(`[${pe}] Please install extension dependency, "draco3d.encoder".`);const n=this.document.getLogger();n.debug(`[${pe}] Compression options: ${JSON.stringify(this._encoderOptions)}`);const s=L0(this.document),i=new Map;let a="mesh";this._encoderOptions.quantizationVolume==="scene"&&(this.document.getRoot().listScenes().length!==1?n.warn(`[${pe}]: quantizationVolume=scene requires exactly 1 scene.`):a=Ag(this.document.getRoot().listScenes().pop()));for(const o of Array.from(s.keys())){const c=s.get(o);if(!c)throw new Error("Unexpected primitive.");if(i.has(c)){i.set(c,i.get(c));continue}const f=o.getIndices(),h=e.jsonDoc.json.accessors;let d;try{d=$0(o,bt({},this._encoderOptions,{quantizationVolume:a}))}catch(E){if(E instanceof Wn){n.warn(`[${pe}]: ${E.message} Skipping primitive compression.`);continue}throw E}i.set(c,d);const p=e.createAccessorDef(f);p.count=d.numIndices,e.accessorIndexMap.set(f,h.length),h.push(p),d.numVertices>65534&&q.getComponentSize(p.componentType)<=2?p.componentType=q.ComponentType.UNSIGNED_INT:d.numVertices>254&&q.getComponentSize(p.componentType)<=1&&(p.componentType=q.ComponentType.UNSIGNED_SHORT);for(const E of o.listSemantics()){const M=o.getAttribute(E);if(d.attributeIDs[E]===void 0)continue;const T=e.createAccessorDef(M);T.count=d.numVertices,e.accessorIndexMap.set(M,h.length),h.push(T)}const g=o.getAttribute("POSITION").getBuffer()||this.document.getRoot().listBuffers()[0];e.otherBufferViews.has(g)||e.otherBufferViews.set(g,[]),e.otherBufferViews.get(g).push(d.data)}return n.debug(`[${pe}] Compressed ${s.size} primitives.`),e.extensionData[pe]={primitiveHashMap:s,primitiveEncodingMap:i},this}write(e){const r=e.extensionData[pe];for(const n of this.document.getRoot().listMeshes()){const s=e.jsonDoc.json.meshes[e.meshIndexMap.get(n)];for(let i=0;i<n.listPrimitives().length;i++){const a=n.listPrimitives()[i],o=s.primitives[i],c=r.primitiveHashMap.get(a);if(!c)continue;const f=r.primitiveEncodingMap.get(c);f&&(o.extensions=o.extensions||{},o.extensions[pe]={bufferView:e.otherBufferViewsIndexMap.get(f.data),attributes:f.attributeIDs})}}if(!r.primitiveHashMap.size){const n=e.jsonDoc.json;n.extensionsUsed=(n.extensionsUsed||[]).filter(s=>s!==pe),n.extensionsRequired=(n.extensionsRequired||[]).filter(s=>s!==pe)}return this}}ps.EXTENSION_NAME=pe;ps.EncoderMethod=$r;function L0(t){const e=t.getLogger(),r=new Set,n=new Set;let s=0,i=0;for(const d of t.getRoot().listMeshes())for(const p of d.listPrimitives())p.getIndices()?p.getMode()!==qt.Mode.TRIANGLES?(n.add(p),i++):r.add(p):(n.add(p),s++);s>0&&e.warn(`[${pe}] Skipping Draco compression of ${s} non-indexed primitives.`),i>0&&e.warn(`[${pe}] Skipping Draco compression of ${i} non-TRIANGLES primitives.`);const a=t.getRoot().listAccessors(),o=new Map;for(let d=0;d<a.length;d++)o.set(a[d],d);const c=new Map,f=new Set,h=new Map;for(const d of Array.from(r)){let p=ai(d,o);if(f.has(p)){h.set(d,p);continue}if(c.has(d.getIndices())){const g=d.getIndices(),E=g.clone();o.set(E,t.getRoot().listAccessors().length-1),d.swap(g,E)}for(const g of d.listAttributes())if(c.has(g)){const E=g.clone();o.set(E,t.getRoot().listAccessors().length-1),d.swap(g,E)}p=ai(d,o),f.add(p),h.set(d,p),c.set(d.getIndices(),p);for(const g of d.listAttributes())c.set(g,p)}for(const d of Array.from(c.keys())){const p=new Set(d.listParents().map(g=>g.propertyType));if(p.size!==2||!p.has($.PRIMITIVE)||!p.has($.ROOT))throw new Error(`[${pe}] Compressed accessors must only be used as indices or vertex attributes.`)}for(const d of Array.from(r)){const p=h.get(d),g=d.getIndices();if(c.get(g)!==p||d.listAttributes().some(E=>c.get(E)!==p))throw new Error(`[${pe}] Draco primitives must share all, or no, accessors.`)}for(const d of Array.from(n)){const p=d.getIndices();if(c.has(p)||d.listAttributes().some(g=>c.has(g)))throw new Error(`[${pe}] Accessor cannot be shared by compressed and uncompressed primitives.`)}return h}function ai(t,e){const r=[],n=t.getIndices();r.push(e.get(n));for(const s of t.listAttributes())r.push(e.get(s));return r.sort().join("|")}class hr extends ge{init(){this.extensionName=Ge,this.propertyType="Light",this.parentTypes=[$.NODE]}getDefaults(){return Object.assign(super.getDefaults(),{color:[1,1,1],intensity:1,type:hr.Type.POINT,range:null,innerConeAngle:0,outerConeAngle:Math.PI/4})}getColor(){return this.get("color")}setColor(e){return this.set("color",e)}getIntensity(){return this.get("intensity")}setIntensity(e){return this.set("intensity",e)}getType(){return this.get("type")}setType(e){return this.set("type",e)}getRange(){return this.get("range")}setRange(e){return this.set("range",e)}getInnerConeAngle(){return this.get("innerConeAngle")}setInnerConeAngle(e){return this.set("innerConeAngle",e)}getOuterConeAngle(){return this.get("outerConeAngle")}setOuterConeAngle(e){return this.set("outerConeAngle",e)}}hr.EXTENSION_NAME=Ge;hr.Type={POINT:"point",SPOT:"spot",DIRECTIONAL:"directional"};class no extends he{constructor(...e){super(...e),this.extensionName=Ge}createLight(e=""){return new hr(this.document.getGraph(),e)}read(e){const r=e.jsonDoc;if(!r.json.extensions||!r.json.extensions[Ge])return this;const i=(r.json.extensions[Ge].lights||[]).map(a=>{var o,c;const f=this.createLight().setName(a.name||"").setType(a.type);return a.color!==void 0&&f.setColor(a.color),a.intensity!==void 0&&f.setIntensity(a.intensity),a.range!==void 0&&f.setRange(a.range),((o=a.spot)==null?void 0:o.innerConeAngle)!==void 0&&f.setInnerConeAngle(a.spot.innerConeAngle),((c=a.spot)==null?void 0:c.outerConeAngle)!==void 0&&f.setOuterConeAngle(a.spot.outerConeAngle),f});return r.json.nodes.forEach((a,o)=>{if(!a.extensions||!a.extensions[Ge])return;const c=a.extensions[Ge];e.nodes[o].setExtension(Ge,i[c.light])}),this}write(e){const r=e.jsonDoc;if(this.properties.size===0)return this;const n=[],s=new Map;for(const i of this.properties){const a=i,o={type:a.getType()};ce.eq(a.getColor(),[1,1,1])||(o.color=a.getColor()),a.getIntensity()!==1&&(o.intensity=a.getIntensity()),a.getRange()!=null&&(o.range=a.getRange()),a.getName()&&(o.name=a.getName()),a.getType()===hr.Type.SPOT&&(o.spot={innerConeAngle:a.getInnerConeAngle(),outerConeAngle:a.getOuterConeAngle()}),n.push(o),s.set(a,n.length-1)}return this.document.getRoot().listNodes().forEach(i=>{const a=i.getExtension(Ge);if(a){const o=e.nodeIndexMap.get(i),c=r.json.nodes[o];c.extensions=c.extensions||{},c.extensions[Ge]={light:s.get(a)}}}),r.json.extensions=r.json.extensions||{},r.json.extensions[Ge]={lights:n},this}}no.EXTENSION_NAME=Ge;const{R:B0,G:j0,B:V0}=Xe;class so extends ge{init(){this.extensionName=gt,this.propertyType="Anisotropy",this.parentTypes=[$.MATERIAL]}getDefaults(){return Object.assign(super.getDefaults(),{anisotropyStrength:0,anisotropyRotation:0,anisotropyTexture:null,anisotropyTextureInfo:new le(this.graph,"anisotropyTextureInfo")})}getAnisotropyStrength(){return this.get("anisotropyStrength")}setAnisotropyStrength(e){return this.set("anisotropyStrength",e)}getAnisotropyRotation(){return this.get("anisotropyRotation")}setAnisotropyRotation(e){return this.set("anisotropyRotation",e)}getAnisotropyTexture(){return this.getRef("anisotropyTexture")}getAnisotropyTextureInfo(){return this.getRef("anisotropyTexture")?this.getRef("anisotropyTextureInfo"):null}setAnisotropyTexture(e){return this.setRef("anisotropyTexture",e,{channels:B0|j0|V0})}}so.EXTENSION_NAME=gt;class io extends he{constructor(...e){super(...e),this.extensionName=gt,this.prereadTypes=[$.MESH],this.prewriteTypes=[$.MESH]}createAnisotropy(){return new so(this.document.getGraph())}read(e){return this}write(e){return this}preread(e){const r=e.jsonDoc,n=r.json.materials||[],s=r.json.textures||[];return n.forEach((i,a)=>{if(i.extensions&&i.extensions[gt]){const o=this.createAnisotropy();e.materials[a].setExtension(gt,o);const c=i.extensions[gt];if(c.anisotropyStrength!==void 0&&o.setAnisotropyStrength(c.anisotropyStrength),c.anisotropyRotation!==void 0&&o.setAnisotropyRotation(c.anisotropyRotation),c.anisotropyTexture!==void 0){const f=c.anisotropyTexture,h=e.textures[s[f.index].source];o.setAnisotropyTexture(h),e.setTextureInfo(o.getAnisotropyTextureInfo(),f)}}}),this}prewrite(e){const r=e.jsonDoc;return this.document.getRoot().listMaterials().forEach(n=>{const s=n.getExtension(gt);if(s){const i=e.materialIndexMap.get(n),a=r.json.materials[i];a.extensions=a.extensions||{};const o=a.extensions[gt]={};if(s.getAnisotropyStrength()>0&&(o.anisotropyStrength=s.getAnisotropyStrength()),s.getAnisotropyRotation()!==0&&(o.anisotropyRotation=s.getAnisotropyRotation()),s.getAnisotropyTexture()){const c=s.getAnisotropyTexture(),f=s.getAnisotropyTextureInfo();o.anisotropyTexture=e.createTextureInfoDef(c,f)}}}),this}}io.EXTENSION_NAME=gt;const{R:oi,G:ci,B:z0}=Xe;class ao extends ge{init(){this.extensionName=mt,this.propertyType="Clearcoat",this.parentTypes=[$.MATERIAL]}getDefaults(){return Object.assign(super.getDefaults(),{clearcoatFactor:0,clearcoatTexture:null,clearcoatTextureInfo:new le(this.graph,"clearcoatTextureInfo"),clearcoatRoughnessFactor:0,clearcoatRoughnessTexture:null,clearcoatRoughnessTextureInfo:new le(this.graph,"clearcoatRoughnessTextureInfo"),clearcoatNormalScale:1,clearcoatNormalTexture:null,clearcoatNormalTextureInfo:new le(this.graph,"clearcoatNormalTextureInfo")})}getClearcoatFactor(){return this.get("clearcoatFactor")}setClearcoatFactor(e){return this.set("clearcoatFactor",e)}getClearcoatTexture(){return this.getRef("clearcoatTexture")}getClearcoatTextureInfo(){return this.getRef("clearcoatTexture")?this.getRef("clearcoatTextureInfo"):null}setClearcoatTexture(e){return this.setRef("clearcoatTexture",e,{channels:oi})}getClearcoatRoughnessFactor(){return this.get("clearcoatRoughnessFactor")}setClearcoatRoughnessFactor(e){return this.set("clearcoatRoughnessFactor",e)}getClearcoatRoughnessTexture(){return this.getRef("clearcoatRoughnessTexture")}getClearcoatRoughnessTextureInfo(){return this.getRef("clearcoatRoughnessTexture")?this.getRef("clearcoatRoughnessTextureInfo"):null}setClearcoatRoughnessTexture(e){return this.setRef("clearcoatRoughnessTexture",e,{channels:ci})}getClearcoatNormalScale(){return this.get("clearcoatNormalScale")}setClearcoatNormalScale(e){return this.set("clearcoatNormalScale",e)}getClearcoatNormalTexture(){return this.getRef("clearcoatNormalTexture")}getClearcoatNormalTextureInfo(){return this.getRef("clearcoatNormalTexture")?this.getRef("clearcoatNormalTextureInfo"):null}setClearcoatNormalTexture(e){return this.setRef("clearcoatNormalTexture",e,{channels:oi|ci|z0})}}ao.EXTENSION_NAME=mt;class oo extends he{constructor(...e){super(...e),this.extensionName=mt,this.prereadTypes=[$.MESH],this.prewriteTypes=[$.MESH]}createClearcoat(){return new ao(this.document.getGraph())}read(e){return this}write(e){return this}preread(e){const r=e.jsonDoc,n=r.json.materials||[],s=r.json.textures||[];return n.forEach((i,a)=>{if(i.extensions&&i.extensions[mt]){const o=this.createClearcoat();e.materials[a].setExtension(mt,o);const c=i.extensions[mt];if(c.clearcoatFactor!==void 0&&o.setClearcoatFactor(c.clearcoatFactor),c.clearcoatRoughnessFactor!==void 0&&o.setClearcoatRoughnessFactor(c.clearcoatRoughnessFactor),c.clearcoatTexture!==void 0){const f=c.clearcoatTexture,h=e.textures[s[f.index].source];o.setClearcoatTexture(h),e.setTextureInfo(o.getClearcoatTextureInfo(),f)}if(c.clearcoatRoughnessTexture!==void 0){const f=c.clearcoatRoughnessTexture,h=e.textures[s[f.index].source];o.setClearcoatRoughnessTexture(h),e.setTextureInfo(o.getClearcoatRoughnessTextureInfo(),f)}if(c.clearcoatNormalTexture!==void 0){const f=c.clearcoatNormalTexture,h=e.textures[s[f.index].source];o.setClearcoatNormalTexture(h),e.setTextureInfo(o.getClearcoatNormalTextureInfo(),f),f.scale!==void 0&&o.setClearcoatNormalScale(f.scale)}}}),this}prewrite(e){const r=e.jsonDoc;return this.document.getRoot().listMaterials().forEach(n=>{const s=n.getExtension(mt);if(s){const i=e.materialIndexMap.get(n),a=r.json.materials[i];a.extensions=a.extensions||{};const o=a.extensions[mt]={clearcoatFactor:s.getClearcoatFactor(),clearcoatRoughnessFactor:s.getClearcoatRoughnessFactor()};if(s.getClearcoatTexture()){const c=s.getClearcoatTexture(),f=s.getClearcoatTextureInfo();o.clearcoatTexture=e.createTextureInfoDef(c,f)}if(s.getClearcoatRoughnessTexture()){const c=s.getClearcoatRoughnessTexture(),f=s.getClearcoatRoughnessTextureInfo();o.clearcoatRoughnessTexture=e.createTextureInfoDef(c,f)}if(s.getClearcoatNormalTexture()){const c=s.getClearcoatNormalTexture(),f=s.getClearcoatNormalTextureInfo();o.clearcoatNormalTexture=e.createTextureInfoDef(c,f),s.getClearcoatNormalScale()!==1&&(o.clearcoatNormalTexture.scale=s.getClearcoatNormalScale())}}}),this}}oo.EXTENSION_NAME=mt;const{R:k0,G:G0,B:H0,A:q0}=Xe;class co extends ge{init(){this.extensionName=vt,this.propertyType="DiffuseTransmission",this.parentTypes=[$.MATERIAL]}getDefaults(){return Object.assign(super.getDefaults(),{diffuseTransmissionFactor:0,diffuseTransmissionTexture:null,diffuseTransmissionTextureInfo:new le(this.graph,"diffuseTransmissionTextureInfo"),diffuseTransmissionColorFactor:[1,1,1],diffuseTransmissionColorTexture:null,diffuseTransmissionColorTextureInfo:new le(this.graph,"diffuseTransmissionColorTextureInfo")})}getDiffuseTransmissionFactor(){return this.get("diffuseTransmissionFactor")}setDiffuseTransmissionFactor(e){return this.set("diffuseTransmissionFactor",e)}getDiffuseTransmissionTexture(){return this.getRef("diffuseTransmissionTexture")}getDiffuseTransmissionTextureInfo(){return this.getRef("diffuseTransmissionTexture")?this.getRef("diffuseTransmissionTextureInfo"):null}setDiffuseTransmissionTexture(e){return this.setRef("diffuseTransmissionTexture",e,{channels:q0})}getDiffuseTransmissionColorFactor(){return this.get("diffuseTransmissionColorFactor")}setDiffuseTransmissionColorFactor(e){return this.set("diffuseTransmissionColorFactor",e)}getDiffuseTransmissionColorTexture(){return this.getRef("diffuseTransmissionColorTexture")}getDiffuseTransmissionColorTextureInfo(){return this.getRef("diffuseTransmissionColorTexture")?this.getRef("diffuseTransmissionColorTextureInfo"):null}setDiffuseTransmissionColorTexture(e){return this.setRef("diffuseTransmissionColorTexture",e,{channels:k0|G0|H0})}}co.EXTENSION_NAME=vt;class fo extends he{constructor(...e){super(...e),this.extensionName=vt}createDiffuseTransmission(){return new co(this.document.getGraph())}read(e){const r=e.jsonDoc,n=r.json.materials||[],s=r.json.textures||[];return n.forEach((i,a)=>{if(i.extensions&&i.extensions[vt]){const o=this.createDiffuseTransmission();e.materials[a].setExtension(vt,o);const c=i.extensions[vt];if(c.diffuseTransmissionFactor!==void 0&&o.setDiffuseTransmissionFactor(c.diffuseTransmissionFactor),c.diffuseTransmissionColorFactor!==void 0&&o.setDiffuseTransmissionColorFactor(c.diffuseTransmissionColorFactor),c.diffuseTransmissionTexture!==void 0){const f=c.diffuseTransmissionTexture,h=e.textures[s[f.index].source];o.setDiffuseTransmissionTexture(h),e.setTextureInfo(o.getDiffuseTransmissionTextureInfo(),f)}if(c.diffuseTransmissionColorTexture!==void 0){const f=c.diffuseTransmissionColorTexture,h=e.textures[s[f.index].source];o.setDiffuseTransmissionColorTexture(h),e.setTextureInfo(o.getDiffuseTransmissionColorTextureInfo(),f)}}}),this}write(e){const r=e.jsonDoc;for(const n of this.document.getRoot().listMaterials()){const s=n.getExtension(vt);if(!s)continue;const i=e.materialIndexMap.get(n),a=r.json.materials[i];a.extensions=a.extensions||{};const o=a.extensions[vt]={diffuseTransmissionFactor:s.getDiffuseTransmissionFactor(),diffuseTransmissionColorFactor:s.getDiffuseTransmissionColorFactor()};if(s.getDiffuseTransmissionTexture()){const c=s.getDiffuseTransmissionTexture(),f=s.getDiffuseTransmissionTextureInfo();o.diffuseTransmissionTexture=e.createTextureInfoDef(c,f)}if(s.getDiffuseTransmissionColorTexture()){const c=s.getDiffuseTransmissionColorTexture(),f=s.getDiffuseTransmissionColorTextureInfo();o.diffuseTransmissionColorTexture=e.createTextureInfoDef(c,f)}}return this}}fo.EXTENSION_NAME=vt;class lo extends ge{init(){this.extensionName=xt,this.propertyType="Dispersion",this.parentTypes=[$.MATERIAL]}getDefaults(){return Object.assign(super.getDefaults(),{dispersion:0})}getDispersion(){return this.get("dispersion")}setDispersion(e){return this.set("dispersion",e)}}lo.EXTENSION_NAME=xt;class uo extends he{constructor(...e){super(...e),this.extensionName=xt,this.prereadTypes=[$.MESH],this.prewriteTypes=[$.MESH]}createDispersion(){return new lo(this.document.getGraph())}read(e){return this}write(e){return this}preread(e){return(e.jsonDoc.json.materials||[]).forEach((s,i)=>{if(s.extensions&&s.extensions[xt]){const a=this.createDispersion();e.materials[i].setExtension(xt,a);const o=s.extensions[xt];o.dispersion!==void 0&&a.setDispersion(o.dispersion)}}),this}prewrite(e){const r=e.jsonDoc;return this.document.getRoot().listMaterials().forEach(n=>{const s=n.getExtension(xt);if(s){const i=e.materialIndexMap.get(n),a=r.json.materials[i];a.extensions=a.extensions||{},a.extensions[xt]={dispersion:s.getDispersion()}}}),this}}uo.EXTENSION_NAME=xt;class ho extends ge{init(){this.extensionName=Tt,this.propertyType="EmissiveStrength",this.parentTypes=[$.MATERIAL]}getDefaults(){return Object.assign(super.getDefaults(),{emissiveStrength:1})}getEmissiveStrength(){return this.get("emissiveStrength")}setEmissiveStrength(e){return this.set("emissiveStrength",e)}}ho.EXTENSION_NAME=Tt;class po extends he{constructor(...e){super(...e),this.extensionName=Tt,this.prereadTypes=[$.MESH],this.prewriteTypes=[$.MESH]}createEmissiveStrength(){return new ho(this.document.getGraph())}read(e){return this}write(e){return this}preread(e){return(e.jsonDoc.json.materials||[]).forEach((s,i)=>{if(s.extensions&&s.extensions[Tt]){const a=this.createEmissiveStrength();e.materials[i].setExtension(Tt,a);const o=s.extensions[Tt];o.emissiveStrength!==void 0&&a.setEmissiveStrength(o.emissiveStrength)}}),this}prewrite(e){const r=e.jsonDoc;return this.document.getRoot().listMaterials().forEach(n=>{const s=n.getExtension(Tt);if(s){const i=e.materialIndexMap.get(n),a=r.json.materials[i];a.extensions=a.extensions||{},a.extensions[Tt]={emissiveStrength:s.getEmissiveStrength()}}}),this}}po.EXTENSION_NAME=Tt;class go extends ge{init(){this.extensionName=yt,this.propertyType="IOR",this.parentTypes=[$.MATERIAL]}getDefaults(){return Object.assign(super.getDefaults(),{ior:1.5})}getIOR(){return this.get("ior")}setIOR(e){return this.set("ior",e)}}go.EXTENSION_NAME=yt;class mo extends he{constructor(...e){super(...e),this.extensionName=yt,this.prereadTypes=[$.MESH],this.prewriteTypes=[$.MESH]}createIOR(){return new go(this.document.getGraph())}read(e){return this}write(e){return this}preread(e){return(e.jsonDoc.json.materials||[]).forEach((s,i)=>{if(s.extensions&&s.extensions[yt]){const a=this.createIOR();e.materials[i].setExtension(yt,a);const o=s.extensions[yt];o.ior!==void 0&&a.setIOR(o.ior)}}),this}prewrite(e){const r=e.jsonDoc;return this.document.getRoot().listMaterials().forEach(n=>{const s=n.getExtension(yt);if(s){const i=e.materialIndexMap.get(n),a=r.json.materials[i];a.extensions=a.extensions||{},a.extensions[yt]={ior:s.getIOR()}}}),this}}mo.EXTENSION_NAME=yt;const{R:W0,G:X0}=Xe;class vo extends ge{init(){this.extensionName=Et,this.propertyType="Iridescence",this.parentTypes=[$.MATERIAL]}getDefaults(){return Object.assign(super.getDefaults(),{iridescenceFactor:0,iridescenceTexture:null,iridescenceTextureInfo:new le(this.graph,"iridescenceTextureInfo"),iridescenceIOR:1.3,iridescenceThicknessMinimum:100,iridescenceThicknessMaximum:400,iridescenceThicknessTexture:null,iridescenceThicknessTextureInfo:new le(this.graph,"iridescenceThicknessTextureInfo")})}getIridescenceFactor(){return this.get("iridescenceFactor")}setIridescenceFactor(e){return this.set("iridescenceFactor",e)}getIridescenceTexture(){return this.getRef("iridescenceTexture")}getIridescenceTextureInfo(){return this.getRef("iridescenceTexture")?this.getRef("iridescenceTextureInfo"):null}setIridescenceTexture(e){return this.setRef("iridescenceTexture",e,{channels:W0})}getIridescenceIOR(){return this.get("iridescenceIOR")}setIridescenceIOR(e){return this.set("iridescenceIOR",e)}getIridescenceThicknessMinimum(){return this.get("iridescenceThicknessMinimum")}setIridescenceThicknessMinimum(e){return this.set("iridescenceThicknessMinimum",e)}getIridescenceThicknessMaximum(){return this.get("iridescenceThicknessMaximum")}setIridescenceThicknessMaximum(e){return this.set("iridescenceThicknessMaximum",e)}getIridescenceThicknessTexture(){return this.getRef("iridescenceThicknessTexture")}getIridescenceThicknessTextureInfo(){return this.getRef("iridescenceThicknessTexture")?this.getRef("iridescenceThicknessTextureInfo"):null}setIridescenceThicknessTexture(e){return this.setRef("iridescenceThicknessTexture",e,{channels:X0})}}vo.EXTENSION_NAME=Et;class xo extends he{constructor(...e){super(...e),this.extensionName=Et,this.prereadTypes=[$.MESH],this.prewriteTypes=[$.MESH]}createIridescence(){return new vo(this.document.getGraph())}read(e){return this}write(e){return this}preread(e){const r=e.jsonDoc,n=r.json.materials||[],s=r.json.textures||[];return n.forEach((i,a)=>{if(i.extensions&&i.extensions[Et]){const o=this.createIridescence();e.materials[a].setExtension(Et,o);const c=i.extensions[Et];if(c.iridescenceFactor!==void 0&&o.setIridescenceFactor(c.iridescenceFactor),c.iridescenceIor!==void 0&&o.setIridescenceIOR(c.iridescenceIor),c.iridescenceThicknessMinimum!==void 0&&o.setIridescenceThicknessMinimum(c.iridescenceThicknessMinimum),c.iridescenceThicknessMaximum!==void 0&&o.setIridescenceThicknessMaximum(c.iridescenceThicknessMaximum),c.iridescenceTexture!==void 0){const f=c.iridescenceTexture,h=e.textures[s[f.index].source];o.setIridescenceTexture(h),e.setTextureInfo(o.getIridescenceTextureInfo(),f)}if(c.iridescenceThicknessTexture!==void 0){const f=c.iridescenceThicknessTexture,h=e.textures[s[f.index].source];o.setIridescenceThicknessTexture(h),e.setTextureInfo(o.getIridescenceThicknessTextureInfo(),f)}}}),this}prewrite(e){const r=e.jsonDoc;return this.document.getRoot().listMaterials().forEach(n=>{const s=n.getExtension(Et);if(s){const i=e.materialIndexMap.get(n),a=r.json.materials[i];a.extensions=a.extensions||{};const o=a.extensions[Et]={};if(s.getIridescenceFactor()>0&&(o.iridescenceFactor=s.getIridescenceFactor()),s.getIridescenceIOR()!==1.3&&(o.iridescenceIor=s.getIridescenceIOR()),s.getIridescenceThicknessMinimum()!==100&&(o.iridescenceThicknessMinimum=s.getIridescenceThicknessMinimum()),s.getIridescenceThicknessMaximum()!==400&&(o.iridescenceThicknessMaximum=s.getIridescenceThicknessMaximum()),s.getIridescenceTexture()){const c=s.getIridescenceTexture(),f=s.getIridescenceTextureInfo();o.iridescenceTexture=e.createTextureInfoDef(c,f)}if(s.getIridescenceThicknessTexture()){const c=s.getIridescenceThicknessTexture(),f=s.getIridescenceThicknessTextureInfo();o.iridescenceThicknessTexture=e.createTextureInfoDef(c,f)}}}),this}}xo.EXTENSION_NAME=Et;const{R:fi,G:li,B:ui,A:hi}=Xe;class To extends ge{init(){this.extensionName=Mt,this.propertyType="PBRSpecularGlossiness",this.parentTypes=[$.MATERIAL]}getDefaults(){return Object.assign(super.getDefaults(),{diffuseFactor:[1,1,1,1],diffuseTexture:null,diffuseTextureInfo:new le(this.graph,"diffuseTextureInfo"),specularFactor:[1,1,1],glossinessFactor:1,specularGlossinessTexture:null,specularGlossinessTextureInfo:new le(this.graph,"specularGlossinessTextureInfo")})}getDiffuseFactor(){return this.get("diffuseFactor")}setDiffuseFactor(e){return this.set("diffuseFactor",e)}getDiffuseTexture(){return this.getRef("diffuseTexture")}getDiffuseTextureInfo(){return this.getRef("diffuseTexture")?this.getRef("diffuseTextureInfo"):null}setDiffuseTexture(e){return this.setRef("diffuseTexture",e,{channels:fi|li|ui|hi,isColor:!0})}getSpecularFactor(){return this.get("specularFactor")}setSpecularFactor(e){return this.set("specularFactor",e)}getGlossinessFactor(){return this.get("glossinessFactor")}setGlossinessFactor(e){return this.set("glossinessFactor",e)}getSpecularGlossinessTexture(){return this.getRef("specularGlossinessTexture")}getSpecularGlossinessTextureInfo(){return this.getRef("specularGlossinessTexture")?this.getRef("specularGlossinessTextureInfo"):null}setSpecularGlossinessTexture(e){return this.setRef("specularGlossinessTexture",e,{channels:fi|li|ui|hi})}}To.EXTENSION_NAME=Mt;class yo extends he{constructor(...e){super(...e),this.extensionName=Mt,this.prereadTypes=[$.MESH],this.prewriteTypes=[$.MESH]}createPBRSpecularGlossiness(){return new To(this.document.getGraph())}read(e){return this}write(e){return this}preread(e){const r=e.jsonDoc,n=r.json.materials||[],s=r.json.textures||[];return n.forEach((i,a)=>{if(i.extensions&&i.extensions[Mt]){const o=this.createPBRSpecularGlossiness();e.materials[a].setExtension(Mt,o);const c=i.extensions[Mt];if(c.diffuseFactor!==void 0&&o.setDiffuseFactor(c.diffuseFactor),c.specularFactor!==void 0&&o.setSpecularFactor(c.specularFactor),c.glossinessFactor!==void 0&&o.setGlossinessFactor(c.glossinessFactor),c.diffuseTexture!==void 0){const f=c.diffuseTexture,h=e.textures[s[f.index].source];o.setDiffuseTexture(h),e.setTextureInfo(o.getDiffuseTextureInfo(),f)}if(c.specularGlossinessTexture!==void 0){const f=c.specularGlossinessTexture,h=e.textures[s[f.index].source];o.setSpecularGlossinessTexture(h),e.setTextureInfo(o.getSpecularGlossinessTextureInfo(),f)}}}),this}prewrite(e){const r=e.jsonDoc;return this.document.getRoot().listMaterials().forEach(n=>{const s=n.getExtension(Mt);if(s){const i=e.materialIndexMap.get(n),a=r.json.materials[i];a.extensions=a.extensions||{};const o=a.extensions[Mt]={diffuseFactor:s.getDiffuseFactor(),specularFactor:s.getSpecularFactor(),glossinessFactor:s.getGlossinessFactor()};if(s.getDiffuseTexture()){const c=s.getDiffuseTexture(),f=s.getDiffuseTextureInfo();o.diffuseTexture=e.createTextureInfoDef(c,f)}if(s.getSpecularGlossinessTexture()){const c=s.getSpecularGlossinessTexture(),f=s.getSpecularGlossinessTextureInfo();o.specularGlossinessTexture=e.createTextureInfoDef(c,f)}}}),this}}yo.EXTENSION_NAME=Mt;const{R:K0,G:Y0,B:J0,A:Z0}=Xe;class Eo extends ge{init(){this.extensionName=Rt,this.propertyType="Sheen",this.parentTypes=[$.MATERIAL]}getDefaults(){return Object.assign(super.getDefaults(),{sheenColorFactor:[0,0,0],sheenColorTexture:null,sheenColorTextureInfo:new le(this.graph,"sheenColorTextureInfo"),sheenRoughnessFactor:0,sheenRoughnessTexture:null,sheenRoughnessTextureInfo:new le(this.graph,"sheenRoughnessTextureInfo")})}getSheenColorFactor(){return this.get("sheenColorFactor")}setSheenColorFactor(e){return this.set("sheenColorFactor",e)}getSheenColorTexture(){return this.getRef("sheenColorTexture")}getSheenColorTextureInfo(){return this.getRef("sheenColorTexture")?this.getRef("sheenColorTextureInfo"):null}setSheenColorTexture(e){return this.setRef("sheenColorTexture",e,{channels:K0|Y0|J0,isColor:!0})}getSheenRoughnessFactor(){return this.get("sheenRoughnessFactor")}setSheenRoughnessFactor(e){return this.set("sheenRoughnessFactor",e)}getSheenRoughnessTexture(){return this.getRef("sheenRoughnessTexture")}getSheenRoughnessTextureInfo(){return this.getRef("sheenRoughnessTexture")?this.getRef("sheenRoughnessTextureInfo"):null}setSheenRoughnessTexture(e){return this.setRef("sheenRoughnessTexture",e,{channels:Z0})}}Eo.EXTENSION_NAME=Rt;class Mo extends he{constructor(...e){super(...e),this.extensionName=Rt,this.prereadTypes=[$.MESH],this.prewriteTypes=[$.MESH]}createSheen(){return new Eo(this.document.getGraph())}read(e){return this}write(e){return this}preread(e){const r=e.jsonDoc,n=r.json.materials||[],s=r.json.textures||[];return n.forEach((i,a)=>{if(i.extensions&&i.extensions[Rt]){const o=this.createSheen();e.materials[a].setExtension(Rt,o);const c=i.extensions[Rt];if(c.sheenColorFactor!==void 0&&o.setSheenColorFactor(c.sheenColorFactor),c.sheenRoughnessFactor!==void 0&&o.setSheenRoughnessFactor(c.sheenRoughnessFactor),c.sheenColorTexture!==void 0){const f=c.sheenColorTexture,h=e.textures[s[f.index].source];o.setSheenColorTexture(h),e.setTextureInfo(o.getSheenColorTextureInfo(),f)}if(c.sheenRoughnessTexture!==void 0){const f=c.sheenRoughnessTexture,h=e.textures[s[f.index].source];o.setSheenRoughnessTexture(h),e.setTextureInfo(o.getSheenRoughnessTextureInfo(),f)}}}),this}prewrite(e){const r=e.jsonDoc;return this.document.getRoot().listMaterials().forEach(n=>{const s=n.getExtension(Rt);if(s){const i=e.materialIndexMap.get(n),a=r.json.materials[i];a.extensions=a.extensions||{};const o=a.extensions[Rt]={sheenColorFactor:s.getSheenColorFactor(),sheenRoughnessFactor:s.getSheenRoughnessFactor()};if(s.getSheenColorTexture()){const c=s.getSheenColorTexture(),f=s.getSheenColorTextureInfo();o.sheenColorTexture=e.createTextureInfoDef(c,f)}if(s.getSheenRoughnessTexture()){const c=s.getSheenRoughnessTexture(),f=s.getSheenRoughnessTextureInfo();o.sheenRoughnessTexture=e.createTextureInfoDef(c,f)}}}),this}}Mo.EXTENSION_NAME=Rt;const{R:Q0,G:e1,B:t1,A:r1}=Xe;class Ro extends ge{init(){this.extensionName=It,this.propertyType="Specular",this.parentTypes=[$.MATERIAL]}getDefaults(){return Object.assign(super.getDefaults(),{specularFactor:1,specularTexture:null,specularTextureInfo:new le(this.graph,"specularTextureInfo"),specularColorFactor:[1,1,1],specularColorTexture:null,specularColorTextureInfo:new le(this.graph,"specularColorTextureInfo")})}getSpecularFactor(){return this.get("specularFactor")}setSpecularFactor(e){return this.set("specularFactor",e)}getSpecularColorFactor(){return this.get("specularColorFactor")}setSpecularColorFactor(e){return this.set("specularColorFactor",e)}getSpecularTexture(){return this.getRef("specularTexture")}getSpecularTextureInfo(){return this.getRef("specularTexture")?this.getRef("specularTextureInfo"):null}setSpecularTexture(e){return this.setRef("specularTexture",e,{channels:r1})}getSpecularColorTexture(){return this.getRef("specularColorTexture")}getSpecularColorTextureInfo(){return this.getRef("specularColorTexture")?this.getRef("specularColorTextureInfo"):null}setSpecularColorTexture(e){return this.setRef("specularColorTexture",e,{channels:Q0|e1|t1,isColor:!0})}}Ro.EXTENSION_NAME=It;class Io extends he{constructor(...e){super(...e),this.extensionName=It,this.prereadTypes=[$.MESH],this.prewriteTypes=[$.MESH]}createSpecular(){return new Ro(this.document.getGraph())}read(e){return this}write(e){return this}preread(e){const r=e.jsonDoc,n=r.json.materials||[],s=r.json.textures||[];return n.forEach((i,a)=>{if(i.extensions&&i.extensions[It]){const o=this.createSpecular();e.materials[a].setExtension(It,o);const c=i.extensions[It];if(c.specularFactor!==void 0&&o.setSpecularFactor(c.specularFactor),c.specularColorFactor!==void 0&&o.setSpecularColorFactor(c.specularColorFactor),c.specularTexture!==void 0){const f=c.specularTexture,h=e.textures[s[f.index].source];o.setSpecularTexture(h),e.setTextureInfo(o.getSpecularTextureInfo(),f)}if(c.specularColorTexture!==void 0){const f=c.specularColorTexture,h=e.textures[s[f.index].source];o.setSpecularColorTexture(h),e.setTextureInfo(o.getSpecularColorTextureInfo(),f)}}}),this}prewrite(e){const r=e.jsonDoc;return this.document.getRoot().listMaterials().forEach(n=>{const s=n.getExtension(It);if(s){const i=e.materialIndexMap.get(n),a=r.json.materials[i];a.extensions=a.extensions||{};const o=a.extensions[It]={};if(s.getSpecularFactor()!==1&&(o.specularFactor=s.getSpecularFactor()),ce.eq(s.getSpecularColorFactor(),[1,1,1])||(o.specularColorFactor=s.getSpecularColorFactor()),s.getSpecularTexture()){const c=s.getSpecularTexture(),f=s.getSpecularTextureInfo();o.specularTexture=e.createTextureInfoDef(c,f)}if(s.getSpecularColorTexture()){const c=s.getSpecularColorTexture(),f=s.getSpecularColorTextureInfo();o.specularColorTexture=e.createTextureInfoDef(c,f)}}}),this}}Io.EXTENSION_NAME=It;const{R:n1}=Xe;class _o extends ge{init(){this.extensionName=_t,this.propertyType="Transmission",this.parentTypes=[$.MATERIAL]}getDefaults(){return Object.assign(super.getDefaults(),{transmissionFactor:0,transmissionTexture:null,transmissionTextureInfo:new le(this.graph,"transmissionTextureInfo")})}getTransmissionFactor(){return this.get("transmissionFactor")}setTransmissionFactor(e){return this.set("transmissionFactor",e)}getTransmissionTexture(){return this.getRef("transmissionTexture")}getTransmissionTextureInfo(){return this.getRef("transmissionTexture")?this.getRef("transmissionTextureInfo"):null}setTransmissionTexture(e){return this.setRef("transmissionTexture",e,{channels:n1})}}_o.EXTENSION_NAME=_t;class wo extends he{constructor(...e){super(...e),this.extensionName=_t,this.prereadTypes=[$.MESH],this.prewriteTypes=[$.MESH]}createTransmission(){return new _o(this.document.getGraph())}read(e){return this}write(e){return this}preread(e){const r=e.jsonDoc,n=r.json.materials||[],s=r.json.textures||[];return n.forEach((i,a)=>{if(i.extensions&&i.extensions[_t]){const o=this.createTransmission();e.materials[a].setExtension(_t,o);const c=i.extensions[_t];if(c.transmissionFactor!==void 0&&o.setTransmissionFactor(c.transmissionFactor),c.transmissionTexture!==void 0){const f=c.transmissionTexture,h=e.textures[s[f.index].source];o.setTransmissionTexture(h),e.setTextureInfo(o.getTransmissionTextureInfo(),f)}}}),this}prewrite(e){const r=e.jsonDoc;return this.document.getRoot().listMaterials().forEach(n=>{const s=n.getExtension(_t);if(s){const i=e.materialIndexMap.get(n),a=r.json.materials[i];a.extensions=a.extensions||{};const o=a.extensions[_t]={transmissionFactor:s.getTransmissionFactor()};if(s.getTransmissionTexture()){const c=s.getTransmissionTexture(),f=s.getTransmissionTextureInfo();o.transmissionTexture=e.createTextureInfoDef(c,f)}}}),this}}wo.EXTENSION_NAME=_t;class Ao extends ge{init(){this.extensionName=Ct,this.propertyType="Unlit",this.parentTypes=[$.MATERIAL]}}Ao.EXTENSION_NAME=Ct;class gs extends he{constructor(...e){super(...e),this.extensionName=Ct,this.prereadTypes=[$.MESH],this.prewriteTypes=[$.MESH]}createUnlit(){return new Ao(this.document.getGraph())}read(e){return this}write(e){return this}preread(e){return(e.jsonDoc.json.materials||[]).forEach((n,s)=>{n.extensions&&n.extensions[Ct]&&e.materials[s].setExtension(Ct,this.createUnlit())}),this}prewrite(e){const r=e.jsonDoc;return this.document.getRoot().listMaterials().forEach(n=>{if(n.getExtension(Ct)){const s=e.materialIndexMap.get(n),i=r.json.materials[s];i.extensions=i.extensions||{},i.extensions[Ct]={}}}),this}}gs.EXTENSION_NAME=Ct;class bo extends ge{init(){this.extensionName=Oe,this.propertyType="Mapping",this.parentTypes=["MappingList"]}getDefaults(){return Object.assign(super.getDefaults(),{material:null,variants:new ue})}getMaterial(){return this.getRef("material")}setMaterial(e){return this.setRef("material",e)}addVariant(e){return this.addRef("variants",e)}removeVariant(e){return this.removeRef("variants",e)}listVariants(){return this.listRefs("variants")}}bo.EXTENSION_NAME=Oe;class So extends ge{init(){this.extensionName=Oe,this.propertyType="MappingList",this.parentTypes=[$.PRIMITIVE]}getDefaults(){return Object.assign(super.getDefaults(),{mappings:new ue})}addMapping(e){return this.addRef("mappings",e)}removeMapping(e){return this.removeRef("mappings",e)}listMappings(){return this.listRefs("mappings")}}So.EXTENSION_NAME=Oe;class Xn extends ge{init(){this.extensionName=Oe,this.propertyType="Variant",this.parentTypes=["MappingList"]}}Xn.EXTENSION_NAME=Oe;class No extends he{constructor(...e){super(...e),this.extensionName=Oe}createMappingList(){return new So(this.document.getGraph())}createVariant(e=""){return new Xn(this.document.getGraph(),e)}createMapping(){return new bo(this.document.getGraph())}listVariants(){return Array.from(this.properties).filter(e=>e instanceof Xn)}read(e){const r=e.jsonDoc;if(!r.json.extensions||!r.json.extensions[Oe])return this;const i=(r.json.extensions[Oe].variants||[]).map(o=>this.createVariant().setName(o.name||""));return(r.json.meshes||[]).forEach((o,c)=>{const f=e.meshes[c];(o.primitives||[]).forEach((d,p)=>{if(!d.extensions||!d.extensions[Oe])return;const g=this.createMappingList(),E=d.extensions[Oe];for(const M of E.mappings){const T=this.createMapping();M.material!==void 0&&T.setMaterial(e.materials[M.material]);for(const v of M.variants||[])T.addVariant(i[v]);g.addMapping(T)}f.listPrimitives()[p].setExtension(Oe,g)})}),this}write(e){const r=e.jsonDoc,n=this.listVariants();if(!n.length)return this;const s=[],i=new Map;for(const a of n)i.set(a,s.length),s.push(e.createPropertyDef(a));for(const a of this.document.getRoot().listMeshes()){const o=e.meshIndexMap.get(a);a.listPrimitives().forEach((c,f)=>{const h=c.getExtension(Oe);if(!h)return;const d=e.jsonDoc.json.meshes[o].primitives[f],p=h.listMappings().map(g=>{const E=e.createPropertyDef(g),M=g.getMaterial();return M&&(E.material=e.materialIndexMap.get(M)),E.variants=g.listVariants().map(T=>i.get(T)),E});d.extensions=d.extensions||{},d.extensions[Oe]={mappings:p}})}return r.json.extensions=r.json.extensions||{},r.json.extensions[Oe]={variants:s},this}}No.EXTENSION_NAME=Oe;const{G:s1}=Xe;class Co extends ge{init(){this.extensionName=wt,this.propertyType="Volume",this.parentTypes=[$.MATERIAL]}getDefaults(){return Object.assign(super.getDefaults(),{thicknessFactor:0,thicknessTexture:null,thicknessTextureInfo:new le(this.graph,"thicknessTexture"),attenuationDistance:1/0,attenuationColor:[1,1,1]})}getThicknessFactor(){return this.get("thicknessFactor")}setThicknessFactor(e){return this.set("thicknessFactor",e)}getThicknessTexture(){return this.getRef("thicknessTexture")}getThicknessTextureInfo(){return this.getRef("thicknessTexture")?this.getRef("thicknessTextureInfo"):null}setThicknessTexture(e){return this.setRef("thicknessTexture",e,{channels:s1})}getAttenuationDistance(){return this.get("attenuationDistance")}setAttenuationDistance(e){return this.set("attenuationDistance",e)}getAttenuationColor(){return this.get("attenuationColor")}setAttenuationColor(e){return this.set("attenuationColor",e)}}Co.EXTENSION_NAME=wt;class Oo extends he{constructor(...e){super(...e),this.extensionName=wt,this.prereadTypes=[$.MESH],this.prewriteTypes=[$.MESH]}createVolume(){return new Co(this.document.getGraph())}read(e){return this}write(e){return this}preread(e){const r=e.jsonDoc,n=r.json.materials||[],s=r.json.textures||[];return n.forEach((i,a)=>{if(i.extensions&&i.extensions[wt]){const o=this.createVolume();e.materials[a].setExtension(wt,o);const c=i.extensions[wt];if(c.thicknessFactor!==void 0&&o.setThicknessFactor(c.thicknessFactor),c.attenuationDistance!==void 0&&o.setAttenuationDistance(c.attenuationDistance),c.attenuationColor!==void 0&&o.setAttenuationColor(c.attenuationColor),c.thicknessTexture!==void 0){const f=c.thicknessTexture,h=e.textures[s[f.index].source];o.setThicknessTexture(h),e.setTextureInfo(o.getThicknessTextureInfo(),f)}}}),this}prewrite(e){const r=e.jsonDoc;return this.document.getRoot().listMaterials().forEach(n=>{const s=n.getExtension(wt);if(s){const i=e.materialIndexMap.get(n),a=r.json.materials[i];a.extensions=a.extensions||{};const o=a.extensions[wt]={};if(s.getThicknessFactor()>0&&(o.thicknessFactor=s.getThicknessFactor()),Number.isFinite(s.getAttenuationDistance())&&(o.attenuationDistance=s.getAttenuationDistance()),ce.eq(s.getAttenuationColor(),[1,1,1])||(o.attenuationColor=s.getAttenuationColor()),s.getThicknessTexture()){const c=s.getThicknessTexture(),f=s.getThicknessTextureInfo();o.thicknessTexture=e.createTextureInfoDef(c,f)}}}),this}}Oo.EXTENSION_NAME=wt;class Do extends he{constructor(...e){super(...e),this.extensionName=Xa}read(e){return this}write(e){return this}}Do.EXTENSION_NAME=Xa;class i1{match(e){return e[0]===171&&e[1]===75&&e[2]===84&&e[3]===88&&e[4]===32&&e[5]===50&&e[6]===48&&e[7]===187&&e[8]===13&&e[9]===10&&e[10]===26&&e[11]===10}getSize(e){const r=Dn(e);return[r.pixelWidth,r.pixelHeight]}getChannels(e){const n=Dn(e).dataFormatDescriptor[0];if(n.colorModel===u0)return n.samples.length===2&&(n.samples[1].channelType&15)===15?4:3;if(n.colorModel===h0)return(n.samples[0].channelType&15)===3?4:3;throw new Error(`Unexpected KTX2 colorModel, "${n.colorModel}".`)}getVRAMByteLength(e){const r=Dn(e),n=this.getChannels(e)>3;let s=0;for(let i=0;i<r.levels.length;i++){const a=r.levels[i];if(a.uncompressedByteLength)s+=a.uncompressedByteLength;else{const o=Math.max(1,Math.floor(r.pixelWidth/Math.pow(2,i))),c=Math.max(1,Math.floor(r.pixelHeight/Math.pow(2,i))),f=n?16:8;s+=o/4*(c/4)*f}}return s}}class Fo extends he{constructor(...e){super(...e),this.extensionName=Ar,this.prereadTypes=[$.TEXTURE]}static register(){ft.registerFormat("image/ktx2",new i1)}preread(e){return e.jsonDoc.json.textures.forEach(r=>{if(r.extensions&&r.extensions[Ar]){const n=r.extensions[Ar];r.source=n.source}}),this}read(e){return this}write(e){const r=e.jsonDoc;return this.document.getRoot().listTextures().forEach(n=>{if(n.getMimeType()==="image/ktx2"){const s=e.imageIndexMap.get(n);r.json.textures.forEach(i=>{i.source===s&&(i.extensions=i.extensions||{},i.extensions[Ar]={source:i.source},delete i.source)})}}),this}}Fo.EXTENSION_NAME=Ar;class $o extends ge{init(){this.extensionName=At,this.propertyType="Transform",this.parentTypes=[$.TEXTURE_INFO]}getDefaults(){return Object.assign(super.getDefaults(),{offset:[0,0],rotation:0,scale:[1,1],texCoord:null})}getOffset(){return this.get("offset")}setOffset(e){return this.set("offset",e)}getRotation(){return this.get("rotation")}setRotation(e){return this.set("rotation",e)}getScale(){return this.get("scale")}setScale(e){return this.set("scale",e)}getTexCoord(){return this.get("texCoord")}setTexCoord(e){return this.set("texCoord",e)}}$o.EXTENSION_NAME=At;class Po extends he{constructor(...e){super(...e),this.extensionName=At}createTransform(){return new $o(this.document.getGraph())}read(e){for(const[r,n]of Array.from(e.textureInfos.entries())){if(!n.extensions||!n.extensions[At])continue;const s=this.createTransform(),i=n.extensions[At];i.offset!==void 0&&s.setOffset(i.offset),i.rotation!==void 0&&s.setRotation(i.rotation),i.scale!==void 0&&s.setScale(i.scale),i.texCoord!==void 0&&s.setTexCoord(i.texCoord),r.setExtension(At,s)}return this}write(e){const r=Array.from(e.textureInfoDefMap.entries());for(const[n,s]of r){const i=n.getExtension(At);if(!i)continue;s.extensions=s.extensions||{};const a={},o=ce.eq;o(i.getOffset(),[0,0])||(a.offset=i.getOffset()),i.getRotation()!==0&&(a.rotation=i.getRotation()),o(i.getScale(),[1,1])||(a.scale=i.getScale()),i.getTexCoord()!=null&&(a.texCoord=i.getTexCoord()),s.extensions[At]=a}return this}}Po.EXTENSION_NAME=At;const a1=[$.ROOT,$.SCENE,$.NODE,$.MESH,$.MATERIAL,$.TEXTURE,$.ANIMATION];class Uo extends ge{init(){this.extensionName=He,this.propertyType="Packet",this.parentTypes=a1}getDefaults(){return Object.assign(super.getDefaults(),{context:{},properties:{}})}getContext(){return this.get("context")}setContext(e){return this.set("context",bt({},e))}listProperties(){return Object.keys(this.get("properties"))}getProperty(e){const r=this.get("properties");return e in r?r[e]:null}setProperty(e,r){this._assertContext(e);const n=bt({},this.get("properties"));return r?n[e]=r:delete n[e],this.set("properties",n)}toJSONLD(){const e=Fn(this.get("context")),r=Fn(this.get("properties"));return bt({"@context":e},r)}fromJSONLD(e){e=Fn(e);const r=e["@context"];return r&&this.set("context",r),delete e["@context"],this.set("properties",e)}_assertContext(e){if(!(e.split(":")[0]in this.get("context")))throw new Error(`${He}: Missing context for term, "${e}".`)}}Uo.EXTENSION_NAME=He;function Fn(t){return JSON.parse(JSON.stringify(t))}class Lo extends he{constructor(...e){super(...e),this.extensionName=He}createPacket(){return new Uo(this.document.getGraph())}listPackets(){return Array.from(this.properties)}read(e){var r;const n=(r=e.jsonDoc.json.extensions)==null?void 0:r[He];if(!n||!n.packets)return this;const s=e.jsonDoc.json,i=this.document.getRoot(),a=n.packets.map(f=>this.createPacket().fromJSONLD(f)),o=[[s.asset],s.scenes,s.nodes,s.meshes,s.materials,s.images,s.animations],c=[[i],i.listScenes(),i.listNodes(),i.listMeshes(),i.listMaterials(),i.listTextures(),i.listAnimations()];for(let f=0;f<o.length;f++){const h=o[f]||[];for(let d=0;d<h.length;d++){const p=h[d];if(p.extensions&&p.extensions[He]){const g=p.extensions[He];c[f][d].setExtension(He,a[g.packet])}}}return this}write(e){const{json:r}=e.jsonDoc,n=[];for(const s of this.properties){n.push(s.toJSONLD());for(const i of s.listParents()){let a;switch(i.propertyType){case $.ROOT:a=r.asset;break;case $.SCENE:a=r.scenes[e.sceneIndexMap.get(i)];break;case $.NODE:a=r.nodes[e.nodeIndexMap.get(i)];break;case $.MESH:a=r.meshes[e.meshIndexMap.get(i)];break;case $.MATERIAL:a=r.materials[e.materialIndexMap.get(i)];break;case $.TEXTURE:a=r.images[e.imageIndexMap.get(i)];break;case $.ANIMATION:a=r.animations[e.animationIndexMap.get(i)];break;default:a=null,this.document.getLogger().warn(`[${He}]: Unsupported parent property, "${i.propertyType}"`);break}a&&(a.extensions=a.extensions||{},a.extensions[He]={packet:n.length-1})}}return n.length>0&&(r.extensions=r.extensions||{},r.extensions[He]={packets:n}),this}}Lo.EXTENSION_NAME=He;const Bo=[ps,no,io,oo,fo,uo,po,mo,xo,yo,Io,Mo,wo,gs,No,Oo,Do,Fo,Po,Lo];[...Bo];const jo=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],Vo=t=>{let e="";for(let r=0;r<16;r++)r%4!=3&&(r>0&&(e+=" "),e+=t[r]||0);return e},o1=(t=1,e=jo)=>`    <item objectid="${t}" transform="${Vo(e)}" />
`,di=t=>t?t.toISOString().substring(0,10):"";function c1(t,{unit:e="millimeter",title:r="jscad model",author:n="",description:s="",application:i="jscad",creationDate:a=new Date,license:o="",modificationDate:c}={}){t.push(`<?xml version="1.0" encoding="UTF-8"?>
<model unit="${e}" xml:lang="en-US" xmlns="http://schemas.microsoft.com/3dmanufacturing/core/2015/02" xmlns:slic3rpe="http://schemas.slic3r.org/3mf/2017/06">
  <metadata name="slic3rpe:Version3mf">1</metadata>
  <metadata name="Title">${r}</metadata>
  <metadata name="Designer">${n}</metadata>
  <metadata name="Description">${s||r}</metadata>
  <metadata name="Copyright"></metadata>
  <metadata name="LicenseTerms">${o}</metadata>
  <metadata name="Rating"></metadata>
  <metadata name="CreationDate">${di(a)}</metadata>
  <metadata name="ModificationDate">${di(c||a)}</metadata>
  <metadata name="Application">${i}</metadata>
   `)}function f1(t,e,r,n){t.push(`<object id="${e}" type="model"${n==null?"":' name="'+n+'"'}>
`),t.push(` <components>
`),r.forEach(({objectID:s,transform:i})=>{l1(t,s,i)}),t.push(` </components>
`),t.push(`</object>
`)}const l1=(t,e=1,r=jo)=>{t.push(`    <component objectid="${e}" transform="${Vo(r)}" />
`)};function u1(t,e,r,n,s,i){t.push(`  <object id="${e}" type="model"${i?' name="'+i+'"':""}>
   <mesh>
    <vertices>
`);for(let a=0;a<r.length;a+=3)t.push(`     <vertex x="${r[a].toPrecision(s)}" y="${r[a+1].toPrecision(s)}" z="${r[a+2].toPrecision(s)}" />
`);t.push(`    </vertices>
    <triangles>
`);for(let a=0;a<n.length;a+=3)t.push(`     <triangle v1="${n[a]}" v2="${n[a+1]}" v3="${n[a+2]}" />
`);return t.push(`    </triangles>
   </mesh>
  </object>
`),t}const pi={name:"[Content_Types].xml",content:`<?xml version="1.0" encoding="UTF-8"?>
<Types xmlns="http://schemas.openxmlformats.org/package/2006/content-types">
<Default Extension="rels" ContentType="application/vnd.openxmlformats-package.relationships+xml" />
<Default Extension="model" ContentType="application/vnd.ms-package.3dmanufacturing-3dmodel+xml" />
<Default Extension="png" ContentType="image/png" />
</Types>`};function h1({meshes:t=[],components:e=[],items:r=[],precision:n=17,header:s}){const i=[];return c1(i,s),i.push(`  <resources>
`),r.length==0&&console.error("3MF empty build! Include items or simple."),t.forEach(({id:a,vertices:o,indices:c,name:f})=>u1(i,a,o,c,n,f)),e.forEach(({id:a,children:o,name:c})=>{f1(i,a,o,c)}),i.push(`  </resources>
`),i.push(`<build>
`),r.forEach(({objectID:a,transform:o})=>{i.push(o1(a,o))}),i.push(`</build>
`),i.push(`</model>
`),i.join("")}class d1{constructor(){this.idSeq=0,this.lines=['<?xml version="1.0" encoding="UTF-8"?>','<Relationships xmlns="http://schemas.openxmlformats.org/package/2006/relationships">']}get name(){return"_rels/.rels"}addRel(e,r){this.lines.push(`  <Relationship Target="${e}" Id="rel-${++this.idSeq}" Type="${r}" />`)}add3dModel(e){this.addRel(e,"http://schemas.microsoft.com/3dmanufacturing/2013/01/3dmodel")}addThumbnail(e){this.addRel(e,"http://schemas.openxmlformats.org/package/2006/relationships/metadata/thumbnail")}get content(){return this.lines.join(`
`)+`
</Relationships>`}}var De=Uint8Array,je=Uint16Array,ms=Int32Array,vs=new De([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),xs=new De([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),gi=new De([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),zo=function(t,e){for(var r=new je(31),n=0;n<31;++n)r[n]=e+=1<<t[n-1];for(var s=new ms(r[30]),n=1;n<30;++n)for(var i=r[n];i<r[n+1];++i)s[i]=i-r[n]<<5|n;return{b:r,r:s}},ko=zo(vs,2),p1=ko.b,Kn=ko.r;p1[28]=258,Kn[258]=28;var g1=zo(xs,0),mi=g1.r,Yn=new je(32768);for(var de=0;de<32768;++de){var Nt=(de&43690)>>1|(de&21845)<<1;Nt=(Nt&52428)>>2|(Nt&13107)<<2,Nt=(Nt&61680)>>4|(Nt&3855)<<4,Yn[de]=((Nt&65280)>>8|(Nt&255)<<8)>>1}var Nr=(function(t,e,r){for(var n=t.length,s=0,i=new je(e);s<n;++s)t[s]&&++i[t[s]-1];var a=new je(e);for(s=1;s<e;++s)a[s]=a[s-1]+i[s-1]<<1;var o;if(r){o=new je(1<<e);var c=15-e;for(s=0;s<n;++s)if(t[s])for(var f=s<<4|t[s],h=e-t[s],d=a[t[s]-1]++<<h,p=d|(1<<h)-1;d<=p;++d)o[Yn[d]>>c]=f}else for(o=new je(n),s=0;s<n;++s)t[s]&&(o[s]=Yn[a[t[s]-1]++]>>15-t[s]);return o}),Wt=new De(288);for(var de=0;de<144;++de)Wt[de]=8;for(var de=144;de<256;++de)Wt[de]=9;for(var de=256;de<280;++de)Wt[de]=7;for(var de=280;de<288;++de)Wt[de]=8;var on=new De(32);for(var de=0;de<32;++de)on[de]=5;var m1=Nr(Wt,9,0),v1=Nr(on,5,0),Go=function(t){return(t+7)/8|0},Ho=function(t,e,r){return(r==null||r>t.length)&&(r=t.length),new De(t.subarray(e,r))},x1=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],gn=function(t,e,r){var n=new Error(e||x1[t]);if(n.code=t,Error.captureStackTrace&&Error.captureStackTrace(n,gn),!r)throw n;return n},dt=function(t,e,r){r<<=e&7;var n=e/8|0;t[n]|=r,t[n+1]|=r>>8},Mr=function(t,e,r){r<<=e&7;var n=e/8|0;t[n]|=r,t[n+1]|=r>>8,t[n+2]|=r>>16},$n=function(t,e){for(var r=[],n=0;n<t.length;++n)t[n]&&r.push({s:n,f:t[n]});var s=r.length,i=r.slice();if(!s)return{t:Wo,l:0};if(s==1){var a=new De(r[0].s+1);return a[r[0].s]=1,{t:a,l:1}}r.sort(function(A,S){return A.f-S.f}),r.push({s:-1,f:25001});var o=r[0],c=r[1],f=0,h=1,d=2;for(r[0]={s:-1,f:o.f+c.f,l:o,r:c};h!=s-1;)o=r[r[f].f<r[d].f?f++:d++],c=r[f!=h&&r[f].f<r[d].f?f++:d++],r[h++]={s:-1,f:o.f+c.f,l:o,r:c};for(var p=i[0].s,n=1;n<s;++n)i[n].s>p&&(p=i[n].s);var g=new je(p+1),E=Jn(r[h-1],g,0);if(E>e){var n=0,M=0,T=E-e,v=1<<T;for(i.sort(function(S,x){return g[x.s]-g[S.s]||S.f-x.f});n<s;++n){var D=i[n].s;if(g[D]>e)M+=v-(1<<E-g[D]),g[D]=e;else break}for(M>>=T;M>0;){var R=i[n].s;g[R]<e?M-=1<<e-g[R]++-1:++n}for(;n>=0&&M;--n){var w=i[n].s;g[w]==e&&(--g[w],++M)}E=e}return{t:new De(g),l:E}},Jn=function(t,e,r){return t.s==-1?Math.max(Jn(t.l,e,r+1),Jn(t.r,e,r+1)):e[t.s]=r},vi=function(t){for(var e=t.length;e&&!t[--e];);for(var r=new je(++e),n=0,s=t[0],i=1,a=function(c){r[n++]=c},o=1;o<=e;++o)if(t[o]==s&&o!=e)++i;else{if(!s&&i>2){for(;i>138;i-=138)a(32754);i>2&&(a(i>10?i-11<<5|28690:i-3<<5|12305),i=0)}else if(i>3){for(a(s),--i;i>6;i-=6)a(8304);i>2&&(a(i-3<<5|8208),i=0)}for(;i--;)a(s);i=1,s=t[o]}return{c:r.subarray(0,n),n:e}},Rr=function(t,e){for(var r=0,n=0;n<e.length;++n)r+=t[n]*e[n];return r},qo=function(t,e,r){var n=r.length,s=Go(e+2);t[s]=n&255,t[s+1]=n>>8,t[s+2]=t[s]^255,t[s+3]=t[s+1]^255;for(var i=0;i<n;++i)t[s+i+4]=r[i];return(s+4+n)*8},xi=function(t,e,r,n,s,i,a,o,c,f,h){dt(e,h++,r),++s[256];for(var d=$n(s,15),p=d.t,g=d.l,E=$n(i,15),M=E.t,T=E.l,v=vi(p),D=v.c,R=v.n,w=vi(M),A=w.c,S=w.n,x=new je(19),I=0;I<D.length;++I)++x[D[I]&31];for(var I=0;I<A.length;++I)++x[A[I]&31];for(var b=$n(x,7),N=b.t,B=b.l,U=19;U>4&&!N[gi[U-1]];--U);var V=f+5<<3,z=Rr(s,Wt)+Rr(i,on)+a,X=Rr(s,p)+Rr(i,M)+a+14+3*U+Rr(x,N)+2*x[16]+3*x[17]+7*x[18];if(c>=0&&V<=z&&V<=X)return qo(e,h,t.subarray(c,c+f));var Y,J,re,ae;if(dt(e,h,1+(X<z)),h+=2,X<z){Y=Nr(p,g,0),J=p,re=Nr(M,T,0),ae=M;var lt=Nr(N,B,0);dt(e,h,R-257),dt(e,h+5,S-1),dt(e,h+10,U-4),h+=14;for(var I=0;I<U;++I)dt(e,h+3*I,N[gi[I]]);h+=3*U;for(var Me=[D,A],Ue=0;Ue<2;++Ue)for(var Le=Me[Ue],I=0;I<Le.length;++I){var xe=Le[I]&31;dt(e,h,lt[xe]),h+=N[xe],xe>15&&(dt(e,h,Le[I]>>5&127),h+=Le[I]>>12)}}else Y=m1,J=Wt,re=v1,ae=on;for(var I=0;I<o;++I){var oe=n[I];if(oe>255){var xe=oe>>18&31;Mr(e,h,Y[xe+257]),h+=J[xe+257],xe>7&&(dt(e,h,oe>>23&31),h+=vs[xe]);var we=oe&31;Mr(e,h,re[we]),h+=ae[we],we>3&&(Mr(e,h,oe>>5&8191),h+=xs[we])}else Mr(e,h,Y[oe]),h+=J[oe]}return Mr(e,h,Y[256]),h+J[256]},T1=new ms([65540,131080,131088,131104,262176,1048704,1048832,2114560,2117632]),Wo=new De(0),y1=function(t,e,r,n,s,i){var a=i.z||t.length,o=new De(n+a+5*(1+Math.ceil(a/7e3))+s),c=o.subarray(n,o.length-s),f=i.l,h=(i.r||0)&7;if(e){h&&(c[0]=i.r>>3);for(var d=T1[e-1],p=d>>13,g=d&8191,E=(1<<r)-1,M=i.p||new je(32768),T=i.h||new je(E+1),v=Math.ceil(r/3),D=2*v,R=function(Ke){return(t[Ke]^t[Ke+1]<<v^t[Ke+2]<<D)&E},w=new ms(25e3),A=new je(288),S=new je(32),x=0,I=0,b=i.i||0,N=0,B=i.w||0,U=0;b+2<a;++b){var V=R(b),z=b&32767,X=T[V];if(M[z]=X,T[V]=z,B<=b){var Y=a-b;if((x>7e3||N>24576)&&(Y>423||!f)){h=xi(t,c,0,w,A,S,I,N,U,b-U,h),N=x=I=0,U=b;for(var J=0;J<286;++J)A[J]=0;for(var J=0;J<30;++J)S[J]=0}var re=2,ae=0,lt=g,Me=z-X&32767;if(Y>2&&V==R(b-Me))for(var Ue=Math.min(p,Y)-1,Le=Math.min(32767,b),xe=Math.min(258,Y);Me<=Le&&--lt&&z!=X;){if(t[b+re]==t[b+re-Me]){for(var oe=0;oe<xe&&t[b+oe]==t[b+oe-Me];++oe);if(oe>re){if(re=oe,ae=Me,oe>Ue)break;for(var we=Math.min(Me,oe-2),Jt=0,J=0;J<we;++J){var Pt=b-Me+J&32767,st=M[Pt],Re=Pt-st&32767;Re>Jt&&(Jt=Re,X=Pt)}}}z=X,X=M[z],Me+=z-X&32767}if(ae){w[N++]=268435456|Kn[re]<<18|mi[ae];var Ie=Kn[re]&31,ze=mi[ae]&31;I+=vs[Ie]+xs[ze],++A[257+Ie],++S[ze],B=b+re,++x}else w[N++]=t[b],++A[t[b]]}}for(b=Math.max(b,B);b<a;++b)w[N++]=t[b],++A[t[b]];h=xi(t,c,f,w,A,S,I,N,U,b-U,h),f||(i.r=h&7|c[h/8|0]<<3,h-=7,i.h=T,i.p=M,i.i=b,i.w=B)}else{for(var b=i.w||0;b<a+f;b+=65535){var Ut=b+65535;Ut>=a&&(c[h/8|0]=f,Ut=a),h=qo(c,h+1,t.subarray(b,Ut))}i.i=a}return Ho(o,0,n+Go(h)+s)},E1=(function(){for(var t=new Int32Array(256),e=0;e<256;++e){for(var r=e,n=9;--n;)r=(r&1&&-306674912)^r>>>1;t[e]=r}return t})(),M1=function(){var t=-1;return{p:function(e){for(var r=t,n=0;n<e.length;++n)r=E1[r&255^e[n]]^r>>>8;t=r},d:function(){return~t}}},R1=function(t,e,r,n,s){if(!s&&(s={l:1},e.dictionary)){var i=e.dictionary.subarray(-32768),a=new De(i.length+t.length);a.set(i),a.set(t,i.length),t=a,s.w=i.length}return y1(t,e.level==null?6:e.level,e.mem==null?s.l?Math.ceil(Math.max(8,Math.min(13,Math.log(t.length)))*1.5):20:12+e.mem,r,n,s)},Xo=function(t,e){var r={};for(var n in t)r[n]=t[n];for(var n in e)r[n]=e[n];return r},Ce=function(t,e,r){for(;r;++e)t[e]=r,r>>>=8};function I1(t,e){return R1(t,e||{},0,0)}var Ko=function(t,e,r,n){for(var s in t){var i=t[s],a=e+s,o=n;Array.isArray(i)&&(o=Xo(n,i[1]),i=i[0]),i instanceof De?r[a]=[i,o]:(r[a+="/"]=[new De(0),o],Ko(i,a,r,n))}},Ti=typeof TextEncoder<"u"&&new TextEncoder,_1=typeof TextDecoder<"u"&&new TextDecoder,w1=0;try{_1.decode(Wo,{stream:!0}),w1=1}catch{}function Cr(t,e){var r;if(Ti)return Ti.encode(t);for(var n=t.length,s=new De(t.length+(t.length>>1)),i=0,a=function(f){s[i++]=f},r=0;r<n;++r){if(i+5>s.length){var o=new De(i+8+(n-r<<1));o.set(s),s=o}var c=t.charCodeAt(r);c<128||e?a(c):c<2048?(a(192|c>>6),a(128|c&63)):c>55295&&c<57344?(c=65536+(c&1047552)|t.charCodeAt(++r)&1023,a(240|c>>18),a(128|c>>12&63),a(128|c>>6&63),a(128|c&63)):(a(224|c>>12),a(128|c>>6&63),a(128|c&63))}return Ho(s,0,i)}var Zn=function(t){var e=0;if(t)for(var r in t){var n=t[r].length;n>65535&&gn(9),e+=n+4}return e},yi=function(t,e,r,n,s,i,a,o){var c=n.length,f=r.extra,h=o&&o.length,d=Zn(f);Ce(t,e,a!=null?33639248:67324752),e+=4,a!=null&&(t[e++]=20,t[e++]=r.os),t[e]=20,e+=2,t[e++]=r.flag<<1|(i<0&&8),t[e++]=s&&8,t[e++]=r.compression&255,t[e++]=r.compression>>8;var p=new Date(r.mtime==null?Date.now():r.mtime),g=p.getFullYear()-1980;if((g<0||g>119)&&gn(10),Ce(t,e,g<<25|p.getMonth()+1<<21|p.getDate()<<16|p.getHours()<<11|p.getMinutes()<<5|p.getSeconds()>>1),e+=4,i!=-1&&(Ce(t,e,r.crc),Ce(t,e+4,i<0?-i-2:i),Ce(t,e+8,r.size)),Ce(t,e+12,c),Ce(t,e+14,d),e+=16,a!=null&&(Ce(t,e,h),Ce(t,e+6,r.attrs),Ce(t,e+10,a),e+=14),t.set(n,e),e+=c,d)for(var E in f){var M=f[E],T=M.length;Ce(t,e,+E),Ce(t,e+2,T),t.set(M,e+4),e+=4+T}return h&&(t.set(o,e),e+=h),e},A1=function(t,e,r,n,s){Ce(t,e,101010256),Ce(t,e+8,r),Ce(t,e+10,r),Ce(t,e+12,n),Ce(t,e+16,s)};function b1(t,e){e||(e={});var r={},n=[];Ko(t,"",r,e);var s=0,i=0;for(var a in r){var o=r[a],c=o[0],f=o[1],h=f.level==0?0:8,d=Cr(a),p=d.length,g=f.comment,E=g&&Cr(g),M=E&&E.length,T=Zn(f.extra);p>65535&&gn(11);var v=h?I1(c,f):c,D=v.length,R=M1();R.p(c),n.push(Xo(f,{size:c.length,crc:R.d(),c:v,f:d,m:E,u:p!=a.length||E&&g.length!=M,o:s,compression:h})),s+=30+p+T+D,i+=76+2*(p+T)+(M||0)+D}for(var w=new De(i+22),A=s,S=i-s,x=0;x<n.length;++x){var d=n[x];yi(w,d.o,d,d.f,d.u,d.c.length);var I=30+d.f.length+Zn(d.extra);w.set(d.c,d.o+I),yi(w,s,d,d.f,d.u,d.c.length,d.o,d.m),s+=16+I+(d.m?d.m.length:0)}return A1(w,s,n.length,S,A),w}var S1=1e-6,St=typeof Float32Array<"u"?Float32Array:Array;function N1(){var t=new St(9);return St!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[5]=0,t[6]=0,t[7]=0),t[0]=1,t[4]=1,t[8]=1,t}function Yo(){var t=new St(3);return St!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t}function C1(t){var e=t[0],r=t[1],n=t[2];return Math.sqrt(e*e+r*r+n*n)}function Ei(t,e,r){var n=new St(3);return n[0]=t,n[1]=e,n[2]=r,n}function O1(t,e){var r=e[0],n=e[1],s=e[2],i=r*r+n*n+s*s;return i>0&&(i=1/Math.sqrt(i)),t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t}function D1(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}function Pn(t,e,r){var n=e[0],s=e[1],i=e[2],a=r[0],o=r[1],c=r[2];return t[0]=s*c-i*o,t[1]=i*a-n*c,t[2]=n*o-s*a,t}var F1=C1;(function(){var t=Yo();return function(e,r,n,s,i,a){var o,c;for(r||(r=3),n||(n=0),s?c=Math.min(s*r+n,e.length):c=e.length,o=n;o<c;o+=r)t[0]=e[o],t[1]=e[o+1],t[2]=e[o+2],i(t,t,a),e[o]=t[0],e[o+1]=t[1],e[o+2]=t[2];return e}})();function $1(){var t=new St(4);return St!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0,t[3]=0),t}function P1(t,e){var r=e[0],n=e[1],s=e[2],i=e[3],a=r*r+n*n+s*s+i*i;return a>0&&(a=1/Math.sqrt(a)),t[0]=r*a,t[1]=n*a,t[2]=s*a,t[3]=i*a,t}(function(){var t=$1();return function(e,r,n,s,i,a){var o,c;for(r||(r=4),n||(n=0),s?c=Math.min(s*r+n,e.length):c=e.length,o=n;o<c;o+=r)t[0]=e[o],t[1]=e[o+1],t[2]=e[o+2],t[3]=e[o+3],i(t,t,a),e[o]=t[0],e[o+1]=t[1],e[o+2]=t[2],e[o+3]=t[3];return e}})();function Qn(){var t=new St(4);return St!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t[3]=1,t}function U1(t,e,r){r=r*.5;var n=Math.sin(r);return t[0]=n*e[0],t[1]=n*e[1],t[2]=n*e[2],t[3]=Math.cos(r),t}function L1(t,e,r){r*=.5;var n=e[0],s=e[1],i=e[2],a=e[3],o=Math.sin(r),c=Math.cos(r);return t[0]=n*c+a*o,t[1]=s*c+i*o,t[2]=i*c-s*o,t[3]=a*c-n*o,t}function B1(t,e,r){r*=.5;var n=e[0],s=e[1],i=e[2],a=e[3],o=Math.sin(r),c=Math.cos(r);return t[0]=n*c-i*o,t[1]=s*c+a*o,t[2]=i*c+n*o,t[3]=a*c-s*o,t}function j1(t,e,r){r*=.5;var n=e[0],s=e[1],i=e[2],a=e[3],o=Math.sin(r),c=Math.cos(r);return t[0]=n*c+s*o,t[1]=s*c-n*o,t[2]=i*c+a*o,t[3]=a*c-i*o,t}function Un(t,e,r,n){var s=e[0],i=e[1],a=e[2],o=e[3],c=r[0],f=r[1],h=r[2],d=r[3],p,g,E,M,T;return g=s*c+i*f+a*h+o*d,g<0&&(g=-g,c=-c,f=-f,h=-h,d=-d),1-g>S1?(p=Math.acos(g),E=Math.sin(p),M=Math.sin((1-n)*p)/E,T=Math.sin(n*p)/E):(M=1-n,T=n),t[0]=M*s+T*c,t[1]=M*i+T*f,t[2]=M*a+T*h,t[3]=M*o+T*d,t}function V1(t,e){var r=e[0]+e[4]+e[8],n;if(r>0)n=Math.sqrt(r+1),t[3]=.5*n,n=.5/n,t[0]=(e[5]-e[7])*n,t[1]=(e[6]-e[2])*n,t[2]=(e[1]-e[3])*n;else{var s=0;e[4]>e[0]&&(s=1),e[8]>e[s*3+s]&&(s=2);var i=(s+1)%3,a=(s+2)%3;n=Math.sqrt(e[s*3+s]-e[i*3+i]-e[a*3+a]+1),t[s]=.5*n,n=.5/n,t[3]=(e[i*3+a]-e[a*3+i])*n,t[i]=(e[i*3+s]+e[s*3+i])*n,t[a]=(e[a*3+s]+e[s*3+a])*n}return t}var Jo=P1;(function(){var t=Yo(),e=Ei(1,0,0),r=Ei(0,1,0);return function(n,s,i){var a=D1(s,i);return a<-.999999?(Pn(t,e,s),F1(t)<1e-6&&Pn(t,r,s),O1(t,t),U1(n,t,Math.PI),n):a>.999999?(n[0]=0,n[1]=0,n[2]=0,n[3]=1,n):(Pn(t,s,i),n[0]=t[0],n[1]=t[1],n[2]=t[2],n[3]=1+a,Jo(n,n))}})();(function(){var t=Qn(),e=Qn();return function(r,n,s,i,a,o){return Un(t,n,a,o),Un(e,s,i,o),Un(r,t,e,2*o*(1-o)),r}})();(function(){var t=N1();return function(e,r,n,s){return t[0]=n[0],t[3]=n[1],t[6]=n[2],t[1]=s[0],t[4]=s[1],t[7]=s[2],t[2]=-r[0],t[5]=-r[1],t[8]=-r[2],Jo(e,V1(e,t))}})();const ot="EXT_mesh_manifold",Mi="MERGE";class Ts extends ge{static EXTENSION_NAME=ot;init(){Ts.EXTENSION_NAME=ot,this.propertyType="ManifoldPrimitive",this.parentTypes=[$.MESH]}getDefaults(){return Object.assign(super.getDefaults(),{manifoldPrimitive:null,mergeIndices:null,mergeValues:null})}getMergeIndices(){return this.getRef("mergeIndices")}getMergeValues(){return this.getRef("mergeValues")}setMerge(e,r){if(e.getCount()!==r.getCount())throw new Error("merge vectors must be the same length.");return this.setRef("mergeIndices",e),this.setRef("mergeValues",r)}getRunIndex(){return this.get("runIndex")}setRunIndex(e){return this.set("runIndex",e)}setIndices(e){return this.setRef("indices",e)}getIndices(){return this.getRef("indices")}}class Zo extends he{extensionName=ot;prewriteTypes=[$.ACCESSOR];static EXTENSION_NAME=ot;createManifoldPrimitive(){return new Ts(this.document.getGraph())}read(e){const{json:r}=e.jsonDoc;return(r.meshes||[]).forEach((s,i)=>{if(!s.extensions||!s.extensions[ot])return;const a=e.meshes[i],o=this.createManifoldPrimitive();a.setExtension(ot,o);const c=s.extensions[ot];if(c.manifoldPrimitive){let f=0;const h=Array();h.push(f);for(const d of a.listPrimitives()){const p=d.getIndices();if(!p){console.log("Skipping non-indexed primitive ",d.getName());continue}f+=p.getCount(),h.push(f)}o.setRunIndex(h),o.setIndices(e.accessors[c.manifoldPrimitive.indices])}c.mergeIndices!=null&&c.mergeValues!=null&&o.setMerge(e.accessors[c.mergeIndices],e.accessors[c.mergeValues])}),this}prewrite(e){return this.document.getRoot().listMeshes().forEach(r=>{const n=r.getExtension(ot);if(!n)return;const s=n.getIndices();e.addAccessorToUsageGroup(s,nt.BufferViewUsage.ELEMENT_ARRAY_BUFFER);const i=n.getMergeIndices(),a=n.getMergeValues();!i||!a||(e.addAccessorToUsageGroup(i,Mi),e.addAccessorToUsageGroup(a,Mi))}),this}write(e){const{json:r}=e.jsonDoc;return this.document.getRoot().listMeshes().forEach(n=>{const s=n.getExtension(ot);if(!s)return;const i=e.meshIndexMap.get(n),a=r.meshes[i],o=s.getRunIndex(),c=o.length-1;if(c!==a.primitives.length)throw new Error("The number of primitives must be exactly one less than the length of runIndex.");const f=e.accessorIndexMap.get(s.getMergeIndices()),h=e.accessorIndexMap.get(s.getMergeValues()),d=r.accessors[f],p=r.accessors[h],g=a.primitives[0],E={indices:e.accessorIndexMap.get(s.getIndices()),mode:g.mode,attributes:{POSITION:g.attributes.POSITION}},M=r.accessors[E.indices];if(M){d&&p&&(M.sparse={count:d.count,indices:{bufferView:d.bufferView,byteOffset:d.byteOffset,componentType:d.componentType},values:{bufferView:p.bufferView,byteOffset:p.byteOffset}});for(let T=0;T<c;++T){const v=r.accessors[a.primitives[T].indices];v.bufferView=M.bufferView,v.byteOffset=M.byteOffset+4*o[T],v.count=o[T+1]-o[T]}a.extensions=a.extensions||{},a.extensions[ot]={manifoldPrimitive:E,mergeIndices:f,mergeValues:h}}}),this}}const Ir={POSITION:{type:q.Type.VEC3,components:3},NORMAL:{type:q.Type.VEC3,components:3},TANGENT:{type:q.Type.VEC4,components:4},TEXCOORD_0:{type:q.Type.VEC2,components:2},TEXCOORD_1:{type:q.Type.VEC2,components:2},COLOR_0:{type:q.Type.VEC3,components:3},JOINTS_0:{type:q.Type.VEC4,components:4},WEIGHTS_0:{type:q.Type.VEC4,components:4},SKIP_1:{type:null,components:1},SKIP_2:{type:null,components:2},SKIP_3:{type:null,components:3},SKIP_4:{type:null,components:4}};function z1(t){return t.registerExtensions([Zo])}function Ri(t,e,r){t.getRoot().listBuffers().length===0&&t.createBuffer();const n=t.getRoot().listBuffers()[0],s=t.createExtension(Zo),i=t.createMesh(),a=Array(),o=Array(),c=new Map,f=e.runIndex.length-1;let h=-1;for(let R=0;R<f;++R){const w=e.runOriginalID[R];if(w==h)continue;h=w,a.push(e.runIndex[R]);const A=t.createAccessor("primitive indices of ID "+w).setBuffer(n).setType(q.Type.SCALAR).setArray(new Uint32Array(1)),S=t.createPrimitive().setIndices(A),x=r.get(w);if(x){const{material:I,attributes:b}=x;if(b.length<1||b[0]!=="POSITION")throw new Error('First attribute must be "POSITION".');S.setMaterial(I),c.set(S,b),x.attributes.forEach((N,B)=>{if(B>=o.length)o.push(N);else{const U=Ir[N].components,V=Ir[o[B]].components;if(U!=V)throw new Error("Attribute sizes do not correspond: "+N+" and "+o[B]);Ir[o[B]].type==null&&(o[B]=N)}})}else c.set(S,["POSITION"]);i.addPrimitive(S)}a.push(e.runIndex[f]);const d=e.numVert,p=e.numProp;let g=0;o.forEach((R,w)=>{const A=Ir[R];if(A==null)throw new Error(R+" is not a recognized attribute.");if(A.type==null){++g;return}const S=A.components;if(g+S>p)throw new Error("Too many attribute channels.");const x=new Float32Array(S*d);for(let b=0;b<d;++b)for(let N=0;N<S;++N){let B=e.vertProperties[p*b+g+N];R=="COLOR_0"&&(B=Math.max(0,Math.min(1,B))),x[S*b+N]=B}const I=t.createAccessor(R).setBuffer(n).setType(A.type).setArray(x);for(const b of i.listPrimitives()){const N=c.get(b);N.length>w&&Ir[N[w]].type!=null&&b.setAttribute(R,I)}g+=S});const E=s.createManifoldPrimitive();i.setExtension("EXT_mesh_manifold",E);const M=t.createAccessor("manifold indices").setBuffer(n).setType(q.Type.SCALAR).setArray(e.triVerts);E.setIndices(M),E.setRunIndex(a);const T=[...Array(e.numVert).keys()],v=Array(),D=Array();if(e.mergeFromVert&&e.mergeToVert){for(const[R,w]of e.mergeFromVert.entries())T[w]=e.mergeToVert[R];for(const[R,w]of e.triVerts.entries()){const A=T[w];w!==A&&(v.push(R),D.push(A))}}if(v.length>0){const R=t.createAccessor("merge from").setBuffer(n).setType(q.Type.SCALAR).setArray(new Uint32Array(v)),w=t.createAccessor("merge to").setBuffer(n).setType(q.Type.SCALAR).setArray(new Uint32Array(D));E.setMerge(R,w)}return i}let Qo=!1;const es=new Map,ec=new Map,k1=30,tc={roughness:.2,metallic:1,baseColorFactor:[1,1,0],alpha:1,unlit:!1,animationLength:1,animationMode:"loop"},G1={baseColorFactor:[1,0,0],alpha:.25,roughness:1,metallic:0},H1={baseColorFactor:[.5,.5,.5],alpha:.25,roughness:1,metallic:0},zt={...tc},rc=z1(new i0);rc.registerExtensions(Bo);const Gt=new Array,cn=new Map,en=new Map,Ht=new Map,Xt=new Map;let Pr=1,cr,Or,Ln,tn,fn;function nc(){Gt.length=0,cn.clear(),en.clear(),Ht.clear(),Xt.clear(),Pr=1}class sc{_parent;manifold;translation;rotation;scale;material;name;constructor(e){this._parent=e,Gt.push(this)}clone(e){const r={...this};return r._parent=e,Gt.push(r),r}get parent(){return this._parent}}function ar(...t){typeof self<"u"&&self.console&&self.console.log(...t)}const q1=(t,e)=>{const r=t.asOriginal();return cn.set(r.originalID(),e),r},ic=(t,e)=>{const r=Xt.get(t);r!=null?r.start=e:Xt.set(t,{start:e})},ac=(t,e)=>{const r=Xt.get(t);r!=null?r.end=e:Xt.set(t,{end:e})},ys=(t,e)=>{let r=t.asOriginal();return e.set(r.originalID(),r.getMesh()),r},W1=t=>ys(t,es),X1=t=>(Qo=!0,ys(t,ec));function oc(t){const e=Math.PI/180,r=Qn();return j1(r,r,e*t[2]),B1(r,r,e*t[1]),L1(r,r,e*t[0]),r}function Bn(t,e,r,n){const s=r[e];if(s==null)return null;if(typeof s!="function")return s;const i=Or.getCount(),a=e=="rotation"?4:3,o=new Float32Array(a*i);for(let d=0;d<i;++d){const p=d/(i-1),g=s(zt.animationMode!=="ping-pong"?p:(1-Math.cos(p*2*Math.PI))/2);o.set(a===4?oc(g):g,a*d)}const c=t.createAccessor(r.name+" "+e+" frames").setBuffer(t.getRoot().listBuffers()[0]).setArray(o).setType(a===4?q.Type.VEC4:q.Type.VEC3),f=t.createAnimationSampler().setInput(Or).setOutput(c).setInterpolation("LINEAR"),h=t.createAnimationChannel().setTargetPath(e).setTargetNode(n).setSampler(f);return cr.addSampler(f),cr.addChannel(h),fn=!0,s(0)}function K1(t,e,r){if(Xt.has(r)){const n=t.createAnimationChannel().setTargetPath("weights").setTargetNode(e).setSampler(tn);cr.addChannel(n),fn=!0}}function Y1(t,e){const r=[];if(e==null)return r;for(let n=0;n<t.numVert;++n)for(let s=0;s<3;++s)r[n*3+s]=t.vertProperties[n*t.numProp+s];if(e.start)for(let n=0;n<t.numVert;++n){const s=t.vertProperties,i=n*t.numProp,a=r.slice(i,i+3);e.start(a);for(let o=0;o<3;++o)s[i+o]=a[o]}return r}function J1(t,e,r,n,s){s!=null&&(r.setWeights([0]),r.listPrimitives().forEach((i,a)=>{if(s.end)for(let p=0;p<e.numVert;++p){const g=n.slice(3*p,3*(p+1));s.end(g),n.splice(3*p,3,...g)}const o=i.getAttribute("POSITION").getArray(),c=new Float32Array(o.length),f=e.runIndex[a];for(let p=0;p<c.length;++p)c[p]=n[f+p]-o[p];const h=t.createAccessor(r.getName()+" morph target").setBuffer(t.getRoot().listBuffers()[0]).setArray(c).setType(q.Type.VEC3),d=t.createPrimitiveTarget().setAttribute("POSITION",h);i.addTarget(d)}))}function Z1(t,e){const r=t.createNode(e.name),n=Bn(t,"translation",e,r);n!=null&&r.setTranslation(n);const s=Bn(t,"rotation",e,r);s!=null&&r.setRotation(oc(s));const i=Bn(t,"scale",e,r);return i!=null&&r.setScale(i),r}function cc(t){return t==null?{}:(t.material==null&&(t.material=cc(t.parent)),t.material)}function Q1(t,e={}){const r={...zt};Object.assign(r,e);const{roughness:n,metallic:s,baseColorFactor:i,alpha:a,unlit:o}=r,c=t.createMaterial(e.name??"");if(o){const f=t.createExtension(gs).createUnlit();c.setExtension("KHR_materials_unlit",f)}return a<1&&c.setAlphaMode($t.AlphaMode.BLEND).setDoubleSided(!0),c.setRoughnessFactor(n).setMetallicFactor(s).setBaseColorFactor([...i,a])}function ln(t,e){return en.has(e)||en.set(e,Q1(t,e)),en.get(e)}function fc(t,e,r,n,s={}){const i=n.numTri();if(i==0){ar("Empty manifold, skipping.");return}ar(`Triangles: ${i.toLocaleString()}`);const a=n.boundingBox(),o=[0,0,0];for(let M=0;M<3;M++)o[M]=Math.round((a.max[M]-a.min[M])*10)/10;ar(`Bounding Box: X = ${o[0].toLocaleString()} mm, Y = ${o[1].toLocaleString()} mm, Z = ${o[2].toLocaleString()} mm`);const c=Math.round(n.volume()/10);ar(`Genus: ${n.genus().toLocaleString()}, Volume: ${(c/100).toLocaleString()} cm^3`);const f=n.getMesh(),h=new Map;for(const M of f.runOriginalID){const T=cn.get(M)||s;h.set(M,{material:ln(t,Qo?H1:T),attributes:["POSITION",...T.attributes??[]]})}const d=Xt.get(n),p=Y1(f,d),g=Ri(t,f,h);g.setName(r.getName()),r.setMesh(g),J1(t,f,g,p,d);const E=f.numProp===3?f.vertProperties:new Float32Array(f.numVert*3);if(f.numProp>3)for(let M=0;M<f.numVert;++M)for(let T=0;T<3;++T)E[M*3+T]=f.vertProperties[M*f.numProp+T];Ht.set(n,Pr),e.meshes.push({vertices:E,indices:f.triVerts,id:`${Pr++}`});for(const[M,T]of f.runOriginalID.entries()){const v=es.has(T),D=v?es.get(T):ec.get(T);if(D==null)continue;h.get(T).material=ln(t,v?G1:cn.get(T)||s);const R=t.createNode("debug").setMesh(Ri(t,D,h)).setMatrix(f.transform(M));r.addChild(R)}}function lc(t,e){t.setMesh(e.getMesh()),e.listChildren().forEach(r=>{const n=r.clone();t.addChild(n)})}function em(t,e,r,n,s){lc(e,r);const i=t.createMesh();e.setMesh(i),r.getMesh().listPrimitives().forEach(a=>{const o=a.clone();a.getMaterial()===s&&o.setMaterial(n),i.addPrimitive(o)})}function tm(t,e,r,n){const s=Z1(t,r),{manifold:i}=r;if(i!=null){K1(t,s,i);const a=cc(r),o=n.get(i);if(o==null){fc(t,e,s,i,a);const c=new Map;c.set(a,s),n.set(i,c)}else{const c=o.get(a);if(c==null){const[f,h]=o.entries().next().value;em(t,s,h,ln(t,a),ln(t,f)),o.set(a,s)}else lc(s,c)}}return Ht.set(r,Pr),e.components.push({id:`${Pr++}`,name:r.name,children:i==null?[]:[{objectID:`${Ht.get(i)}`}]}),s}async function uc(t,e){const r=performance.now();Object.assign(zt,tc),Object.assign(zt,t);const n=new ur,s=Math.sqrt(2)/2,i=1/1e3,a=n.createNode("wrapper").setRotation([-s,0,0,s]).setScale([i,i,i]);n.createScene().addChild(a),cr=n.createAnimation(""),fn=!1;const o=Math.round(zt.animationLength*k1)+1,c=new Float32Array(o),f=new Float32Array(o);for(let w=0;w<o;++w){const A=w/(o-1);c[w]=A*zt.animationLength,f[w]=zt.animationMode!=="ping-pong"?A:(1-Math.cos(A*2*Math.PI))/2}Or=n.createAccessor("animation times").setBuffer(n.createBuffer()).setArray(c).setType(q.Type.SCALAR),Ln=n.createAccessor("animation weights").setBuffer(n.getRoot().listBuffers()[0]).setArray(f).setType(q.Type.SCALAR),tn=n.createAnimationSampler().setInput(Or).setOutput(Ln).setInterpolation("LINEAR"),cr.addSampler(tn);const h={meshes:[],components:[],items:[],precision:7,header:{unit:"millimeter",title:"ManifoldCAD.org model",description:"ManifoldCAD.org model",application:"ManifoldCAD.org"}};if(Gt.length>0){const w=new Map,A=new Map;let S=0;for(const x of Gt)w.set(x,tm(n,h,x,A)),x.manifold&&++S;for(const x of Gt){const I=w.get(x),b={objectID:`${Ht.get(x)}`,transform:I.getMatrix()},{parent:N}=x;N==null?(a.addChild(I),h.items.push(b)):(w.get(N).addChild(I),h.components.find(U=>U.id==`${Ht.get(N)}`).children.push(b))}ar("Total glTF nodes: ",Gt.length,", Total mesh references: ",S)}else{if(e==null){ar('No output because "result" is undefined and no "GLTFNode"s were created.');return}const w=n.createNode();fc(n,h,w,e),a.addChild(w),h.items.push({objectID:`${Ht.get(e)}`})}const d=performance.now();console.log(`Manifold took ${(Math.round((d-r)/10)/100).toLocaleString()} seconds`),fn||(Or.dispose(),Ln.dispose(),tn.dispose(),cr.dispose());const p=await rc.writeBinary(n),g=new Blob([p],{type:"application/octet-stream"}),E=new d1;E.add3dModel("3D/3dmodel.model");const M=h1(h),T={};T["3D/3dmodel.model"]=Cr(M),T[pi.name]=Cr(pi.content),T[E.name]=Cr(E.content);const v=b1(T),D=new Blob([v],{type:"application/vnd.ms-package.3dmanufacturing-3dmodel+xml"}),R=performance.now();return console.log(`Exporting GLB & 3MF took ${(Math.round((R-d)/10)/100).toLocaleString()} seconds`),{glbBlob:g,threeMFBlob:D}}var rm=Object.freeze({__proto__:null,GLTFNode:sc,cleanup:nc,debug:ys,exportModels:uc,only:X1,setMaterial:q1,setMorphEnd:ac,setMorphStart:ic,show:W1});const Kt=new Eg;Kt.getModule();_i(Array);Kt.addContext({glMatrix:pg});for(const t of["show","only","setMaterial"])Kt.addContextMethodWithCleanup(t,rm[t]);Kt.addContext({GLTFNode:sc,setMorphStart:ic,setMorphEnd:ac});function nm(){Kt.cleanup(),nc()}async function sm(t){const e={};Kt.context.globalDefaults=e;const r=Kt.evaluate(t),n=await uc(e,r);return{glbURL:URL.createObjectURL(n?.glbBlob??new Blob([])),threeMFURL:URL.createObjectURL(n?.threeMFBlob??new Blob([]))}}self.postMessage(null);if(self.console){const t=self.console.log;self.console.log=function(...e){let r="";for(const n of e)n==null?r+="undefined":typeof n=="object"?r+=JSON.stringify(n,null,4):r+=n.toString();self.postMessage({log:r}),t(...e)}}self.onmessage=async t=>{try{const e=await sm(t.data);self.postMessage(e)}catch(e){console.log(e.toString()),self.postMessage({objectURL:null})}finally{nm()}};var im=Object.freeze({__proto__:null});
//# sourceMappingURL=worker-wrapper-BGbCUY5N.js.map
